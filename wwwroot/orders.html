<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>订单</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="bottom-nav.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #e9ecef;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        
        .mobile-container {
            width: 450px;
            max-width: 450px;
            min-height: 100vh;
            background-color: #f8f9fa;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-left: 1px solid #dee2e6;
            border-right: 1px solid #dee2e6;
            position: relative;
            padding-bottom: 80px;
        }
        
        .header {
            background: linear-gradient(135deg, #007AFF 0%, #0056CC 100%);
            color: white;
            padding: 15px 20px;
            position: relative;
            text-align: center;
        }
        
        .page-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
        }
        
        .order-tabs {
            background: white;
            display: flex;
            border-bottom: 1px solid #e9ecef;
        }
        
        .tab-item {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: none;
            border: none;
            color: #666;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-item.active {
            color: #007AFF;
            border-bottom: 2px solid #007AFF;
        }
        
        .order-list {
            padding: 20px;
        }
        
        .order-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .order-number {
            font-size: 12px;
            color: #666;
        }
        
        .order-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 500;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-processing {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }
        
        .order-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .order-image {
            width: 60px;
            height: 60px;
            background: #f0f0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }
        
        .order-info {
            flex: 1;
        }
        
        .order-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            color: #333;
        }
        
        .order-details {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .order-amount {
            font-size: 16px;
            font-weight: bold;
            color: #007AFF;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ddd;
        }
        
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <!-- 顶部区域 -->
        <div class="header">
            <h1 class="page-title">我的订单</h1>
        </div>

        <!-- 订单标签页 -->
        <div class="order-tabs">
            <button class="tab-item active" onclick="switchTab('all')">
                全部
            </button>
            <button class="tab-item" onclick="switchTab('pending')">
                待处理
            </button>
            <button class="tab-item" onclick="switchTab('processing')">
                进行中
            </button>
            <button class="tab-item" onclick="switchTab('completed')">
                已完成
            </button>
        </div>

        <!-- 订单列表 -->
        <div class="order-list" id="orderList">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i> 加载订单中...
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="bottom-nav.js"></script>
    <script src="js/auth.js"></script>
    <script>
        let currentTab = 'all';
        
        // 加载网站名称
        async function loadSiteName() {
            try {
                const response = await fetch('/api/admin/site-settings');
                const settings = await response.json();
                
                if (settings && settings.siteName) {
                    document.title = settings.siteName + '-订单';
                } else {
                    const savedSiteName = localStorage.getItem('siteName');
                    if (savedSiteName) {
                        document.title = savedSiteName + '-订单';
                    } else {
                        document.title = '订单';
                    }
                }
            } catch (error) {
                console.error('加载网站名称失败:', error);
                const savedSiteName = localStorage.getItem('siteName');
                if (savedSiteName) {
                    document.title = savedSiteName + '-订单';
                } else {
                    document.title = '订单';
                }
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadSiteName();
            loadOrders();
        });
        
        // 切换标签页
        function switchTab(tab) {
            currentTab = tab;
            
            // 更新标签页样式
            document.querySelectorAll('.tab-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 重新加载订单
            loadOrders();
        }
        
        // 加载订单列表
        async function loadOrders() {
            const orderList = document.getElementById('orderList');
            orderList.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> 加载订单中...</div>';
            
            try {
                const response = await fetch(`/api/orders?status=${currentTab}`);
                const orders = await response.json();
                
                if (orders && orders.length > 0) {
                    renderOrders(orders);
                } else {
                    renderEmptyState();
                }
            } catch (error) {
                console.error('加载订单失败:', error);
                renderMockOrders();
            }
        }
        
        // 渲染订单列表
        function renderOrders(orders) {
            const orderList = document.getElementById('orderList');
            let html = '';
            
            orders.forEach(order => {
                html += `
                    <div class="order-card">
                        <div class="order-header">
                            <div class="order-number">订单号: ${order.order_number}</div>
                            <div class="order-status ${getStatusClass(order.status)}">${getStatusText(order.status)}</div>
                        </div>
                        <div class="order-content">
                            <div class="order-image">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="order-info">
                                <div class="order-title">${order.title}</div>
                                <div class="order-details">数量: ${order.quantity} | 创建时间: ${formatDate(order.created_at)}</div>
                                <div class="order-amount">$${order.amount}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            orderList.innerHTML = html;
        }
        
        // 渲染空状态
        function renderEmptyState() {
            const orderList = document.getElementById('orderList');
            orderList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <div>暂无订单</div>
                </div>
            `;
        }
        
        // 渲染模拟订单数据
        function renderMockOrders() {
            const mockOrders = [
                {
                    order_number: 'ORD20240101001',
                    title: '电商任务订单',
                    quantity: 1,
                    amount: '25.00',
                    status: 'completed',
                    created_at: '2024-01-01T10:00:00Z'
                },
                {
                    order_number: 'ORD20240101002',
                    title: '推广任务订单',
                    quantity: 2,
                    amount: '50.00',
                    status: 'processing',
                    created_at: '2024-01-01T14:30:00Z'
                },
                {
                    order_number: 'ORD20240101003',
                    title: '评价任务订单',
                    quantity: 1,
                    amount: '15.00',
                    status: 'pending',
                    created_at: '2024-01-01T16:45:00Z'
                }
            ];
            
            // 根据当前标签页过滤订单
            let filteredOrders = mockOrders;
            if (currentTab !== 'all') {
                filteredOrders = mockOrders.filter(order => order.status === currentTab);
            }
            
            if (filteredOrders.length > 0) {
                renderOrders(filteredOrders);
            } else {
                renderEmptyState();
            }
        }
        
        // 获取状态样式类
        function getStatusClass(status) {
            const statusMap = {
                'pending': 'status-pending',
                'processing': 'status-processing',
                'completed': 'status-completed',
                'cancelled': 'status-cancelled'
            };
            return statusMap[status] || 'status-pending';
        }
        
        // 获取状态文本
        function getStatusText(status) {
            const statusMap = {
                'pending': '待处理',
                'processing': '进行中',
                'completed': '已完成',
                'cancelled': '已取消'
            };
            return statusMap[status] || '未知';
        }
        
        // 格式化日期
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>
</body>
</html>