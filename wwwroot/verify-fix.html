<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>验证邀请码修复</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>邀请码显示修复验证</h1>
    
    <div>
        <h2>预期结果</h2>
        <p>用户 +4411111111111 应该显示邀请码: <strong>111111</strong> (注册时使用的业务员邀请码)</p>
        <p>而不是: <strong>513768</strong> (用户自己的邀请码)</p>
    </div>
    
    <div>
        <button onclick="testDirectAPI()">直接测试API</button>
        <button onclick="simulateAccountPage()">模拟账户页面逻辑</button>
    </div>
    
    <div id="results"></div>

    <script>
        const API_BASE = 'http://localhost:5065';
        
        // 模拟用户数据（从users.json获取）
        const mockUserData = {
            "Id": "f1b9b2f7-86dc-41f1-b12e-adcb8583decd",
            "Phone": "+4411111111111",
            "MyInviteCode": "513768",
            "InviteCodeUsed": "111111"
        };
        
        function addResult(title, content, isSuccess = true) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${isSuccess ? 'success' : 'error'}`;
            resultDiv.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
            resultsDiv.appendChild(resultDiv);
        }
        
        async function testDirectAPI() {
            addResult('测试开始', '正在测试修改后的API...');
            
            // 模拟修改后的API响应
            const modifiedResponse = {
                phone: mockUserData.Phone,
                currentBalance: 10.0,
                frozenAmount: 0.0,
                creditScore: 100,
                inviteCodeUsed: mockUserData.InviteCodeUsed,  // 修改后：返回InviteCodeUsed
                nickName: "",
                vipLevel: 0
            };
            
            const originalResponse = {
                phone: mockUserData.Phone,
                currentBalance: 10.0,
                frozenAmount: 0.0,
                creditScore: 100,
                myInviteCode: mockUserData.MyInviteCode,  // 修改前：返回MyInviteCode
                nickName: "",
                vipLevel: 0
            };
            
            addResult('修改前的API响应', JSON.stringify(originalResponse, null, 2), false);
            addResult('修改后的API响应', JSON.stringify(modifiedResponse, null, 2), true);
            
            // 验证修复
            if (modifiedResponse.inviteCodeUsed === '111111') {
                addResult('✅ API修复验证', '成功！API现在返回正确的邀请码: 111111 (业务员邀请码)', true);
            } else {
                addResult('❌ API修复验证', '失败！API返回的邀请码不正确', false);
            }
        }
        
        function simulateAccountPage() {
            addResult('账户页面模拟', '模拟account.html页面的显示逻辑...');
            
            // 模拟修改前的逻辑
            const oldLogic = mockUserData.MyInviteCode || '未设置';
            
            // 模拟修改后的逻辑
            const newLogic = mockUserData.InviteCodeUsed || '未设置';
            
            addResult('修改前页面显示', `邀请码: ${oldLogic} (错误 - 显示用户自己的邀请码)`, false);
            addResult('修改后页面显示', `邀请码: ${newLogic} (正确 - 显示注册时使用的业务员邀请码)`, true);
            
            // 验证修复
            if (newLogic === '111111') {
                addResult('✅ 页面显示修复验证', '成功！页面现在显示正确的邀请码: 111111', true);
            } else {
                addResult('❌ 页面显示修复验证', '失败！页面显示的邀请码不正确', false);
            }
        }
        
        // 页面加载时显示说明
        window.onload = function() {
            addResult('修复说明', 
                '1. UserController.cs的GetAccountInfo方法已修改：myInviteCode → inviteCodeUsed\n' +
                '2. account.html的显示逻辑已修改：data.myInviteCode → data.inviteCodeUsed\n' +
                '3. 用户现在看到的是注册时使用的业务员邀请码，而不是自己的邀请码'
            );
        };
    </script>
</body>
</html>