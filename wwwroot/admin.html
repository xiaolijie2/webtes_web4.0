<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°ç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            overflow-x: hidden;
        }

        /* ä¸»å¸ƒå±€å®¹å™¨ */
        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* å·¦ä¾§å¯¼èˆªèœå• */
        .sidebar {
            width: 240px;
            background-color: #2c3e50;
            color: #ecf0f1;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        .sidebar-header {
            padding: 20px;
            background-color: #34495e;
            text-align: center;
            border-bottom: 1px solid #34495e;
        }

        .sidebar-header h4 {
            color: #ecf0f1;
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .sidebar-header .user-info {
            margin-top: 10px;
            font-size: 12px;
            color: #bdc3c7;
        }

        .sidebar-header .header-actions {
            margin-top: 15px;
        }

        .sidebar-header .btn {
            padding: 6px 12px;
            font-size: 12px;
            margin: 0 3px;
        }

        /* å¯¼èˆªèœå• */
        .nav-menu {
            padding: 0;
            list-style: none;
        }

        .nav-item {
            border-bottom: 1px solid #34495e;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: #ecf0f1;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .nav-link:hover {
            background-color: #34495e;
            color: #3498db;
        }

        .nav-link.active {
            background-color: #34495e;
            color: #ff6b35;
            border-left: 4px solid #ff6b35;
        }

        .nav-link i {
            width: 20px;
            margin-right: 12px;
            text-align: center;
        }



        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            margin-left: 240px;
            background-color: #ffffff;
            min-height: 100vh;
        }

        /* é¡¶éƒ¨é¢åŒ…å±‘å¯¼èˆª */
        .content-header {
            background-color: #ffffff;
            padding: 20px 30px;
            border-bottom: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .breadcrumb-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .breadcrumb-nav h2 {
            margin: 0;
            color: #2c3e50;
            font-size: 24px;
            font-weight: 600;
        }

        .breadcrumb {
            background: none;
            padding: 0;
            margin: 0;
        }

        .breadcrumb-item {
            color: #6c757d;
        }

        .breadcrumb-item.active {
            color: #2c3e50;
        }

        /* åˆ†ç±»èœå•æ  */
        .category-menu {
            background-color: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            padding: 0;
        }

        .category-nav {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .category-nav .nav-item {
            border-right: 1px solid #e9ecef;
        }

        .category-nav .nav-item:last-child {
            border-right: none;
        }

        .category-nav .nav-link {
            display: block;
            padding: 15px 20px;
            color: #6c757d;
            text-decoration: none;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .category-nav .nav-link:hover {
            background-color: #e9ecef;
            color: #2c3e50;
        }

        .category-nav .nav-link.active {
            background-color: #ffffff;
            color: #2c3e50;
            border-bottom-color: #ff6b35;
            font-weight: 600;
        }

        /* å†…å®¹é¢æ¿ */
        .content-panel {
            padding: 30px;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            padding: 15px 20px;
        }

        .card-header h5 {
            margin: 0;
            color: #2c3e50;
            font-size: 16px;
            font-weight: 600;
        }

        .card-body {
            padding: 20px;
        }

        /* è¡¨å•æ ·å¼ */
        .form-label {
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .form-control {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px 15px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            border-radius: 6px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: #3498db;
            border-color: #3498db;
        }

        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }

        .btn-success {
            background-color: #27ae60;
            border-color: #27ae60;
        }

        .btn-danger {
            background-color: #e74c3c;
            border-color: #e74c3c;
        }

        .btn-warning {
            background-color: #ff6b35;
            border-color: #ff6b35;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .table {
            margin-bottom: 0;
        }

        .table thead th {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
            color: #2c3e50;
            padding: 12px;
        }

        .table tbody td {
            padding: 12px;
            vertical-align: middle;
            border-bottom: 1px solid #dee2e6;
        }

        .table tbody tr:hover {
            background-color: #f8f9fa;
        }

        /* çŠ¶æ€æ ‡ç­¾ */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-active {
            background-color: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* çŠ¶æ€åœ†ç‚¹æ ·å¼ */
        .status-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: inline-block;
            margin: 0 auto;
        }

        .status-dot:hover {
            transform: scale(1.2);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        /* å¯ç”¨çŠ¶æ€åœ†ç‚¹ */
        .status-dot.enabled {
            background-color: #28a745;
            border: 2px solid #28a745;
        }

        .status-dot.disabled {
            background-color: #6c757d;
            border: 2px solid #6c757d;
        }

        /* é»˜è®¤çŠ¶æ€åœ†ç‚¹ */
        .default-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: inline-block;
            margin: 0 auto;
        }

        .default-dot:hover {
            transform: scale(1.2);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .default-dot.is-default {
            background-color: #ffc107;
            border: 2px solid #ffc107;
        }

        .default-dot.not-default {
            background-color: transparent;
            border: 2px solid #dee2e6;
        }

        .default-dot.not-default:hover {
            border-color: #ffc107;
            background-color: rgba(255, 193, 7, 0.1);
        }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background-color: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background-color: #e3f2fd;
            border-color: #2980b9;
        }

        .upload-area i {
            font-size: 48px;
            color: #3498db;
            margin-bottom: 15px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .main-content {
                margin-left: 0;
            }
        }

        /* å·¥å…·æç¤º */
        .tooltip-inner {
            background-color: #2c3e50;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* LOGOè®¾ç½®æ ·å¼ */
        .logo-settings-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .logo-settings-section .form-label {
            font-weight: 600;
            color: #495057;
        }

        .form-range {
            width: 100%;
        }

        .form-control-color {
            width: 60px;
            height: 38px;
            border-radius: 6px;
        }

        #logoPreviewContainer {
            min-height: 120px;
            background: linear-gradient(45deg, #f8f9fa 25%, transparent 25%), 
                        linear-gradient(-45deg, #f8f9fa 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f8f9fa 75%), 
                        linear-gradient(-45deg, transparent 75%, #f8f9fa 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            border-radius: 8px;
        }

        #logoPreviewContent {
            background-color: white;
            padding: 20px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #f8f9fa;
        }

        .upload-area:hover {
            border-color: #2980b9;
            background-color: #e3f2fd;
        }

        .upload-area h6 {
            color: #3498db;
            margin: 10px 0 5px 0;
        }

        #currentLogoImage {
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        #logoImagePreview {
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }

        .btn-group .btn-check:checked + .btn {
            background-color: #0d6efd;
            border-color: #0d6efd;
            color: white;
        }

        .input-group .form-range {
            flex: 1;
            margin-right: 10px;
        }

        .text-primary {
            color: #0d6efd !important;
        }

        /* LOGOå¸ƒå±€æ ·å¼ */
        .logo-layout-horizontal {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-layout-vertical {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .logo-layout-overlay {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 80px;
        }

        .logo-layout-overlay .logo-image {
            position: absolute;
            z-index: 1;
        }

        .logo-layout-overlay .logo-text {
            position: relative;
            z-index: 2;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* å›¾ç‰‡ä½ç½®æŒ‰é’®ç»„æ ·å¼ */
        .image-position-group {
            margin-bottom: 10px;
        }

        /* æ‹–æ‹½æ’åºæ ·å¼ */
        .sortable-row {
            transition: all 0.3s ease;
        }

        .sortable-ghost {
            opacity: 0.4;
            background-color: #f8f9fa;
        }

        .sortable-chosen {
            background-color: #e3f2fd;
        }

        .sortable-drag {
            background-color: #ffffff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            transform: rotate(5deg);
        }

        .sortable-handle {
            cursor: move;
            user-select: none;
        }

        .sortable-handle:hover {
            color: #0d6efd !important;
        }

        .image-position-group .btn {
            font-size: 14px;
            padding: 8px 12px;
        }

        .image-position-group .btn i {
            margin-right: 5px;
        }



        .drop-zone {
            border: 2px dashed #007bff;
            background-color: rgba(0, 123, 255, 0.1);
        }

        /* æ‹–æ‹½æ‰‹æŸ„æ”¹è¿› */
        .drag-handle {
            cursor: grab;
            user-select: none;
            padding: 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .drag-handle:hover {
            background-color: rgba(0, 123, 255, 0.1);
        }

        .drag-handle:active {
            cursor: grabbing;
            background-color: rgba(0, 123, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- å·¦ä¾§å¯¼èˆªèœå• -->
        <nav class="sidebar">
            <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
            <div class="sidebar-header">
                <h4><i class="fas fa-cogs"></i> ç®¡ç†ç³»ç»Ÿ</h4>
                <div class="user-info" id="userInfoDisplay">
                    <i class="fas fa-user-circle"></i> <span id="userTypeLabel">ç®¡ç†å‘˜</span>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline-light btn-sm" onclick="goToHome()" title="è¿”å›é¦–é¡µ">
                        <i class="fas fa-home"></i>
                    </button>
                    <button class="btn btn-outline-danger btn-sm" onclick="logout()" title="é€€å‡ºç™»å½•">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <!-- å¯¼èˆªèœå• -->
            <ul class="nav-menu">
                <!-- ç½‘ç«™è®¾ç½® -->
                <li class="nav-item">
                    <a class="nav-link active" data-section="website-settings">
                        <i class="fas fa-globe"></i>
                        <span>ç½‘ç«™è®¾ç½®</span>
                    </a>
                </li>

                <!-- ä¼šå‘˜ç®¡ç† -->
                <li class="nav-item">
                    <a class="nav-link" data-section="member-management">
                        <i class="fas fa-users"></i>
                        <span>ä¼šå‘˜ç®¡ç†</span>
                    </a>
                </li>

                <!-- è®¢å•ç®¡ç† -->
                <li class="nav-item">
                    <a class="nav-link" data-section="order-management">
                        <i class="fas fa-shopping-cart"></i>
                        <span>è®¢å•ç®¡ç†</span>
                    </a>
                </li>

                <!-- æ”¶æ¬¾ç®¡ç† -->
                <li class="nav-item">
                    <a class="nav-link" data-section="payment-management">
                        <i class="fas fa-credit-card"></i>
                        <span>æ”¶æ¬¾ç®¡ç†</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- é¡¶éƒ¨é¢åŒ…å±‘å¯¼èˆª -->
            <div class="content-header">
                <div class="breadcrumb-nav">
                    <h2 id="page-title">ç½‘ç«™è®¾ç½®</h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item">ç®¡ç†ç³»ç»Ÿ</li>
                            <li class="breadcrumb-item active" id="section-breadcrumb">ç½‘ç«™è®¾ç½®</li>
                        </ol>
                    </nav>
                </div>
            </div>

            <!-- åˆ†ç±»èœå•æ  -->
            <div class="category-menu">
                <ul class="category-nav" id="category-nav">
                    <!-- åŠ¨æ€ç”Ÿæˆåˆ†ç±»èœå• -->
                </ul>
            </div>

            <!-- å†…å®¹é¢æ¿ -->
            <div class="content-panel">
                <!-- åŸºç¡€ä¿¡æ¯è®¾ç½® -->
                <div id="basic-info" class="content-section active">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-cog text-primary"></i> åŸºç¡€ä¿¡æ¯è®¾ç½®</h5>
                        </div>
                        <div class="card-body">
                            <form id="basic-info-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">ç½‘ç«™åç§°</label>
                                            <input type="text" class="form-control" id="siteName" value="ç½‘ç«™ç®¡ç†ç³»ç»Ÿ" placeholder="è¯·è¾“å…¥ç½‘ç«™åç§°">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">è”ç³»ç”µè¯</label>
                                            <input type="text" class="form-control" id="contactPhone" value="400-000-0000" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="mb-3">
                                            <label class="form-label">ç½‘ç«™æè¿°</label>
                                            <textarea class="form-control" id="siteDescription" rows="3" placeholder="è¯·è¾“å…¥ç½‘ç«™æè¿°">ä¸“ä¸šçš„ç½‘ç«™ç®¡ç†ç³»ç»Ÿï¼Œæä¾›å…¨é¢çš„ç®¡ç†åŠŸèƒ½</textarea>
                                        </div>
                                    </div>
                                </div>
                                <!-- LOGOç®¡ç†åŒºåŸŸ -->
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="mb-4">
                                            <h6 class="text-primary"><i class="fas fa-image"></i> LOGOè®¾ç½®</h6>
                                            <hr>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- LOGOç±»å‹é€‰æ‹© -->
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="mb-3">
                                            <label class="form-label">LOGOç±»å‹</label>
                                            <div class="btn-group w-100" role="group">
                                                <input type="radio" class="btn-check" name="logoType" id="logoTypeText" value="text">
                                                <label class="btn btn-outline-primary" for="logoTypeText">çº¯æ–‡å­—</label>
                                                
                                                <input type="radio" class="btn-check" name="logoType" id="logoTypeImage" value="image">
                                                <label class="btn btn-outline-primary" for="logoTypeImage">çº¯å›¾ç‰‡</label>
                                                
                                                <input type="radio" class="btn-check" name="logoType" id="logoTypeCombined" value="combined" checked>
                                                <label class="btn btn-outline-primary" for="logoTypeCombined">å›¾ç‰‡+æ–‡å­—</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- æ–‡å­—è®¾ç½®åŒºåŸŸ -->
                                <div id="textSettings" class="logo-settings-section">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">LOGOæ–‡å­—</label>
                                                <input type="text" class="form-control" id="logoText" placeholder="è¯·è¾“å…¥LOGOæ–‡å­—" value="SheIn1323">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">å­—ä½“å¤§å°</label>
                                                <div class="input-group">
                                                    <input type="range" class="form-range" id="fontSize" min="12" max="48" value="24" oninput="updateFontSizeDisplay(this.value)">
                                                    <span class="input-group-text" id="fontSizeDisplay">24px</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">å­—ä½“é¢œè‰²</label>
                                                <input type="color" class="form-control form-control-color" id="fontColor" value="#333333">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">å­—ä½“ç²—ç»†</label>
                                                <select class="form-select" id="fontWeight">
                                                    <option value="300">ç»†ä½“</option>
                                                    <option value="400" selected>æ­£å¸¸</option>
                                                    <option value="500">ä¸­ç­‰</option>
                                                    <option value="600">åŠç²—</option>
                                                    <option value="700">ç²—ä½“</option>
                                                    <option value="800">ç‰¹ç²—</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">å­—ä½“</label>
                                                <select class="form-select" id="fontFamily">
                                                    <option value="Arial, sans-serif">Arial</option>
                                                    <option value="'Microsoft YaHei', sans-serif" selected>å¾®è½¯é›…é»‘</option>
                                                    <option value="'SimHei', sans-serif">é»‘ä½“</option>
                                                    <option value="'SimSun', serif">å®‹ä½“</option>
                                                    <option value="'KaiTi', serif">æ¥·ä½“</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- å›¾ç‰‡è®¾ç½®åŒºåŸŸ -->
                                <div id="imageSettings" class="logo-settings-section">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">LOGOå›¾ç‰‡</label>
                                                <div class="upload-area" onclick="document.getElementById('logoImageFile').click()">
                                                    <i class="fas fa-cloud-upload-alt"></i>
                                                    <h6>ç‚¹å‡»ä¸Šä¼ LOGOå›¾ç‰‡</h6>
                                                    <p class="text-muted mb-0">æ”¯æŒ PNGã€JPG æ ¼å¼ï¼Œå»ºè®®å°ºå¯¸ 200x60</p>
                                                    <input type="file" id="logoImageFile" accept="image/*" style="display: none;" onchange="handleLogoImageUpload(this)">
                                                </div>
                                                <div id="currentLogoImage" class="mt-2" style="display: none;">
                                                    <img id="logoImagePreview" src="" alt="å½“å‰LOGO" style="max-width: 200px; max-height: 60px;" class="border rounded">
                                                    <button type="button" class="btn btn-sm btn-danger ms-2" onclick="removeLogoImage()">
                                                        <i class="fas fa-trash"></i> åˆ é™¤
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">å›¾ç‰‡ä½ç½®</label>
                                                <div class="row">
                                                    <div class="col-12 mb-2">
                                                        <div class="btn-group w-100" role="group">
                                                            <input type="radio" class="btn-check" name="imagePosition" id="imageLeft" value="left" checked>
                                                            <label class="btn btn-outline-secondary" for="imageLeft">
                                                                <i class="fas fa-align-left"></i> å·¦ä¾§
                                                            </label>
                                                            
                                                            <input type="radio" class="btn-check" name="imagePosition" id="imageRight" value="right">
                                                            <label class="btn btn-outline-secondary" for="imageRight">
                                                                <i class="fas fa-align-right"></i> å³ä¾§
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="col-12">
                                                        <div class="btn-group w-100" role="group">
                                                            <input type="radio" class="btn-check" name="imagePosition" id="imageTop" value="top">
                                                            <label class="btn btn-outline-secondary" for="imageTop">
                                                                <i class="fas fa-arrow-up"></i> ä¸Šæ–¹
                                                            </label>
                                                            
                                                            <input type="radio" class="btn-check" name="imagePosition" id="imageCenter" value="center">
                                                            <label class="btn btn-outline-secondary" for="imageCenter">
                                                                <i class="fas fa-dot-circle"></i> ä¸­é—´
                                                            </label>
                                                            
                                                            <input type="radio" class="btn-check" name="imagePosition" id="imageBottom" value="bottom">
                                                            <label class="btn btn-outline-secondary" for="imageBottom">
                                                                <i class="fas fa-arrow-down"></i> ä¸‹æ–¹
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- LOGOé¢„è§ˆåŒºåŸŸ -->
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="mb-3">
                                            <label class="form-label">LOGOé¢„è§ˆ</label>
                                            <div class="border rounded p-4 text-center bg-light" style="min-height: 120px; display: flex; align-items: center; justify-content: center;">
                                                <div id="logoPreviewContainer" class="d-flex align-items-center justify-content-center">
                                                    <div id="logoPreviewContent" class="text-muted">
                                                        <i class="fas fa-image fa-2x"></i>
                                                        <p class="mt-2 mb-0">LOGOé¢„è§ˆå°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- LOGOæ“ä½œæŒ‰é’® -->
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="mb-3">
                                            <button type="button" class="btn btn-info me-2" onclick="previewLogo()">
                                                <i class="fas fa-eye"></i> é¢„è§ˆæ•ˆæœ
                                            </button>
                                            <button type="button" class="btn btn-success me-2" onclick="saveLogoSettings()">
                                                <i class="fas fa-save"></i> ä¿å­˜LOGOè®¾ç½®
                                            </button>
                                            <button type="button" class="btn btn-secondary" onclick="resetLogoSettings()">
                                                <i class="fas fa-undo"></i> é‡ç½®è®¾ç½®
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <button type="button" class="btn btn-secondary me-2">é‡ç½®</button>
                                    <button type="submit" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- è½®æ’­å›¾ç®¡ç† -->
                <div id="slideshow" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-images text-primary"></i> è½®æ’­å›¾ç®¡ç†</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <button class="btn btn-success" onclick="addSlideshow()">
                                    <i class="fas fa-plus"></i> æ·»åŠ è½®æ’­å›¾
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>æ’åº</th>
                                            <th>é¢„è§ˆ</th>
                                            <th>æ ‡é¢˜</th>
                                            <th>æè¿°</th>
                                            <th>çŠ¶æ€</th>
                                            <th>æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="slideshowList">
                                        <!-- è½®æ’­å›¾åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- æ‰‹æœºåŒºå·ç®¡ç† -->
                <div id="country-codes" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-globe text-primary"></i> æ‰‹æœºåŒºå·ç®¡ç†</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <button class="btn btn-success" onclick="addCountryCode()">
                                    <i class="fas fa-plus"></i> æ·»åŠ åŒºå·
                                </button>
                                <button class="btn btn-info ms-2" onclick="loadCountryCodes()">
                                    <i class="fas fa-refresh"></i> åˆ·æ–°åˆ—è¡¨
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th width="40"><i class="fas fa-grip-vertical text-muted" title="æ‹–æ‹½æ’åº"></i></th>
                                            <th>æ’åº</th>
                                            <th>å›½æ——</th>
                                            <th>å›½å®¶/åœ°åŒº</th>
                                            <th>å›½å®¶ä»£ç </th>
                                            <th>ç”µè¯åŒºå·</th>
                                            <th>çŠ¶æ€</th>
                                            <th>é»˜è®¤</th>
                                            <th>æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="countryCodesList">
                                        <!-- åŒºå·åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIPç­‰çº§ç®¡ç† -->
                <div id="vip-levels" class="content-section">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-crown text-primary"></i> VIPç­‰çº§ç®¡ç†</h5>
                            <small class="text-muted">ç®¡ç†ç³»ç»Ÿçš„4ä¸ªå›ºå®šVIPç­‰çº§</small>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info mb-4">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>è¯´æ˜ï¼š</strong>ç³»ç»ŸåŒ…å«4ä¸ªå›ºå®šçš„VIPç­‰çº§ï¼Œæ‚¨å¯ä»¥ç¼–è¾‘æ¯ä¸ªç­‰çº§çš„åŸºæœ¬ä¿¡æ¯ã€æƒç›Šå†…å®¹ã€é¢œè‰²å’Œå›¾æ ‡è®¾ç½®ã€‚ç­‰çº§é¡ºåºå’Œæ•°é‡ä¸å¯æ›´æ”¹ã€‚
                            </div>

                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th width="80">ç­‰çº§</th>
                                            <th>åç§°</th>
                                            <th>æœ€ä½å……å€¼</th>
                                            <th>ä½£é‡‘ç‡</th>
                                            <th>æ¯æ—¥è®¢å•</th>
                                            <th>æç°é™é¢</th>
                                            <th>æƒç›Šæ•°é‡</th>
                                            <th>çŠ¶æ€</th>
                                            <th width="180">æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="vipLevelsList">
                                        <!-- VIPç­‰çº§åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¼šå‘˜åˆ—è¡¨ -->
                <div id="member-list" class="content-section">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-users text-primary"></i> ä¼šå‘˜åˆ—è¡¨</h5>
                            <button class="btn btn-outline-primary btn-sm" onclick="refreshMemberList()">
                                <i class="fas fa-sync-alt"></i> åˆ·æ–°
                            </button>
                        </div>
                        <div class="card-body">
                            <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
                            <div class="row mb-3">
                                <div class="col-md-3">
                                    <input type="text" id="memberSearchInput" class="form-control" placeholder="æœç´¢æ‰‹æœºå·/æ˜µç§°" onkeyup="handleMemberSearch(event)">
                                </div>
                                <div class="col-md-2">
                                    <select id="memberStatusFilter" class="form-select" onchange="filterMembers()">
                                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                        <option value="true">æ­£å¸¸</option>
                                        <option value="false">ç¦ç”¨</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <select id="memberVipFilter" class="form-select" onchange="filterMembers()">
                                        <option value="">å…¨éƒ¨VIPç­‰çº§</option>
                                        <option value="1">VIP 1 ğŸ¥‰</option>
                                        <option value="2">VIP 2 ğŸ¥ˆ</option>
                                        <option value="3">VIP 3 ğŸ¥‡</option>
                                        <option value="4">VIP 4 ğŸ‘‘</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <button class="btn btn-primary" onclick="searchMembers()">
                                        <i class="fas fa-search"></i> æœç´¢
                                    </button>
                                </div>
                                <div class="col-md-3 text-end">
                                    <small class="text-muted">å…± <span id="memberTotalCount">0</span> åä¼šå‘˜</small>
                                </div>
                            </div>
                            
                            <!-- ä¼šå‘˜åˆ—è¡¨è¡¨æ ¼ -->
                            <div class="table-responsive">
                                <table class="table table-hover table-striped">
                                    <thead class="table-light">
                                        <tr>
                                            <th width="15%">è´¦å·</th>
                                            <th width="15%">å¯†ç </th>
                                            <th width="15%">é‚€è¯·ç </th>
                                            <th width="10%">å®¢æˆ·æ•°</th>
                                            <th width="15%">åˆ›å»ºæ—¶é—´</th>
                                            <th width="30%">æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="membersList">
                                        <tr>
                                            <td colspan="6" class="text-center py-4">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">åŠ è½½ä¸­...</span>
                                                </div>
                                                <div class="mt-2">æ­£åœ¨åŠ è½½ä¼šå‘˜æ•°æ®...</div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- åˆ†é¡µæ§ä»¶ -->
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <div>
                                    <select id="memberPageSize" class="form-select form-select-sm" style="width: auto;" onchange="changeMemberPageSize()">
                                        <option value="10">æ¯é¡µ 10 æ¡</option>
                                        <option value="20">æ¯é¡µ 20 æ¡</option>
                                        <option value="50">æ¯é¡µ 50 æ¡</option>
                                    </select>
                                </div>
                                <nav>
                                    <ul class="pagination pagination-sm mb-0" id="memberPagination">
                                        <!-- åˆ†é¡µæŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- è®¢å•åˆ—è¡¨ -->
                <div id="order-list" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-shopping-cart text-primary"></i> è®¢å•åˆ—è¡¨</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-3">
                                    <input type="text" class="form-control" placeholder="æœç´¢è®¢å•å·">
                                </div>
                                <div class="col-md-2">
                                    <select class="form-select">
                                        <option>å…¨éƒ¨çŠ¶æ€</option>
                                        <option>å¾…ä»˜æ¬¾</option>
                                        <option>å·²ä»˜æ¬¾</option>
                                        <option>å·²å®Œæˆ</option>
                                        <option>å·²å–æ¶ˆ</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <button class="btn btn-primary">æœç´¢</button>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>è®¢å•å·</th>
                                            <th>ç”¨æˆ·</th>
                                            <th>é‡‘é¢</th>
                                            <th>çŠ¶æ€</th>
                                            <th>åˆ›å»ºæ—¶é—´</th>
                                            <th>æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>ORD20240101001</td>
                                            <td>ç¤ºä¾‹ç”¨æˆ·</td>
                                            <td>Â¥99.00</td>
                                            <td><span class="status-badge status-active">å·²ä»˜æ¬¾</span></td>
                                            <td>2024-01-01 10:00:00</td>
                                            <td>
                                                <button class="btn btn-sm btn-primary me-1">æŸ¥çœ‹</button>
                                                <button class="btn btn-sm btn-warning">å¤„ç†</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è®¢å•è¯¦æƒ… -->
                <div id="order-details" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-file-invoice text-primary"></i> è®¢å•è¯¦æƒ…</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted">é€‰æ‹©è®¢å•åæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</p>
                        </div>
                    </div>
                </div>

                <!-- ä¸šåŠ¡å‘˜åˆ—è¡¨ -->
                <div id="staff-list" class="content-section">
                    <!-- ä¸šåŠ¡å‘˜ç»Ÿè®¡å¡ç‰‡ -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="mb-0" id="totalStaff">0</h4>
                                            <p class="mb-0">æ€»ä¸šåŠ¡å‘˜</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-users fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="mb-0" id="activeStaff">0</h4>
                                            <p class="mb-0">æ´»è·ƒä¸šåŠ¡å‘˜</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-user-check fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="mb-0" id="totalCustomers">0</h4>
                                            <p class="mb-0">æ€»å®¢æˆ·æ•°</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-user-friends fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="mb-0" id="inactiveStaff">0</h4>
                                            <p class="mb-0">ç¦ç”¨ä¸šåŠ¡å‘˜</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-user-times fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-user-tie text-primary"></i> ä¸šåŠ¡å‘˜ç®¡ç†</h5>
                            <button class="btn btn-success" onclick="showAddStaffModal()">
                                <i class="fas fa-plus"></i> æ·»åŠ ä¸šåŠ¡å‘˜
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-3">
                                    <input type="text" class="form-control" id="searchStaff" placeholder="æœç´¢æ˜µç§°ã€è´¦å·æˆ–é‚€è¯·ç ">
                                </div>
                                <div class="col-md-2">
                                    <select class="form-select" id="filterStaffStatus">
                                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                        <option value="active">æ­£å¸¸</option>
                                        <option value="inactive">ç¦ç”¨</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <button class="btn btn-primary" onclick="searchStaff()">
                                        <i class="fas fa-search"></i> æœç´¢
                                    </button>
                                </div>
                                <div class="col-md-2 ms-auto">
                                    <button class="btn btn-info" onclick="loadStaffList()">
                                        <i class="fas fa-sync-alt"></i> åˆ·æ–°
                                    </button>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>è´¦å·</th>
                                            <th>å¯†ç </th>
                                            <th>é‚€è¯·ç </th>
                                            <th>å®¢æˆ·æ•°</th>
                                            <th>åˆ›å»ºæ—¶é—´</th>
                                            <th>æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="staffTableBody">
                                        <tr>
                                            <td colspan="6" class="text-center text-muted">
                                                <div class="loading"></div>
                                                æ­£åœ¨åŠ è½½ä¸šåŠ¡å‘˜åˆ—è¡¨...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ”¶æ¬¾è´¦æˆ·ç®¡ç† -->
                <div id="payment-accounts" class="content-section">
                    <!-- ç»Ÿè®¡å¡ç‰‡ -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="mb-0" id="totalPaymentAccounts">0</h4>
                                            <p class="mb-0">æ€»è´¦æˆ·æ•°</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-credit-card fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="mb-0" id="activePaymentAccounts">0</h4>
                                            <p class="mb-0">å¯ç”¨è´¦æˆ·</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-check-circle fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-danger text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="mb-0" id="inactivePaymentAccounts">0</h4>
                                            <p class="mb-0">ç¦ç”¨è´¦æˆ·</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-times-circle fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="mb-0" id="defaultPaymentAccounts">0</h4>
                                            <p class="mb-0">é»˜è®¤è´¦æˆ·</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-star fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ”¶æ¬¾è´¦æˆ·ç®¡ç†å¡ç‰‡ -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-credit-card text-primary"></i> æ”¶æ¬¾è´¦æˆ·ç®¡ç†</h5>
                            <button class="btn btn-success" onclick="showAddPaymentAccountModal()">
                                <i class="fas fa-plus"></i> æ·»åŠ æ”¶æ¬¾è´¦æˆ·
                            </button>
                        </div>
                        <div class="card-body">
                            <!-- æ“ä½œæŒ‰é’®å’Œæœç´¢åŒºåŸŸ -->
                            <div class="row mb-3">
                                <div class="col-md-3">
                                    <select class="form-control" id="paymentAccountStatusFilter" onchange="searchPaymentAccounts()">
                                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                        <option value="enabled">å¯ç”¨</option>
                                        <option value="disabled">ç¦ç”¨</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <input type="text" class="form-control" id="paymentAccountSearch" placeholder="æœç´¢è´¦æˆ·åç§°æˆ–åœ°å€" onkeyup="searchPaymentAccounts()">
                                </div>
                                <div class="col-md-2">
                                    <button class="btn btn-primary" onclick="searchPaymentAccounts()">
                                        <i class="fas fa-search"></i> æœç´¢
                                    </button>
                                </div>
                                <div class="col-md-2 ms-auto">
                                    <button class="btn btn-info" onclick="loadPaymentAccounts()">
                                        <i class="fas fa-sync-alt"></i> åˆ·æ–°
                                    </button>
                                </div>
                            </div>

                            <!-- æ”¶æ¬¾è´¦æˆ·è¡¨æ ¼ -->
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>é’±åŒ…åç§°</th>
                                            <th>æ•°å­—è´§å¸</th>
                                            <th>ç½‘ç»œç±»å‹</th>
                                            <th>é’±åŒ…åœ°å€</th>
                                            <th>è´¦æˆ·æ ‡è¯†</th>
                                            <th>çŠ¶æ€</th>
                                            <th>é»˜è®¤</th>
                                            <th>åˆ›å»ºæ—¶é—´</th>
                                            <th>æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="paymentAccountsTableBody">
                                        <tr>
                                            <td colspan="9" class="text-center text-muted">
                                                <div class="loading"></div>
                                                æ­£åœ¨åŠ è½½æ”¶æ¬¾è´¦æˆ·åˆ—è¡¨...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // å…¨å±€å˜é‡
        let currentSection = 'website-settings';
        let currentCategory = 'basic-info';
        
        // APIåŸºç¡€URLé…ç½®
        const API_BASE_URL = 'http://localhost:5065';

        // èœå•é…ç½®æ•°æ®
        const menuConfig = {
            'website-settings': {
                name: 'ç½‘ç«™è®¾ç½®',
                categories: [
                    { id: 'basic-info', name: 'åŸºç¡€ä¿¡æ¯è®¾ç½®' },
                    { id: 'slideshow', name: 'è½®æ’­å›¾ç®¡ç†' },
                    { id: 'country-codes', name: 'æ‰‹æœºåŒºå·ç®¡ç†' },
                    { id: 'vip-levels', name: 'VIPç­‰çº§ç®¡ç†' }
                ]
            },
            'member-management': {
                name: 'ä¼šå‘˜ç®¡ç†',
                categories: [
                    { id: 'member-list', name: 'ä¼šå‘˜åˆ—è¡¨' },
                    { id: 'staff-list', name: 'ä¸šåŠ¡å‘˜ç®¡ç†' }
                ]
            },
            'order-management': {
                name: 'è®¢å•ç®¡ç†',
                categories: [
                    { id: 'order-list', name: 'è®¢å•åˆ—è¡¨' },
                    { id: 'order-details', name: 'è®¢å•è¯¦æƒ…' }
                ]
            },
            'payment-management': {
                name: 'æ”¶æ¬¾ç®¡ç†',
                categories: [
                    { id: 'payment-accounts', name: 'æ”¶æ¬¾è´¦æˆ·ç®¡ç†' }
                ]
            }
        };

        // ä¸´æ—¶ä¿®å¤localStorageä¸­çš„ç”¨æˆ·IDä¸ä¸€è‡´é—®é¢˜
        function fixUserIdInLocalStorage() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            if (currentUser.id === 'super_001') {
                currentUser.id = '1';  // ä¿®æ”¹ä¸ºä¸users.jsonä¸€è‡´çš„ID
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                console.log('å·²ä¿®å¤localStorageä¸­çš„ç”¨æˆ·ID:', currentUser);
            }
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ä¿®å¤ç”¨æˆ·IDä¸ä¸€è‡´é—®é¢˜
            fixUserIdInLocalStorage();
            
            // é¦–å…ˆæ£€æŸ¥æƒé™
            checkUserPermissions();
            
            initializeNavigation();
            showMainSection(currentSection);
            loadSlideshowList(); // åŠ è½½è½®æ’­å›¾åˆ—è¡¨
            loadVipLevels(); // åŠ è½½VIPç­‰çº§åˆ—è¡¨
            loadStaffList(); // åŠ è½½ä¸šåŠ¡å‘˜åˆ—è¡¨
            loadPaymentAccounts(); // åŠ è½½æ”¶æ¬¾è´¦æˆ·åˆ—è¡¨
            initializeFormEventListeners(); // åˆå§‹åŒ–è¡¨å•äº‹ä»¶ç›‘å¬å™¨
            
            // æ·»åŠ æœç´¢æ¡†å›è½¦é”®ç›‘å¬
            const searchStaffInput = document.getElementById('searchStaff');
            if (searchStaffInput) {
                searchStaffInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchStaff();
                    }
                });
            }
            
            // æ·»åŠ æ”¶æ¬¾è´¦æˆ·æœç´¢æ¡†å›è½¦é”®ç›‘å¬
            const searchPaymentAccountsInput = document.getElementById('searchPaymentAccounts');
            if (searchPaymentAccountsInput) {
                searchPaymentAccountsInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchPaymentAccounts();
                    }
                });
            }
        });

        // åˆå§‹åŒ–å¯¼èˆª
        function initializeNavigation() {
            // ä¸»èœå•ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.nav-link[data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showMainSection(section);
                });
            });
        }

        // æ˜¾ç¤ºä¸»èœå•å¯¹åº”çš„å†…å®¹
        function showMainSection(section) {
            // æ›´æ–°å½“å‰é€‰ä¸­çš„ä¸»èœå•
            currentSection = section;
            
            // ç§»é™¤æ‰€æœ‰ä¸»èœå•çš„activeçŠ¶æ€
            document.querySelectorAll('.nav-link[data-section]').forEach(link => {
                link.classList.remove('active');
            });

            // æ¿€æ´»å½“å‰ä¸»èœå•
            const activeMainLink = document.querySelector(`[data-section="${section}"]`);
            if (activeMainLink) {
                activeMainLink.classList.add('active');
            }

            // ç”Ÿæˆåˆ†ç±»èœå•
            generateCategoryMenu(section);
            
            // æ˜¾ç¤ºç¬¬ä¸€ä¸ªæœ‰æƒé™çš„åˆ†ç±»çš„å†…å®¹
            const availableCategories = getAvailableCategories(section);
            if (availableCategories.length > 0) {
                showCategory(availableCategories[0].id);
            }

            // æ›´æ–°é¢åŒ…å±‘
            updateBreadcrumb();
        }

        // è·å–æœ‰æƒé™çš„åˆ†ç±»åˆ—è¡¨
        function getAvailableCategories(section) {
            const config = menuConfig[section];
            if (!config) return [];
            
            return config.categories.filter(category => {
                // æ‰€æœ‰åˆ†ç±»éƒ½å¯è®¿é—®ï¼ˆæ”¶æ¬¾è´¦æˆ·ç®¡ç†å’Œç®¡ç†å‘˜è®¾ç½®å·²ç§»é™¤ï¼‰
                return true;
            });
        }

        // ç”Ÿæˆåˆ†ç±»èœå•
        function generateCategoryMenu(section) {
            const categoryNav = document.getElementById('category-nav');
            
            if (!categoryNav) return;

            // æ¸…ç©ºç°æœ‰èœå•
            categoryNav.innerHTML = '';

            // è·å–æœ‰æƒé™çš„åˆ†ç±»å¹¶ç”Ÿæˆèœå•é¡¹
            const availableCategories = getAvailableCategories(section);
            availableCategories.forEach(category => {
                const li = document.createElement('li');
                li.className = 'nav-item';
                
                const a = document.createElement('a');
                a.className = 'nav-link';
                a.href = '#';
                a.textContent = category.name;
                a.setAttribute('data-category', category.id);
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                a.addEventListener('click', function(e) {
                    e.preventDefault();
                    showCategory(category.id);
                });

                li.appendChild(a);
                categoryNav.appendChild(li);
            });
        }

        // æ˜¾ç¤ºåˆ†ç±»å†…å®¹
        function showCategory(categoryId) {
            currentCategory = categoryId;

            // ç§»é™¤æ‰€æœ‰åˆ†ç±»èœå•çš„activeçŠ¶æ€
            document.querySelectorAll('.category-nav .nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // æ¿€æ´»å½“å‰åˆ†ç±»èœå•
            const activeCategoryLink = document.querySelector(`[data-category="${categoryId}"]`);
            if (activeCategoryLink) {
                activeCategoryLink.classList.add('active');
            }

            // æ˜¾ç¤ºå¯¹åº”å†…å®¹åŒºåŸŸ
            showContentSection(categoryId);

            // æ›´æ–°é¢åŒ…å±‘
            updateBreadcrumb();
        }

        // æ˜¾ç¤ºå†…å®¹åŒºåŸŸ
        function showContentSection(contentId) {
            // éšè—æ‰€æœ‰å†…å®¹åŒºåŸŸ
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // æ˜¾ç¤ºæŒ‡å®šå†…å®¹åŒºåŸŸ
            const targetSection = document.getElementById(contentId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
        }

        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        function updateBreadcrumb() {
            const pageTitle = document.getElementById('page-title');
            const sectionBreadcrumb = document.getElementById('section-breadcrumb');

            const sectionConfig = menuConfig[currentSection];
            if (sectionConfig) {
                if (pageTitle) pageTitle.textContent = sectionConfig.name;
                if (sectionBreadcrumb) sectionBreadcrumb.textContent = sectionConfig.name;
            }
        }

        // è¿”å›é¦–é¡µ
        function goToHome() {
            if (confirm('ç¡®å®šè¦è¿”å›é¦–é¡µå—ï¼Ÿ')) {
                window.location.href = 'home.html';
            }
        }

        // é€€å‡ºç™»å½•
        function logout() {
            Swal.fire({
                title: 'ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ',
                text: 'é€€å‡ºåéœ€è¦é‡æ–°ç™»å½•',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'ç¡®å®šé€€å‡º',
                cancelButtonText: 'å–æ¶ˆ'
            }).then((result) => {
                if (result.isConfirmed) {
                    // æ¸…é™¤ç™»å½•çŠ¶æ€
                    localStorage.removeItem('adminToken');
                    sessionStorage.clear();
                    
                    Swal.fire({
                        title: 'é€€å‡ºæˆåŠŸ',
                        text: 'æ­£åœ¨è·³è½¬åˆ°ç™»å½•é¡µé¢...',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    }).then(() => {
                        window.location.href = 'admin-login.html';
                    });
                }
            });
        }

        // åŠ è½½ä¸šåŠ¡å‘˜åˆ—è¡¨
        async function loadStaffList() {
            try {
                console.log('å¼€å§‹åŠ è½½ä¸šåŠ¡å‘˜åˆ—è¡¨...');
                const response = await fetch(`${API_BASE_URL}/api/salesperson/list`);
                
                console.log('APIå“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (response.ok) {
                    // æ£€æŸ¥å“åº”æ˜¯å¦ä¸ºç©º
                    const responseText = await response.text();
                    console.log('APIå“åº”å†…å®¹:', responseText);
                    
                    if (!responseText || responseText.trim() === '') {
                        console.warn('APIè¿”å›ç©ºå“åº”');
                        staffData = [];
                        renderStaffTable();
                        updateStaffStats();
                        return;
                    }
                    
                    let result;
                    try {
                        result = JSON.parse(responseText);
                    } catch (jsonError) {
                        console.error('JSONè§£æå¤±è´¥:', jsonError);
                        console.error('å“åº”å†…å®¹:', responseText);
                        throw new Error('æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                    }
                    
                    if (result && result.success) {
                        // æ˜ å°„åç«¯çš„ Status å­—æ®µåˆ°å‰ç«¯çš„ isActive å­—æ®µ
                        staffData = (result.data || []).map(staff => ({
                            ...staff,
                            isActive: staff.status === 'active'
                        }));
                        console.log('æˆåŠŸåŠ è½½ä¸šåŠ¡å‘˜æ•°æ®:', staffData.length, 'ä¸ªä¸šåŠ¡å‘˜');
                        renderStaffTable();
                        updateStaffStats();
                    } else {
                        console.error('APIè¿”å›é”™è¯¯:', result);
                        throw new Error(result?.message || 'è·å–ä¸šåŠ¡å‘˜åˆ—è¡¨å¤±è´¥');
                    }
                } else {
                    const errorText = await response.text();
                    console.error('APIè¯·æ±‚å¤±è´¥:', response.status, errorText);
                    throw new Error(`ç½‘ç»œè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                console.error('åŠ è½½ä¸šåŠ¡å‘˜åˆ—è¡¨å¤±è´¥:', error);
                
                // è®¾ç½®é»˜è®¤ç©ºæ•°æ®
                staffData = [];
                
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                document.getElementById('staffTableBody').innerHTML = `
                    <tr>
                        <td colspan="10" class="text-center text-danger">
                            <i class="fas fa-exclamation-triangle"></i> åŠ è½½å¤±è´¥: ${error.message}
                            <br><small class="text-muted">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è”ç³»ç®¡ç†å‘˜</small>
                        </td>
                    </tr>
                `;
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®ä¸º0
                updateStaffStats();
            }
        }

        // æ›´æ–°ä¸šåŠ¡å‘˜ç»Ÿè®¡æ•°æ®
        function updateStaffStats() {
            const totalStaff = staffData.length;
            const activeStaff = staffData.filter(staff => staff.isActive).length;
            const inactiveStaff = staffData.filter(staff => !staff.isActive).length;
            const totalCustomers = staffData.reduce((sum, staff) => sum + (staff.customerCount || 0), 0);
            
            // æ›´æ–°é¡µé¢ä¸Šçš„ç»Ÿè®¡æ˜¾ç¤º
            const totalStaffElement = document.getElementById('totalStaff');
            const activeStaffElement = document.getElementById('activeStaff');
            const inactiveStaffElement = document.getElementById('inactiveStaff');
            const totalCustomersElement = document.getElementById('totalCustomers');
            
            if (totalStaffElement) totalStaffElement.textContent = totalStaff;
            if (activeStaffElement) activeStaffElement.textContent = activeStaff;
            if (inactiveStaffElement) inactiveStaffElement.textContent = inactiveStaff;
            if (totalCustomersElement) totalCustomersElement.textContent = totalCustomers;
            
            console.log(`ç»Ÿè®¡æ›´æ–°: æ€»ä¸šåŠ¡å‘˜ ${totalStaff}, æ´»è·ƒä¸šåŠ¡å‘˜ ${activeStaff}, ç¦ç”¨ä¸šåŠ¡å‘˜ ${inactiveStaff}, æ€»å®¢æˆ· ${totalCustomers}`);
        }

        // æ¸²æŸ“ä¸šåŠ¡å‘˜è¡¨æ ¼
        function renderStaffTable() {
            const tbody = document.getElementById('staffTableBody');
            
            if (staffData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center text-muted">
                            <i class="fas fa-users"></i> æš‚æ— ä¸šåŠ¡å‘˜æ•°æ®
                            <br><small class="text-muted">å½“å‰ä¸šåŠ¡å‘˜æ•°é‡: 0</small>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = staffData.map(staff => {
                // æ˜¾ç¤ºè´¦å·ï¼ˆä¼˜å…ˆæ˜¾ç¤ºç”¨æˆ·åï¼‰
                const account = staff.username || '-';
                
                // æ˜¾ç¤ºå¯†ç ï¼ˆæ³¨æ„ï¼šå®é™…é¡¹ç›®ä¸­ä¸åº”è¯¥æ˜¾ç¤ºæ˜æ–‡å¯†ç ï¼Œè¿™é‡ŒæŒ‰ç”¨æˆ·è¦æ±‚æ˜¾ç¤ºï¼‰
                // ä¼˜å…ˆæ˜¾ç¤ºæ˜æ–‡å¯†ç 
                const password = staff.plainPassword || staff.PlainPassword || staff.passwordHash || staff.PasswordHash || staff.password || staff.Password || 'æœªè®¾ç½®';
                
                // æ˜¾ç¤ºé‚€è¯·ç 
                const inviteCode = staff.inviteCode || '-';
                
                // å®¢æˆ·æ•°
                const customerCount = staff.customerCount || 0;
                
                // åˆ›å»ºæ—¶é—´
                const createdAt = formatDateTime(staff.createdAt);
                
                return `
                    <tr>
                        <td><strong>${account}</strong></td>
                        <td><span class="text-danger">${password}</span></td>
                        <td>
                            <span class="badge bg-primary">${inviteCode}</span>
                        </td>
                        <td>
                            <span class="badge bg-info">${customerCount}</span>
                        </td>
                        <td>${createdAt}</td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <button class="btn btn-outline-primary" onclick="showEditStaffModal('${staff.id}')" title="ç¼–è¾‘">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-${staff.isActive ? 'warning' : 'success'}" 
                                        onclick="toggleStaffStatus('${staff.id}')" 
                                        title="${staff.isActive ? 'ç¦ç”¨' : 'å¯ç”¨'}">
                                    <i class="fas fa-${staff.isActive ? 'ban' : 'check'}"></i>
                                </button>
                                <button class="btn btn-outline-secondary" onclick="showStaffCustomers('${staff.id}')" title="æŸ¥çœ‹å®¢æˆ·">
                                    <i class="fas fa-users"></i>
                                </button>
                                <button class="btn btn-outline-info" onclick="showTransferCustomersOnly('${staff.id}')" title="è½¬ç§»å®¢æˆ·">
                                    <i class="fas fa-exchange-alt"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteStaff('${staff.id}')" title="åˆ é™¤">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // æœç´¢ä¸šåŠ¡å‘˜
        function searchStaff() {
            const searchTerm = document.getElementById('searchStaff').value.toLowerCase();
            const statusFilter = document.getElementById('filterStaffStatus').value;

            let filteredData = staffData;

            // æŒ‰æœç´¢è¯è¿‡æ»¤
            if (searchTerm) {
                filteredData = filteredData.filter(staff => 
                    (staff.nickname || '').toLowerCase().includes(searchTerm) ||
                    (staff.username || '').toLowerCase().includes(searchTerm) ||
                    (staff.inviteCode || '').toLowerCase().includes(searchTerm)
                );
            }

            // æŒ‰çŠ¶æ€è¿‡æ»¤
            if (statusFilter !== '') {
                const isActive = statusFilter === 'active';
                filteredData = filteredData.filter(staff => staff.isActive === isActive);
            }

            // ä¸´æ—¶æ›´æ–°æ•°æ®å¹¶é‡æ–°æ¸²æŸ“
            const originalData = staffData;
            staffData = filteredData;
            renderStaffTable();
            staffData = originalData;
        }

        // ==================== æ”¶æ¬¾è´¦æˆ·ç®¡ç†åŠŸèƒ½ ====================
        
        // æ”¶æ¬¾è´¦æˆ·æ•°æ®
        let paymentAccountsData = [];

        // åŠ è½½æ”¶æ¬¾è´¦æˆ·åˆ—è¡¨
        async function loadPaymentAccounts() {
            try {
                console.log('å¼€å§‹åŠ è½½æ”¶æ¬¾è´¦æˆ·åˆ—è¡¨...');
                
                // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                const userId = currentUser.id || currentUser.Id || '';
                
                console.log('localStorage currentUser:', localStorage.getItem('currentUser'));
                console.log('è§£æåçš„ç”¨æˆ·ä¿¡æ¯:', currentUser);
                console.log('å½“å‰ç”¨æˆ·ID:', userId);
                
                const url = userId ? 
                    `${API_BASE_URL}/api/admin/payment-accounts?userId=${encodeURIComponent(userId)}` : 
                    `${API_BASE_URL}/api/admin/payment-accounts`;
                    
                console.log('è¯·æ±‚URL:', url);
                console.log('API_BASE_URL:', API_BASE_URL);
                
                const response = await fetch(url);
                
                console.log('å“åº”çŠ¶æ€:', response.status, response.statusText);
                console.log('å“åº”å¤´:', [...response.headers.entries()]);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('å“åº”æ•°æ®:', result);
                    if (result && result.success) {
                        paymentAccountsData = result.data || [];
                        console.log('æˆåŠŸåŠ è½½æ”¶æ¬¾è´¦æˆ·æ•°æ®:', paymentAccountsData.length, 'ä¸ªè´¦æˆ·');
                        renderPaymentAccountsTable();
                        updatePaymentAccountStats();
                    } else {
                        throw new Error(result?.message || 'è·å–æ”¶æ¬¾è´¦æˆ·åˆ—è¡¨å¤±è´¥');
                    }
                } else {
                    const errorText = await response.text();
                    console.log('é”™è¯¯å“åº”å†…å®¹:', errorText);
                    throw new Error(`ç½‘ç»œè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                console.error('åŠ è½½æ”¶æ¬¾è´¦æˆ·åˆ—è¡¨å¤±è´¥:', error);
                
                // è®¾ç½®é»˜è®¤ç©ºæ•°æ®
                paymentAccountsData = [];
                
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                document.getElementById('paymentAccountsTableBody').innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-danger">
                            <i class="fas fa-exclamation-triangle"></i> åŠ è½½å¤±è´¥: ${error.message}
                            <br><small class="text-muted">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è”ç³»ç®¡ç†å‘˜</small>
                        </td>
                    </tr>
                `;
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®ä¸º0
                updatePaymentAccountStats();
            }
        }

        // æ¸²æŸ“æ”¶æ¬¾è´¦æˆ·è¡¨æ ¼
        function renderPaymentAccountsTable() {
            const tbody = document.getElementById('paymentAccountsTableBody');
            
            if (paymentAccountsData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-muted">
                            <i class="fas fa-credit-card"></i> æš‚æ— æ”¶æ¬¾è´¦æˆ·æ•°æ®
                            <br><small class="text-muted">ç‚¹å‡»"æ·»åŠ æ”¶æ¬¾è´¦æˆ·"æŒ‰é’®å¼€å§‹æ·»åŠ </small>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = paymentAccountsData.map(account => `
                <tr>
                    <td>${account.walletName || '-'}</td>
                    <td>
                        <span class="badge bg-info">${getCryptoCurrencyText(account.accountType)}</span>
                    </td>
                    <td>
                        <span class="badge bg-secondary">${getNetworkTypeText(account.networkType)}</span>
                    </td>
                    <td>
                        <code class="text-primary">${formatWalletAddress(account.accountNumber)}</code>
                    </td>
                    <td>${account.accountIdentifier || '-'}</td>
                    <td>
                        <span class="status-badge ${account.status === 'enabled' ? 'status-active' : 'status-inactive'}">
                            ${account.status === 'enabled' ? 'å¯ç”¨' : 'ç¦ç”¨'}
                        </span>
                    </td>
                    <td>
                        ${account.isDefault ? '<i class="fas fa-star text-warning" title="é»˜è®¤è´¦æˆ·"></i>' : '-'}
                    </td>
                    <td>${formatDateTime(account.createdAt)}</td>
                    <td>
                        <div class="btn-group btn-group-sm" role="group">
                            <button class="btn btn-outline-primary" onclick="editPaymentAccount('${account.id}')" title="ç¼–è¾‘">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deletePaymentAccount('${account.id}')" title="åˆ é™¤">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // æ›´æ–°æ”¶æ¬¾è´¦æˆ·ç»Ÿè®¡æ•°æ®
        function updatePaymentAccountStats() {
            const total = paymentAccountsData.length;
            const active = paymentAccountsData.filter(account => account.status === 'enabled').length;
            const inactive = paymentAccountsData.filter(account => account.status === 'disabled').length;
            const defaultAccounts = paymentAccountsData.filter(account => account.isDefault).length;
            
            // æ›´æ–°é¡µé¢ä¸Šçš„ç»Ÿè®¡æ˜¾ç¤º
            const totalElement = document.getElementById('totalPaymentAccounts');
            const activeElement = document.getElementById('activePaymentAccounts');
            const inactiveElement = document.getElementById('inactivePaymentAccounts');
            const defaultElement = document.getElementById('defaultPaymentAccounts');
            
            if (totalElement) totalElement.textContent = total;
            if (activeElement) activeElement.textContent = active;
            if (inactiveElement) inactiveElement.textContent = inactive;
            if (defaultElement) defaultElement.textContent = defaultAccounts;
            
            console.log(`æ”¶æ¬¾è´¦æˆ·ç»Ÿè®¡æ›´æ–°: æ€»è´¦æˆ· ${total}, å¯ç”¨ ${active}, ç¦ç”¨ ${inactive}, é»˜è®¤ ${defaultAccounts}`);
        }

        // æœç´¢æ”¶æ¬¾è´¦æˆ·
        function searchPaymentAccounts() {
            const searchTerm = document.getElementById('paymentAccountSearch').value.toLowerCase();
            const statusFilter = document.getElementById('paymentAccountStatusFilter').value;

            let filteredData = paymentAccountsData;

            // æŒ‰æœç´¢è¯è¿‡æ»¤
            if (searchTerm) {
                filteredData = filteredData.filter(account => 
                    (account.walletName || '').toLowerCase().includes(searchTerm) ||
                    (account.accountNumber || '').toLowerCase().includes(searchTerm) ||
                    (account.accountIdentifier || '').toLowerCase().includes(searchTerm)
                );
            }

            // æŒ‰çŠ¶æ€è¿‡æ»¤
            if (statusFilter) {
                filteredData = filteredData.filter(account => account.status === statusFilter);
            }

            // ä¸´æ—¶æ›´æ–°æ•°æ®å¹¶é‡æ–°æ¸²æŸ“
            const originalData = paymentAccountsData;
            paymentAccountsData = filteredData;
            renderPaymentAccountsTable();
            paymentAccountsData = originalData;
        }

        // æ˜¾ç¤ºæ·»åŠ æ”¶æ¬¾è´¦æˆ·æ¨¡æ€æ¡†
        function showAddPaymentAccountModal() {
            // é‡ç½®è¡¨å•
            document.getElementById('paymentAccountForm').reset();
            document.getElementById('paymentAccountId').value = '';
            
            // æ˜¾ç¤ºæ·»åŠ æ ‡é¢˜ï¼Œéšè—ç¼–è¾‘æ ‡é¢˜
            document.getElementById('addPaymentAccountTitle').style.display = 'inline';
            document.getElementById('editPaymentAccountTitle').style.display = 'none';
            
            // é‡ç½®ç½‘ç»œç±»å‹é€‰é¡¹
            document.getElementById('networkType').innerHTML = '<option value="">è¯·å…ˆé€‰æ‹©æ•°å­—è´§å¸ç±»å‹</option>';
            
            // é‡ç½®åœ°å€æ ¼å¼æç¤º
            document.getElementById('addressFormatHint').textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€';
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            const modal = new bootstrap.Modal(document.getElementById('paymentAccountModal'));
            modal.show();
        }

        // ç¼–è¾‘æ”¶æ¬¾è´¦æˆ·
        function editPaymentAccount(accountId) {
            const account = paymentAccountsData.find(a => a.id === accountId);
            if (!account) {
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'æ”¶æ¬¾è´¦æˆ·ä¸å­˜åœ¨',
                    icon: 'error'
                });
                return;
            }

            // å¡«å……è¡¨å•æ•°æ®
            document.getElementById('paymentAccountId').value = account.id;
            document.getElementById('walletName').value = account.walletName || '';
            document.getElementById('accountType').value = account.accountType || '';
            document.getElementById('accountNumber').value = account.accountNumber || '';
            document.getElementById('accountIdentifier').value = account.accountIdentifier || '';
            document.getElementById('accountStatus').value = account.status || 'enabled';
            document.getElementById('isDefault').checked = account.isDefault || false;
            document.getElementById('remarks').value = account.remarks || '';
            
            // æ›´æ–°ç½‘ç»œç±»å‹é€‰é¡¹
            updateNetworkOptions();
            document.getElementById('networkType').value = account.networkType || '';
            
            // æ›´æ–°åœ°å€æ ¼å¼æç¤º
            updateAddressFormatHint();
            
            // æ˜¾ç¤ºç¼–è¾‘æ ‡é¢˜ï¼Œéšè—æ·»åŠ æ ‡é¢˜
            document.getElementById('addPaymentAccountTitle').style.display = 'none';
            document.getElementById('editPaymentAccountTitle').style.display = 'inline';
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            const modal = new bootstrap.Modal(document.getElementById('paymentAccountModal'));
            modal.show();
        }

        // ä¿å­˜æ”¶æ¬¾è´¦æˆ·
        async function savePaymentAccount() {
            const form = document.getElementById('paymentAccountForm');
            const formData = new FormData(form);
            
            // éªŒè¯å¿…å¡«å­—æ®µ
            const walletName = formData.get('walletName');
            const accountType = formData.get('accountType');
            const networkType = formData.get('networkType');
            const accountNumber = formData.get('accountNumber');
            const status = formData.get('status');
            
            if (!walletName || !accountType || !networkType || !accountNumber || !status) {
                Swal.fire({
                    title: 'è¯·å¡«å†™å¿…å¡«å­—æ®µ',
                    text: 'é’±åŒ…åç§°ã€æ•°å­—è´§å¸ç±»å‹ã€ç½‘ç»œç±»å‹ã€é’±åŒ…åœ°å€å’ŒçŠ¶æ€ä¸ºå¿…å¡«é¡¹',
                    icon: 'warning'
                });
                return;
            }
            
            // éªŒè¯é’±åŒ…åœ°å€æ ¼å¼
            if (!validateWalletAddress(accountNumber, accountType)) {
                Swal.fire({
                    title: 'é’±åŒ…åœ°å€æ ¼å¼ä¸æ­£ç¡®',
                    text: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€',
                    icon: 'warning'
                });
                return;
            }
            
            // æ„å»ºè¯·æ±‚æ•°æ®
            const accountData = {
                walletName: walletName,
                accountType: accountType,
                networkType: networkType,
                accountNumber: accountNumber,
                accountIdentifier: formData.get('accountIdentifier') || '',
                status: status,
                isDefault: formData.get('isDefault') === 'on',
                remarks: formData.get('remarks') || ''
            };
            
            const accountId = formData.get('id');
            const isEdit = accountId && accountId !== '';
            
            try {
                Swal.fire({
                    title: isEdit ? 'æ­£åœ¨æ›´æ–°æ”¶æ¬¾è´¦æˆ·' : 'æ­£åœ¨æ·»åŠ æ”¶æ¬¾è´¦æˆ·',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });
                
                // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                const userId = currentUser.id || currentUser.Id || '';
                
                const baseUrl = isEdit ? 
                    `${API_BASE_URL}/api/admin/payment-accounts/${accountId}` : 
                    `${API_BASE_URL}/api/admin/payment-accounts`;
                const url = userId ? `${baseUrl}?userId=${encodeURIComponent(userId)}` : baseUrl;
                const method = isEdit ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(accountData)
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.message || (isEdit ? 'æ›´æ–°å¤±è´¥' : 'æ·»åŠ å¤±è´¥'));
                }
                
                // å…³é—­æ¨¡æ€æ¡†
                bootstrap.Modal.getInstance(document.getElementById('paymentAccountModal')).hide();
                
                // é‡æ–°åŠ è½½æ”¶æ¬¾è´¦æˆ·åˆ—è¡¨
                await loadPaymentAccounts();
                
                Swal.fire({
                    title: isEdit ? 'æ›´æ–°æˆåŠŸ' : 'æ·»åŠ æˆåŠŸ',
                    text: `æ”¶æ¬¾è´¦æˆ· "${walletName}" ${isEdit ? 'å·²æ›´æ–°' : 'å·²æ·»åŠ '}`,
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
                
            } catch (error) {
                console.error('ä¿å­˜æ”¶æ¬¾è´¦æˆ·å¤±è´¥:', error);
                Swal.fire({
                    title: isEdit ? 'æ›´æ–°å¤±è´¥' : 'æ·»åŠ å¤±è´¥',
                    text: error.message,
                    icon: 'error'
                });
            }
        }

        // åˆ é™¤æ”¶æ¬¾è´¦æˆ·
        function deletePaymentAccount(accountId) {
            const account = paymentAccountsData.find(a => a.id === accountId);
            if (!account) {
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'æ”¶æ¬¾è´¦æˆ·ä¸å­˜åœ¨',
                    icon: 'error'
                });
                return;
            }

            Swal.fire({
                title: 'ç¡®è®¤åˆ é™¤',
                html: `
                    <div class="text-center">
                        <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                        <p>ç¡®å®šè¦åˆ é™¤æ”¶æ¬¾è´¦æˆ· <strong>"${account.walletName}"</strong> å—ï¼Ÿ</p>
                        <p class="text-muted">æ­¤æ“ä½œä¸å¯æ’¤é”€</p>
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'ç¡®å®šåˆ é™¤',
                cancelButtonText: 'å–æ¶ˆ'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        Swal.fire({
                            title: 'æ­£åœ¨åˆ é™¤æ”¶æ¬¾è´¦æˆ·',
                            allowOutsideClick: false,
                            didOpen: () => {
                                Swal.showLoading();
                            }
                        });

                        // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
                        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                        const userId = currentUser.id || currentUser.Id || '';
                        
                        const baseUrl = `${API_BASE_URL}/api/admin/payment-accounts/${accountId}`;
                        const url = userId ? `${baseUrl}?userId=${encodeURIComponent(userId)}` : baseUrl;
                        
                        const response = await fetch(url, {
                            method: 'DELETE'
                        });

                        const result = await response.json();

                        if (!response.ok) {
                            throw new Error(result.message || 'åˆ é™¤å¤±è´¥');
                        }

                        // é‡æ–°åŠ è½½æ”¶æ¬¾è´¦æˆ·åˆ—è¡¨
                        await loadPaymentAccounts();

                        Swal.fire({
                            title: 'åˆ é™¤æˆåŠŸ',
                            text: `æ”¶æ¬¾è´¦æˆ· "${account.walletName}" å·²åˆ é™¤`,
                            icon: 'success',
                            timer: 2000,
                            showConfirmButton: false
                        });

                    } catch (error) {
                        console.error('åˆ é™¤æ”¶æ¬¾è´¦æˆ·å¤±è´¥:', error);
                        Swal.fire({
                            title: 'åˆ é™¤å¤±è´¥',
                            text: error.message,
                            icon: 'error'
                        });
                    }
                }
            });
        }

        // åˆ‡æ¢ä¸šåŠ¡å‘˜çŠ¶æ€
        function toggleStaffStatus(staffId) {
            const staff = staffData.find(s => s.id === staffId);
            if (!staff) {
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'ä¸šåŠ¡å‘˜ä¸å­˜åœ¨',
                    icon: 'error'
                });
                return;
            }

            const newStatus = !staff.isActive;
            const actionText = newStatus ? 'å¯ç”¨' : 'ç¦ç”¨';

            Swal.fire({
                title: `ç¡®è®¤${actionText}`,
                html: `
                    <div class="text-center">
                        <div class="mb-3">
                            <i class="fas fa-user-tie fa-3x text-primary"></i>
                        </div>
                        <p><strong>${staff.name}</strong></p>
                        <p class="text-muted">è´¦å·: ${staff.username}</p>
                        <p>ç¡®å®šè¦${actionText}è¿™ä¸ªä¸šåŠ¡å‘˜å—ï¼Ÿ</p>
                    </div>
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: `ç¡®å®š${actionText}`,
                cancelButtonText: 'å–æ¶ˆ',
                confirmButtonColor: newStatus ? '#28a745' : '#ffc107'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        Swal.fire({
                            title: `${actionText}ä¸­...`,
                            text: `æ­£åœ¨${actionText}ä¸šåŠ¡å‘˜`,
                            allowOutsideClick: false,
                            didOpen: () => {
                                Swal.showLoading();
                            }
                        });

                        const response = await fetch(`${API_BASE_URL}/api/salesperson/update/${staffId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                name: staff.name,
                                phone: staff.phone,
                                email: staff.email,
                                department: staff.department,
                                inviteCode: staff.inviteCode,
                                status: newStatus ? 'active' : 'inactive'
                            })
                        });

                        let result = { success: false, message: 'å“åº”è§£æå¤±è´¥' };
                        try {
                            const responseText = await response.text();
                            if (responseText.trim()) {
                                result = JSON.parse(responseText);
                            }
                        } catch (error) {
                            console.error('è§£æçŠ¶æ€æ›´æ–°å“åº”JSONå¤±è´¥:', error);
                            throw new Error('æœåŠ¡å™¨å“åº”æ ¼å¼é”™è¯¯');
                        }

                        if (response.ok && result.success) {
                            await loadStaffList();
                            Swal.fire({
                                title: `${actionText}æˆåŠŸ`,
                                text: `ä¸šåŠ¡å‘˜å·²${actionText}`,
                                icon: 'success',
                                timer: 1500,
                                showConfirmButton: false
                            });
                        } else {
                            throw new Error(result.message || `${actionText}å¤±è´¥`);
                        }
                    } catch (error) {
                        console.error(`${actionText}ä¸šåŠ¡å‘˜å¤±è´¥:`, error);
                        Swal.fire({
                            title: `${actionText}å¤±è´¥`,
                            text: error.message,
                            icon: 'error'
                        });
                    }
                }
            });
        }

        // åˆ é™¤ä¸šåŠ¡å‘˜
        async function deleteStaff(staffId) {
            const staff = staffData.find(s => s.id === staffId);
            if (!staff) {
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'ä¸šåŠ¡å‘˜ä¸å­˜åœ¨',
                    icon: 'error'
                });
                return;
            }

            // ç¬¬ä¸€æ¬¡ç¡®è®¤ - æ˜¾ç¤ºä¸šåŠ¡å‘˜ä¿¡æ¯å’Œè­¦å‘Š
            Swal.fire({
                title: 'ç¡®è®¤åˆ é™¤ä¸šåŠ¡å‘˜',
                html: `
                    <div class="text-center">
                        <div class="mb-3">
                            <i class="fas fa-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                        </div>
                        <p><strong>ä¸šåŠ¡å‘˜ä¿¡æ¯ï¼š</strong></p>
                        <p>ID: <span class="badge bg-light text-dark">${staff.id}</span></p>
                        <p>è´¦å·: <strong>${staff.username || 'æœªè®¾ç½®'}</strong></p>
                        <p>æ˜µç§°: <strong>${staff.nickname || 'æœªè®¾ç½®'}</strong></p>
                        <p>é‚€è¯·ç : <strong>${staff.inviteCode || 'æœªè®¾ç½®'}</strong></p>
                        <p>çŠ¶æ€: <span class="badge ${staff.isActive ? 'bg-success' : 'bg-secondary'}">${staff.isActive ? 'æ´»è·ƒ' : 'éæ´»è·ƒ'}</span></p>
                        <div class="alert alert-warning mt-3">
                            <strong>æ³¨æ„ï¼š</strong>åˆ é™¤ä¸šåŠ¡å‘˜å¯èƒ½ä¼šå½±å“ç›¸å…³å®¢æˆ·æ•°æ®ï¼<br>
                            å¦‚æœè¯¥ä¸šåŠ¡å‘˜æœ‰å®¢æˆ·ï¼Œç³»ç»Ÿä¼šè¦æ±‚è½¬ç§»å®¢æˆ·ã€‚
                        </div>
                        <p class="text-danger">ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¸šåŠ¡å‘˜å—ï¼Ÿ</p>
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'ç¡®è®¤åˆ é™¤',
                cancelButtonText: 'å–æ¶ˆ',
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    // ç¬¬äºŒæ¬¡ç¡®è®¤ - æœ€ç»ˆç¡®è®¤
                    Swal.fire({
                        title: 'æœ€ç»ˆç¡®è®¤',
                        html: `
                            <div class="text-center">
                                <div class="mb-3">
                                    <i class="fas fa-exclamation-circle text-danger" style="font-size: 3rem;"></i>
                                </div>
                                <p class="text-danger"><strong>è¿™æ˜¯æœ€åä¸€æ¬¡ç¡®è®¤ï¼</strong></p>
                                <p>æ‚¨å³å°†åˆ é™¤ä¸šåŠ¡å‘˜ï¼š<strong>${staff.nickname || staff.username}</strong></p>
                                <div class="alert alert-danger mt-3">
                                    <strong>è­¦å‘Šï¼š</strong>æ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼
                                </div>
                                <p>ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ</p>
                            </div>
                        `,
                        icon: 'error',
                        showCancelButton: true,
                        confirmButtonText: 'ç¡®å®šåˆ é™¤',
                        cancelButtonText: 'å–æ¶ˆ',
                        confirmButtonColor: '#dc3545',
                        cancelButtonColor: '#6c757d'
                    }).then(async (finalResult) => {
                        if (finalResult.isConfirmed) {
                            await performStaffDeletion(staffId);
                        }
                    });
                }
            });
        }

        // æ‰§è¡Œä¸šåŠ¡å‘˜åˆ é™¤æ“ä½œ
        async function performStaffDeletion(staffId) {
            try {
                Swal.fire({
                    title: 'åˆ é™¤ä¸­...',
                    text: 'æ­£åœ¨åˆ é™¤ä¸šåŠ¡å‘˜',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                // å…ˆå°è¯•åˆ é™¤ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å®¢æˆ·
                const response = await fetch(`${API_BASE_URL}/api/salesperson/delete/${staffId}`, {
                    method: 'DELETE'
                });

                let result = { success: false, message: 'å“åº”è§£æå¤±è´¥' };
                try {
                    const responseText = await response.text();
                    if (responseText.trim()) {
                        result = JSON.parse(responseText);
                    }
                } catch (error) {
                    console.error('è§£æåˆ é™¤å“åº”JSONå¤±è´¥:', error);
                    throw new Error('æœåŠ¡å™¨å“åº”æ ¼å¼é”™è¯¯');
                }

                if (response.ok) {
                    // åˆ é™¤æˆåŠŸ
                    await loadStaffList();
                    Swal.fire({
                        title: 'åˆ é™¤æˆåŠŸ',
                        text: 'ä¸šåŠ¡å‘˜å·²æˆåŠŸåˆ é™¤',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } else if (result.hasCustomers) {
                    // æœ‰å®¢æˆ·éœ€è¦è½¬ç§»
                    showTransferCustomersDialog(result);
                } else {
                    throw new Error(result.message || 'åˆ é™¤å¤±è´¥');
                }
            } catch (error) {
                console.error('åˆ é™¤ä¸šåŠ¡å‘˜å¤±è´¥:', error);
                Swal.fire({
                    title: 'åˆ é™¤å¤±è´¥',
                    text: error.message,
                    icon: 'error'
                });
            }
        }

        // æ˜¾ç¤ºå®¢æˆ·è½¬ç§»å¯¹è¯æ¡†
        async function showTransferCustomersDialog(deleteResult) {
            const { salesperson, customers, customerCount } = deleteResult;
            
            // è·å–å…¶ä»–ä¸šåŠ¡å‘˜åˆ—è¡¨ï¼ˆæ’é™¤å½“å‰è¦åˆ é™¤çš„ä¸šåŠ¡å‘˜ï¼‰
            const otherStaff = staffData.filter(s => s.id !== salesperson.id && s.isActive);
            
            if (otherStaff.length === 0) {
                Swal.fire({
                    title: 'æ— æ³•åˆ é™¤',
                    text: 'æ²¡æœ‰å…¶ä»–å¯ç”¨çš„ä¸šåŠ¡å‘˜æ¥æ¥æ”¶å®¢æˆ·ï¼Œè¯·å…ˆæ·»åŠ å…¶ä»–ä¸šåŠ¡å‘˜',
                    icon: 'warning'
                });
                return;
            }

            const staffOptions = otherStaff.map(s => 
                `<option value="${s.id}">${s.nickname} (${s.username}) - é‚€è¯·ç : ${s.inviteCode}</option>`
            ).join('');

            const customerList = customers.map(c => 
                `<tr>
                    <td>${c.username}</td>
                    <td>${c.email}</td>
                    <td><span class="badge bg-secondary">${c.inviteCode}</span></td>
                </tr>`
            ).join('');

            const { value: targetStaffId } = await Swal.fire({
                title: 'å®¢æˆ·è½¬ç§»',
                html: `
                    <div class="text-start">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            ä¸šåŠ¡å‘˜ <strong>${salesperson.nickname}</strong> è¿˜æœ‰ <strong>${customerCount}</strong> ä¸ªå®¢æˆ·ï¼Œéœ€è¦å…ˆè½¬ç§»å®¢æˆ·æ‰èƒ½åˆ é™¤ã€‚
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">é€‰æ‹©ç›®æ ‡ä¸šåŠ¡å‘˜ï¼š</label>
                            <select id="targetStaff" class="form-select">
                                <option value="">è¯·é€‰æ‹©ä¸šåŠ¡å‘˜</option>
                                ${staffOptions}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">å®¢æˆ·åˆ—è¡¨é¢„è§ˆï¼š</label>
                            <div style="max-height: 200px; overflow-y: auto;">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>ç”¨æˆ·å</th>
                                            <th>é‚®ç®±</th>
                                            <th>å½“å‰é‚€è¯·ç </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${customerList}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            è½¬ç§»åï¼Œæ‰€æœ‰å®¢æˆ·çš„é‚€è¯·ç å°†æ›´æ–°ä¸ºç›®æ ‡ä¸šåŠ¡å‘˜çš„é‚€è¯·ç ã€‚
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'ç¡®è®¤è½¬ç§»å¹¶åˆ é™¤',
                cancelButtonText: 'å–æ¶ˆ',
                confirmButtonColor: '#dc3545',
                width: '600px',
                preConfirm: () => {
                    const targetStaffId = document.getElementById('targetStaff').value;
                    if (!targetStaffId) {
                        Swal.showValidationMessage('è¯·é€‰æ‹©ç›®æ ‡ä¸šåŠ¡å‘˜');
                        return false;
                    }
                    return targetStaffId;
                }
            });

            if (targetStaffId) {
                await transferAndDeleteStaff(salesperson.id, targetStaffId);
            }
        }

        // è½¬ç§»å®¢æˆ·å¹¶åˆ é™¤ä¸šåŠ¡å‘˜
        async function transferAndDeleteStaff(sourceStaffId, targetStaffId) {
            try {
                Swal.fire({
                    title: 'è½¬ç§»ä¸­...',
                    text: 'æ­£åœ¨è½¬ç§»å®¢æˆ·å¹¶åˆ é™¤ä¸šåŠ¡å‘˜',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                // 1. è½¬ç§»å®¢æˆ·
                const transferResponse = await fetch(`${API_BASE_URL}/api/salesperson/transfer-customers`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sourceSalespersonId: sourceStaffId,
                        targetSalespersonId: targetStaffId
                    })
                });

                let transferResult = { success: false, message: 'è½¬ç§»å“åº”è§£æå¤±è´¥' };
                try {
                    const transferText = await transferResponse.text();
                    if (transferText.trim()) {
                        transferResult = JSON.parse(transferText);
                    }
                } catch (error) {
                    console.error('è§£æè½¬ç§»å“åº”JSONå¤±è´¥:', error);
                    throw new Error('è½¬ç§»å“åº”æ ¼å¼é”™è¯¯');
                }

                if (!transferResponse.ok) {
                    throw new Error(transferResult.message || 'å®¢æˆ·è½¬ç§»å¤±è´¥');
                }

                // 2. å¼ºåˆ¶åˆ é™¤ä¸šåŠ¡å‘˜
                const deleteResponse = await fetch(`${API_BASE_URL}/api/salesperson/delete/${sourceStaffId}?force=true`, {
                    method: 'DELETE'
                });

                let deleteResult = { success: false, message: 'åˆ é™¤å“åº”è§£æå¤±è´¥' };
                try {
                    const deleteText = await deleteResponse.text();
                    if (deleteText.trim()) {
                        deleteResult = JSON.parse(deleteText);
                    }
                } catch (error) {
                    console.error('è§£æåˆ é™¤å“åº”JSONå¤±è´¥:', error);
                    throw new Error('åˆ é™¤å“åº”æ ¼å¼é”™è¯¯');
                }

                if (!deleteResponse.ok) {
                    throw new Error(deleteResult.message || 'åˆ é™¤ä¸šåŠ¡å‘˜å¤±è´¥');
                }

                // 3. åˆ·æ–°åˆ—è¡¨
                await loadStaffList();

                Swal.fire({
                    title: 'æ“ä½œæˆåŠŸ',
                    html: `
                        <div class="text-center">
                            <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                            <p>å·²æˆåŠŸè½¬ç§» <strong>${transferResult.transferredCount}</strong> ä¸ªå®¢æˆ·åˆ°ä¸šåŠ¡å‘˜ <strong>${transferResult.targetSalesperson.nickname}</strong></p>
                            <p>ä¸šåŠ¡å‘˜å·²åˆ é™¤</p>
                        </div>
                    `,
                    icon: 'success',
                    timer: 3000,
                    showConfirmButton: false
                });

            } catch (error) {
                console.error('è½¬ç§»å’Œåˆ é™¤æ“ä½œå¤±è´¥:', error);
                Swal.fire({
                    title: 'æ“ä½œå¤±è´¥',
                    text: error.message,
                    icon: 'error'
                });
            }
        }

        // æ˜¾ç¤ºç‹¬ç«‹çš„å®¢æˆ·è½¬ç§»å¯¹è¯æ¡†ï¼ˆä¸åˆ é™¤ä¸šåŠ¡å‘˜ï¼‰
        async function showTransferCustomersOnly(staffId) {
            const staff = staffData.find(s => s.id === staffId);
            if (!staff) {
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'ä¸šåŠ¡å‘˜ä¸å­˜åœ¨',
                    icon: 'error'
                });
                return;
            }

            try {
                // è·å–è¯¥ä¸šåŠ¡å‘˜çš„å®¢æˆ·åˆ—è¡¨
                const response = await fetch(`${API_BASE_URL}/api/salesperson/customers/${staffId}`);
                
                if (!response.ok) {
                    throw new Error('è·å–å®¢æˆ·åˆ—è¡¨å¤±è´¥');
                }
                
                let customers = [];
                try {
                    const responseText = await response.text();
                    if (responseText.trim()) {
                        const data = JSON.parse(responseText);
                        // æ­£ç¡®è§£æAPIè¿”å›çš„æ•°æ®æ ¼å¼
                        customers = data.customers || [];
                    }
                } catch (error) {
                    console.error('è§£æå®¢æˆ·åˆ—è¡¨JSONå¤±è´¥:', error);
                    customers = [];
                }

                if (!customers || customers.length === 0) {
                    Swal.fire({
                        title: 'æç¤º',
                        text: 'è¯¥ä¸šåŠ¡å‘˜æ²¡æœ‰åˆ†é…çš„å®¢æˆ·',
                        icon: 'info'
                    });
                    return;
                }

                // è·å–å…¶ä»–ä¸šåŠ¡å‘˜åˆ—è¡¨ï¼ˆæ’é™¤å½“å‰ä¸šåŠ¡å‘˜ï¼‰
                const otherStaff = staffData.filter(s => s.id !== staffId && s.isActive);
                
                if (otherStaff.length === 0) {
                    Swal.fire({
                        title: 'æ— æ³•è½¬ç§»',
                        text: 'æ²¡æœ‰å…¶ä»–å¯ç”¨çš„ä¸šåŠ¡å‘˜æ¥æ¥æ”¶å®¢æˆ·',
                        icon: 'warning'
                    });
                    return;
                }

                const staffOptions = otherStaff.map(s => 
                    `<option value="${s.id}">${s.nickname} (${s.username}) - é‚€è¯·ç : ${s.inviteCode}</option>`
                ).join('');

                const customerList = customers.map(c => 
                    `<tr>
                        <td>${c.username}</td>
                        <td>${c.email}</td>
                        <td><span class="badge bg-secondary">${c.inviteCode}</span></td>
                    </tr>`
                ).join('');

                const { value: targetStaffId } = await Swal.fire({
                    title: 'è½¬ç§»å®¢æˆ·',
                    html: `
                        <div class="text-start">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                å°†ä¸šåŠ¡å‘˜ <strong>${staff.nickname}</strong> çš„ <strong>${customers.length}</strong> ä¸ªå®¢æˆ·è½¬ç§»ç»™å…¶ä»–ä¸šåŠ¡å‘˜ã€‚
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">é€‰æ‹©ç›®æ ‡ä¸šåŠ¡å‘˜ï¼š</label>
                                <select id="targetStaffTransfer" class="form-select">
                                    <option value="">è¯·é€‰æ‹©ä¸šåŠ¡å‘˜</option>
                                    ${staffOptions}
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">å®¢æˆ·åˆ—è¡¨ï¼š</label>
                                <div style="max-height: 200px; overflow-y: auto;">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>ç”¨æˆ·å</th>
                                                <th>é‚®ç®±</th>
                                                <th>å½“å‰é‚€è¯·ç </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${customerList}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                è½¬ç§»åï¼Œæ‰€æœ‰å®¢æˆ·çš„é‚€è¯·ç å°†æ›´æ–°ä¸ºç›®æ ‡ä¸šåŠ¡å‘˜çš„é‚€è¯·ç ã€‚
                            </div>
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: 'ç¡®è®¤è½¬ç§»',
                    cancelButtonText: 'å–æ¶ˆ',
                    confirmButtonColor: '#007bff',
                    width: '600px',
                    preConfirm: () => {
                        const targetStaffId = document.getElementById('targetStaffTransfer').value;
                        if (!targetStaffId) {
                            Swal.showValidationMessage('è¯·é€‰æ‹©ç›®æ ‡ä¸šåŠ¡å‘˜');
                            return false;
                        }
                        return targetStaffId;
                    }
                });

                if (targetStaffId) {
                    await transferCustomersOnly(staffId, targetStaffId);
                }

            } catch (error) {
                console.error('è·å–å®¢æˆ·åˆ—è¡¨å¤±è´¥:', error);
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'è·å–å®¢æˆ·åˆ—è¡¨å¤±è´¥',
                    icon: 'error'
                });
            }
        }

        // ä»…è½¬ç§»å®¢æˆ·ï¼ˆä¸åˆ é™¤ä¸šåŠ¡å‘˜ï¼‰
        async function transferCustomersOnly(sourceStaffId, targetStaffId) {
            try {
                Swal.fire({
                    title: 'è½¬ç§»ä¸­...',
                    text: 'æ­£åœ¨è½¬ç§»å®¢æˆ·',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                const transferResponse = await fetch(`${API_BASE_URL}/api/salesperson/transfer-customers`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sourceSalespersonId: sourceStaffId,
                        targetSalespersonId: targetStaffId
                    })
                });

                const transferResult = await transferResponse.json();

                if (!transferResponse.ok) {
                    throw new Error(transferResult.message || 'å®¢æˆ·è½¬ç§»å¤±è´¥');
                }

                // åˆ·æ–°åˆ—è¡¨
                await loadStaffList();

                Swal.fire({
                    title: 'è½¬ç§»æˆåŠŸ',
                    html: `
                        <div class="text-center">
                            <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                            <p>å·²æˆåŠŸè½¬ç§» <strong>${transferResult.transferredCount}</strong> ä¸ªå®¢æˆ·åˆ°ä¸šåŠ¡å‘˜ <strong>${transferResult.targetSalesperson.nickname}</strong></p>
                        </div>
                    `,
                    icon: 'success',
                    timer: 3000,
                    showConfirmButton: false
                });

            } catch (error) {
                console.error('å®¢æˆ·è½¬ç§»å¤±è´¥:', error);
                Swal.fire({
                    title: 'è½¬ç§»å¤±è´¥',
                    text: error.message,
                    icon: 'error'
                });
            }
        }

        // å®¢æˆ·åˆ—è¡¨ç›¸å…³å˜é‡
        let currentStaffId = null;
        let allCustomers = [];
        let filteredCustomers = [];
        let selectedCustomers = [];
        let currentPage = 1;
        const customersPerPage = 10;

        // æ˜¾ç¤ºä¸šåŠ¡å‘˜å®¢æˆ·åˆ—è¡¨
        async function showStaffCustomers(staffId) {
            currentStaffId = staffId;
            const staff = staffData.find(s => s.id === staffId);
            if (!staff) {
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'ä¸šåŠ¡å‘˜ä¸å­˜åœ¨',
                    icon: 'error'
                });
                return;
            }

            // æ›´æ–°æ¨¡æ€æ¡†æ ‡é¢˜
            document.getElementById('staffCustomersModalLabel').textContent = `${staff.nickname} çš„å®¢æˆ·åˆ—è¡¨`;

            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                document.getElementById('customersTableBody').innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">åŠ è½½ä¸­...</span>
                            </div>
                            <div class="mt-2">æ­£åœ¨åŠ è½½å®¢æˆ·æ•°æ®...</div>
                        </td>
                    </tr>
                `;

                // è·å–å®¢æˆ·åˆ—è¡¨
                const response = await fetch(`${API_BASE_URL}/api/salesperson/customers/${staffId}`);
                
                if (!response.ok) {
                    throw new Error('è·å–å®¢æˆ·åˆ—è¡¨å¤±è´¥');
                }
                
                let customers = [];
                try {
                    const responseText = await response.text();
                    if (responseText.trim()) {
                        const data = JSON.parse(responseText);
                        // æ­£ç¡®è§£æAPIè¿”å›çš„æ•°æ®æ ¼å¼
                        customers = data.customers || [];
                    }
                } catch (error) {
                    console.error('è§£æå®¢æˆ·åˆ—è¡¨JSONå¤±è´¥:', error);
                    customers = [];
                }

                allCustomers = customers || [];
                filteredCustomers = [...allCustomers];
                selectedCustomers = [];
                currentPage = 1;

                // æ›´æ–°å®¢æˆ·æ•°é‡
                updateCustomerCount();

                // æ¸²æŸ“å®¢æˆ·åˆ—è¡¨
                renderCustomersList();

                // åŠ è½½ä¸šåŠ¡å‘˜åˆ—è¡¨ç”¨äºè½¬ç§»
                await loadSalespersonOptions();

                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                const modal = new bootstrap.Modal(document.getElementById('staffCustomersModal'));
                modal.show();

            } catch (error) {
                console.error('è·å–å®¢æˆ·åˆ—è¡¨å¤±è´¥:', error);
                Swal.fire({
                    title: 'è·å–å¤±è´¥',
                    text: error.message,
                    icon: 'error'
                });
            }
        }

        // æ¸²æŸ“å®¢æˆ·åˆ—è¡¨
        function renderCustomersList() {
            const tbody = document.getElementById('customersTableBody');
            
            if (filteredCustomers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center text-muted">
                            <i class="fas fa-users fa-2x mb-2"></i>
                            <div>æš‚æ— å®¢æˆ·æ•°æ®</div>
                        </td>
                    </tr>
                `;
                return;
            }

            // è®¡ç®—åˆ†é¡µ
            const startIndex = (currentPage - 1) * customersPerPage;
            const endIndex = startIndex + customersPerPage;
            const pageCustomers = filteredCustomers.slice(startIndex, endIndex);

            tbody.innerHTML = pageCustomers.map(customer => `
                <tr>
                    <td>
                        <input type="checkbox" class="customer-checkbox" value="${customer.id}" 
                               onchange="toggleCustomerSelection('${customer.id}')">
                    </td>
                    <td>${customer.username || '-'}</td>
                    <td>${customer.nickname || '-'}</td>
                    <td>${customer.email || '-'}</td>
                    <td>
                        <code class="text-primary">${customer.inviteCode || '-'}</code>
                    </td>
                    <td>
                        <span class="badge ${customer.isActive ? 'bg-success' : 'bg-secondary'}">
                            ${customer.isActive ? 'æ­£å¸¸' : 'ç¦ç”¨'}
                        </span>
                    </td>
                    <td>${formatDateTime(customer.createdAt)}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" 
                                onclick="showSingleTransferModal('${customer.id}')" 
                                title="è½¬ç§»å®¢æˆ·">
                            <i class="fas fa-exchange-alt"></i>
                        </button>
                    </td>
                </tr>
            `).join('');

            // æ›´æ–°åˆ†é¡µ
            renderPagination();
        }

        // æ¸²æŸ“åˆ†é¡µ
        function renderPagination() {
            const totalPages = Math.ceil(filteredCustomers.length / customersPerPage);
            const pagination = document.getElementById('customersPagination');
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'block';
            const ul = pagination.querySelector('ul');
            
            let paginationHTML = '';
            
            // ä¸Šä¸€é¡µ
            paginationHTML += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">ä¸Šä¸€é¡µ</a>
                </li>
            `;
            
            // é¡µç 
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHTML += `
                        <li class="page-item ${i === currentPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
            }
            
            // ä¸‹ä¸€é¡µ
            paginationHTML += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">ä¸‹ä¸€é¡µ</a>
                </li>
            `;
            
            ul.innerHTML = paginationHTML;
        }

        // åˆ‡æ¢é¡µé¢
        function changePage(page) {
            const totalPages = Math.ceil(filteredCustomers.length / customersPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderCustomersList();
        }

        // æœç´¢å®¢æˆ·
        function searchCustomers() {
            const searchTerm = document.getElementById('searchCustomers').value.toLowerCase();
            const statusFilter = document.getElementById('filterCustomerStatus').value;

            filteredCustomers = allCustomers.filter(customer => {
                // æœç´¢è¿‡æ»¤
                const matchesSearch = !searchTerm || 
                    (customer.username || '').toLowerCase().includes(searchTerm) ||
                    (customer.nickname || '').toLowerCase().includes(searchTerm) ||
                    (customer.email || '').toLowerCase().includes(searchTerm);

                // çŠ¶æ€è¿‡æ»¤
                const matchesStatus = !statusFilter || 
                    (statusFilter === 'active' && customer.isActive) ||
                    (statusFilter === 'inactive' && !customer.isActive);

                return matchesSearch && matchesStatus;
            });

            currentPage = 1;
            selectedCustomers = [];
            updateCustomerCount();
            updateBatchTransferButton();
            renderCustomersList();
        }

        // æ›´æ–°å®¢æˆ·æ•°é‡æ˜¾ç¤º
        function updateCustomerCount() {
            document.getElementById('customerCount').textContent = filteredCustomers.length;
        }

        // åˆ‡æ¢å®¢æˆ·é€‰æ‹©
        function toggleCustomerSelection(customerId) {
            const checkbox = document.querySelector(`input[value="${customerId}"]`);
            if (checkbox.checked) {
                if (!selectedCustomers.includes(customerId)) {
                    selectedCustomers.push(customerId);
                }
            } else {
                selectedCustomers = selectedCustomers.filter(id => id !== customerId);
            }
            
            updateSelectAllCheckbox();
            updateBatchTransferButton();
        }

        // åˆ‡æ¢å…¨é€‰
        function toggleSelectAllCustomers() {
            const selectAllCheckbox = document.getElementById('selectAllCustomers');
            const customerCheckboxes = document.querySelectorAll('.customer-checkbox');
            
            if (selectAllCheckbox.checked) {
                customerCheckboxes.forEach(checkbox => {
                    checkbox.checked = true;
                    const customerId = checkbox.value;
                    if (!selectedCustomers.includes(customerId)) {
                        selectedCustomers.push(customerId);
                    }
                });
            } else {
                customerCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                selectedCustomers = [];
            }
            
            updateBatchTransferButton();
        }

        // æ›´æ–°å…¨é€‰å¤é€‰æ¡†çŠ¶æ€
        function updateSelectAllCheckbox() {
            const selectAllCheckbox = document.getElementById('selectAllCustomers');
            const customerCheckboxes = document.querySelectorAll('.customer-checkbox');
            const checkedCount = document.querySelectorAll('.customer-checkbox:checked').length;
            
            if (checkedCount === 0) {
                selectAllCheckbox.indeterminate = false;
                selectAllCheckbox.checked = false;
            } else if (checkedCount === customerCheckboxes.length) {
                selectAllCheckbox.indeterminate = false;
                selectAllCheckbox.checked = true;
            } else {
                selectAllCheckbox.indeterminate = true;
                selectAllCheckbox.checked = false;
            }
        }

        // æ›´æ–°æ‰¹é‡è½¬ç§»æŒ‰é’®çŠ¶æ€
        function updateBatchTransferButton() {
            const batchTransferBtn = document.getElementById('batchTransferBtn');
            batchTransferBtn.disabled = selectedCustomers.length === 0;
            batchTransferBtn.innerHTML = selectedCustomers.length > 0 
                ? `<i class="fas fa-exchange-alt"></i> æ‰¹é‡è½¬ç§» (${selectedCustomers.length})`
                : `<i class="fas fa-exchange-alt"></i> æ‰¹é‡è½¬ç§»`;
        }

        // åŠ è½½ä¸šåŠ¡å‘˜é€‰é¡¹
        async function loadSalespersonOptions() {
            try {
                const selects = [
                    document.getElementById('targetSalespersonSelect'),
                    document.getElementById('batchTargetSalespersonSelect')
                ];

                const options = staffData
                    .filter(staff => staff.id !== currentStaffId && staff.isActive)
                    .map(staff => `<option value="${staff.id}">${staff.nickname} (${staff.username})</option>`)
                    .join('');

                selects.forEach(select => {
                    select.innerHTML = '<option value="">è¯·é€‰æ‹©ç›®æ ‡ä¸šåŠ¡å‘˜</option>' + options;
                });

            } catch (error) {
                console.error('åŠ è½½ä¸šåŠ¡å‘˜é€‰é¡¹å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºå•ä¸ªå®¢æˆ·è½¬ç§»æ¨¡æ€æ¡†
        function showSingleTransferModal(customerId) {
            const customer = allCustomers.find(c => c.id === customerId);
            if (!customer) return;

            document.getElementById('transferCustomerInfo').innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <strong>ç”¨æˆ·å:</strong> ${customer.username || '-'}
                    </div>
                    <div class="col-md-6">
                        <strong>æ˜µç§°:</strong> ${customer.nickname || '-'}
                    </div>
                    <div class="col-md-6">
                        <strong>é‚®ç®±:</strong> ${customer.email || '-'}
                    </div>
                    <div class="col-md-6">
                        <strong>å½“å‰é‚€è¯·ç :</strong> <code class="text-primary">${customer.inviteCode || '-'}</code>
                    </div>
                </div>
            `;

            // å­˜å‚¨å½“å‰è½¬ç§»çš„å®¢æˆ·ID
            document.getElementById('transferSingleCustomerModal').setAttribute('data-customer-id', customerId);

            const modal = new bootstrap.Modal(document.getElementById('transferSingleCustomerModal'));
            modal.show();
        }

        // ç¡®è®¤å•ä¸ªå®¢æˆ·è½¬ç§»
        async function confirmSingleTransfer() {
            const customerId = document.getElementById('transferSingleCustomerModal').getAttribute('data-customer-id');
            const targetSalespersonId = document.getElementById('targetSalespersonSelect').value;

            if (!targetSalespersonId) {
                Swal.fire({
                    title: 'è¯·é€‰æ‹©ç›®æ ‡ä¸šåŠ¡å‘˜',
                    icon: 'warning'
                });
                return;
            }

            try {
                Swal.fire({
                    title: 'æ­£åœ¨è½¬ç§»å®¢æˆ·',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                const response = await fetch(`${API_BASE_URL}/api/salesperson/transfer-customers`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sourceSalespersonId: currentStaffId,
                        targetSalespersonId: targetSalespersonId,
                        customerIds: [customerId]
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'è½¬ç§»å¤±è´¥');
                }

                // å…³é—­è½¬ç§»æ¨¡æ€æ¡†
                bootstrap.Modal.getInstance(document.getElementById('transferSingleCustomerModal')).hide();

                // åˆ·æ–°å®¢æˆ·åˆ—è¡¨
                await showStaffCustomers(currentStaffId);

                // åˆ·æ–°ä¸šåŠ¡å‘˜åˆ—è¡¨
                await loadStaffList();

                Swal.fire({
                    title: 'è½¬ç§»æˆåŠŸ',
                    text: `å®¢æˆ·å·²æˆåŠŸè½¬ç§»åˆ° ${result.targetSalesperson.nickname}`,
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });

            } catch (error) {
                console.error('å®¢æˆ·è½¬ç§»å¤±è´¥:', error);
                Swal.fire({
                    title: 'è½¬ç§»å¤±è´¥',
                    text: error.message,
                    icon: 'error'
                });
            }
        }

        // æ˜¾ç¤ºæ‰¹é‡è½¬ç§»æ¨¡æ€æ¡†
        function showBatchTransferModal() {
            if (selectedCustomers.length === 0) {
                Swal.fire({
                    title: 'è¯·é€‰æ‹©è¦è½¬ç§»çš„å®¢æˆ·',
                    icon: 'warning'
                });
                return;
            }

            const selectedCustomerData = allCustomers.filter(c => selectedCustomers.includes(c.id));
            
            document.getElementById('selectedCustomersInfo').innerHTML = `
                <div class="mb-2">
                    <strong>é€‰ä¸­ ${selectedCustomers.length} ä¸ªå®¢æˆ·:</strong>
                </div>
                <div style="max-height: 200px; overflow-y: auto;">
                    ${selectedCustomerData.map(customer => `
                        <div class="border-bottom py-1">
                            <span class="fw-bold">${customer.username}</span> 
                            (${customer.nickname || '-'}) - 
                            <code class="text-primary">${customer.inviteCode || '-'}</code>
                        </div>
                    `).join('')}
                </div>
            `;

            const modal = new bootstrap.Modal(document.getElementById('batchTransferModal'));
            modal.show();
        }

        // ç¡®è®¤æ‰¹é‡è½¬ç§»
        async function confirmBatchTransfer() {
            const targetSalespersonId = document.getElementById('batchTargetSalespersonSelect').value;

            if (!targetSalespersonId) {
                Swal.fire({
                    title: 'è¯·é€‰æ‹©ç›®æ ‡ä¸šåŠ¡å‘˜',
                    icon: 'warning'
                });
                return;
            }

            try {
                Swal.fire({
                    title: 'æ­£åœ¨æ‰¹é‡è½¬ç§»å®¢æˆ·',
                    text: `æ­£åœ¨è½¬ç§» ${selectedCustomers.length} ä¸ªå®¢æˆ·...`,
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                const response = await fetch(`${API_BASE_URL}/api/salesperson/transfer-customers`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sourceSalespersonId: currentStaffId,
                        targetSalespersonId: targetSalespersonId,
                        customerIds: selectedCustomers
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'æ‰¹é‡è½¬ç§»å¤±è´¥');
                }

                // å…³é—­æ‰¹é‡è½¬ç§»æ¨¡æ€æ¡†
                bootstrap.Modal.getInstance(document.getElementById('batchTransferModal')).hide();

                // åˆ·æ–°å®¢æˆ·åˆ—è¡¨
                await showStaffCustomers(currentStaffId);

                // åˆ·æ–°ä¸šåŠ¡å‘˜åˆ—è¡¨
                await loadStaffList();

                Swal.fire({
                    title: 'æ‰¹é‡è½¬ç§»æˆåŠŸ',
                    html: `
                        <div class="text-center">
                            <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                            <p>å·²æˆåŠŸè½¬ç§» <strong>${result.transferredCount}</strong> ä¸ªå®¢æˆ·åˆ°ä¸šåŠ¡å‘˜ <strong>${result.targetSalesperson.nickname}</strong></p>
                        </div>
                    `,
                    icon: 'success',
                    timer: 3000,
                    showConfirmButton: false
                });

            } catch (error) {
                console.error('æ‰¹é‡è½¬ç§»å¤±è´¥:', error);
                Swal.fire({
                    title: 'æ‰¹é‡è½¬ç§»å¤±è´¥',
                    text: error.message,
                    icon: 'error'
                });
            }
        }

        // LOGOä¸Šä¼ å¤„ç†
        function handleLogoUpload(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('logoPreview');
                    preview.innerHTML = `<img src="${e.target.result}" class="img-fluid" style="max-height: 80px;">`;
                };
                reader.readAsDataURL(file);
            }
        }

        // ==================== è½®æ’­å›¾ç®¡ç†åŠŸèƒ½ ====================
        
        // è½®æ’­å›¾æ•°æ®
        let slideshowData = [];
        


        // åŠ è½½è½®æ’­å›¾åˆ—è¡¨
        async function loadSlideshowList() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/slideshow`);
                
                if (response.ok) {
                    slideshowData = await response.json();
                    displaySlideshowList();
                } else {
                    const errorText = await response.text();
                    console.error('è·å–è½®æ’­å›¾åˆ—è¡¨å¤±è´¥:', response.status, response.statusText, errorText);
                    Swal.fire({
                        title: 'é”™è¯¯',
                        text: `è·å–è½®æ’­å›¾åˆ—è¡¨å¤±è´¥: ${response.status} ${response.statusText}`,
                        icon: 'error'
                    });
                }
            } catch (error) {
                console.error('è·å–è½®æ’­å›¾åˆ—è¡¨å¤±è´¥:', error);
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'è·å–è½®æ’­å›¾åˆ—è¡¨å¤±è´¥',
                    icon: 'error'
                });
            }
        }

        // æ˜¾ç¤ºè½®æ’­å›¾åˆ—è¡¨
        function displaySlideshowList() {
            const tbody = document.getElementById('slideshowList');
            
            if (slideshowData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">
                            <i class="fas fa-images fa-2x mb-2"></i><br>
                            æš‚æ— è½®æ’­å›¾æ•°æ®
                        </td>
                    </tr>
                `;
                return;
            }

            // æŒ‰orderæ’åº
            const sortedData = [...slideshowData].sort((a, b) => a.order - b.order);
            
            tbody.innerHTML = sortedData.map(item => `
                <tr data-id="${item.id}">
                    <td>
                        <span class="order-number">${item.order}</span>
                        <div class="order-controls ms-2" style="display: inline-block;">
                            <button class="btn btn-sm btn-outline-secondary" onclick="moveSlideshow('${item.id}', 'up')" title="ä¸Šç§»">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="moveSlideshow('${item.id}', 'down')" title="ä¸‹ç§»">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                    </td>
                    <td>
                        <img src="${item.image || 'https://via.placeholder.com/100x60'}" 
                             class="img-thumbnail slideshow-preview" 
                             style="width: 100px; height: 60px; object-fit: cover; cursor: pointer;"
                             onclick="previewSlideshow('${item.id}')"
                             onerror="this.src='https://via.placeholder.com/100x60'">
                    </td>
                    <td>
                        <div class="slideshow-title">${item.title || '<span class="text-muted">æœªè®¾ç½®æ ‡é¢˜</span>'}</div>
                    </td>
                    <td>
                        <div class="slideshow-description">${item.description || '<span class="text-muted">æœªè®¾ç½®æè¿°</span>'}</div>
                    </td>
                    <td>
                        <span class="status-badge status-active">å¯ç”¨</span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="editSlideshow('${item.id}')">
                            <i class="fas fa-edit"></i> ç¼–è¾‘
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSlideshow('${item.id}')">
                            <i class="fas fa-trash"></i> åˆ é™¤
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // æ·»åŠ è½®æ’­å›¾
        function addSlideshow() {
            Swal.fire({
                title: 'æ·»åŠ è½®æ’­å›¾',
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <label class="form-label">è½®æ’­å›¾å›¾ç‰‡ <span class="text-danger">*</span></label>
                            <input type="file" class="form-control" id="slideshowImageInput" accept="image/*">
                            <div class="form-text">æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œå»ºè®®å°ºå¯¸1920x600ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡5MB</div>
                            <div id="imagePreviewContainer" class="mt-2" style="display: none;">
                                <img id="imagePreview" class="img-thumbnail" style="max-width: 200px; max-height: 100px;">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æ ‡é¢˜</label>
                            <input type="text" class="form-control" id="slideshowTitle" placeholder="è¯·è¾“å…¥è½®æ’­å›¾æ ‡é¢˜">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æè¿°</label>
                            <textarea class="form-control" id="slideshowDescription" rows="3" placeholder="è¯·è¾“å…¥è½®æ’­å›¾æè¿°"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">é“¾æ¥åœ°å€</label>
                            <input type="url" class="form-control" id="slideshowLink" placeholder="è¯·è¾“å…¥è·³è½¬é“¾æ¥ï¼ˆå¯é€‰ï¼‰">
                        </div>
                    </div>
                `,
                width: '600px',
                showCancelButton: true,
                confirmButtonText: 'æ·»åŠ ',
                cancelButtonText: 'å–æ¶ˆ',
                confirmButtonColor: '#28a745',
                preConfirm: () => {
                    const imageInput = document.getElementById('slideshowImageInput');
                    const title = document.getElementById('slideshowTitle').value.trim();
                    const description = document.getElementById('slideshowDescription').value.trim();
                    const link = document.getElementById('slideshowLink').value.trim();

                    if (!imageInput.files[0]) {
                        Swal.showValidationMessage('è¯·é€‰æ‹©è½®æ’­å›¾å›¾ç‰‡');
                        return false;
                    }

                    return {
                        image: imageInput.files[0],
                        title,
                        description,
                        link
                    };
                },
                didOpen: () => {
                    // å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
                    document.getElementById('slideshowImageInput').addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        if (file) {
                            // éªŒè¯æ–‡ä»¶ç±»å‹
                            if (!file.type.startsWith('image/')) {
                                Swal.showValidationMessage('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶');
                                return;
                            }

                            // éªŒè¯æ–‡ä»¶å¤§å°
                            if (file.size > 5 * 1024 * 1024) {
                                Swal.showValidationMessage('å›¾ç‰‡æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB');
                                return;
                            }

                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const preview = document.getElementById('imagePreview');
                                const container = document.getElementById('imagePreviewContainer');
                                preview.src = e.target.result;
                                container.style.display = 'block';
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
            }).then(async (result) => {
                if (result.isConfirmed) {
                    await uploadSlideshow(result.value);
                }
            });
        }

        // ä¸Šä¼ è½®æ’­å›¾
        async function uploadSlideshow(data) {
            try {
                console.log('å¼€å§‹ä¸Šä¼ è½®æ’­å›¾:', data);
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                Swal.fire({
                    title: 'ä¸Šä¼ ä¸­...',
                    text: 'æ­£åœ¨ä¸Šä¼ è½®æ’­å›¾ï¼Œè¯·ç¨å€™',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                // ä¸Šä¼ å›¾ç‰‡
                const formData = new FormData();
                formData.append('image', data.image);
                console.log('å‡†å¤‡ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶:', data.image.name, 'å¤§å°:', data.image.size);

                const uploadResponse = await fetch(`${API_BASE_URL}/api/admin/slideshow/upload`, {
                    method: 'POST',
                    body: formData
                });

                console.log('å›¾ç‰‡ä¸Šä¼ å“åº”çŠ¶æ€:', uploadResponse.status, uploadResponse.statusText);

                if (!uploadResponse.ok) {
                    const errorText = await uploadResponse.text();
                    console.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥:', uploadResponse.status, uploadResponse.statusText, errorText);
                    let errorMessage = 'ä¸Šä¼ å¤±è´¥';
                    try {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.message || errorMessage;
                    } catch (e) {
                        errorMessage = errorText || errorMessage;
                    }
                    throw new Error(errorMessage);
                }

                const uploadResult = await uploadResponse.json();

                // æ›´æ–°è½®æ’­å›¾ä¿¡æ¯
                if (data.title || data.description || data.link) {
                    const updateData = {
                        title: data.title,
                        description: data.description,
                        link: data.link
                    };

                    const updateResponse = await fetch(`${API_BASE_URL}/api/admin/slideshow/${uploadResult.data.id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updateData)
                    });

                    if (!updateResponse.ok) {
                        const errorData = await updateResponse.json();
                        throw new Error(errorData.message || 'æ›´æ–°ä¿¡æ¯å¤±è´¥');
                    }
                }

                // é‡æ–°åŠ è½½åˆ—è¡¨
                await loadSlideshowList();

                Swal.fire({
                    title: 'æˆåŠŸ',
                    text: 'è½®æ’­å›¾æ·»åŠ æˆåŠŸ',
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false
                });

            } catch (error) {
                console.error('ä¸Šä¼ è½®æ’­å›¾å¤±è´¥:', error);
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: error.message || 'ä¸Šä¼ è½®æ’­å›¾å¤±è´¥',
                    icon: 'error'
                });
            }
        }

        // ç¼–è¾‘è½®æ’­å›¾
        function editSlideshow(id) {
            const slideshow = slideshowData.find(item => item.id === id);
            if (!slideshow) {
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'è½®æ’­å›¾ä¸å­˜åœ¨',
                    icon: 'error'
                });
                return;
            }

            Swal.fire({
                title: 'ç¼–è¾‘è½®æ’­å›¾',
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <label class="form-label">å½“å‰å›¾ç‰‡</label>
                            <div class="mb-2">
                                <img src="${slideshow.image}" class="img-thumbnail" style="max-width: 200px; max-height: 100px;">
                            </div>
                            <label class="form-label">æ›´æ¢å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</label>
                            <input type="file" class="form-control" id="editSlideshowImageInput" accept="image/*">
                            <div class="form-text">æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œå»ºè®®å°ºå¯¸1920x600ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡5MB</div>
                            <div id="editImagePreviewContainer" class="mt-2" style="display: none;">
                                <img id="editImagePreview" class="img-thumbnail" style="max-width: 200px; max-height: 100px;">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æ ‡é¢˜</label>
                            <input type="text" class="form-control" id="editSlideshowTitle" value="${slideshow.title || ''}" placeholder="è¯·è¾“å…¥è½®æ’­å›¾æ ‡é¢˜">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æè¿°</label>
                            <textarea class="form-control" id="editSlideshowDescription" rows="3" placeholder="è¯·è¾“å…¥è½®æ’­å›¾æè¿°">${slideshow.description || ''}</textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">é“¾æ¥åœ°å€</label>
                            <input type="url" class="form-control" id="editSlideshowLink" value="${slideshow.link || ''}" placeholder="è¯·è¾“å…¥è·³è½¬é“¾æ¥ï¼ˆå¯é€‰ï¼‰">
                        </div>
                    </div>
                `,
                width: '600px',
                showCancelButton: true,
                confirmButtonText: 'ä¿å­˜',
                cancelButtonText: 'å–æ¶ˆ',
                confirmButtonColor: '#007bff',
                preConfirm: () => {
                    const imageInput = document.getElementById('editSlideshowImageInput');
                    const title = document.getElementById('editSlideshowTitle').value.trim();
                    const description = document.getElementById('editSlideshowDescription').value.trim();
                    const link = document.getElementById('editSlideshowLink').value.trim();

                    return {
                        image: imageInput.files[0] || null,
                        title,
                        description,
                        link
                    };
                },
                didOpen: () => {
                    // å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
                    document.getElementById('editSlideshowImageInput').addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        if (file) {
                            // éªŒè¯æ–‡ä»¶ç±»å‹
                            if (!file.type.startsWith('image/')) {
                                Swal.showValidationMessage('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶');
                                return;
                            }

                            // éªŒè¯æ–‡ä»¶å¤§å°
                            if (file.size > 5 * 1024 * 1024) {
                                Swal.showValidationMessage('å›¾ç‰‡æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB');
                                return;
                            }

                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const preview = document.getElementById('editImagePreview');
                                const container = document.getElementById('editImagePreviewContainer');
                                preview.src = e.target.result;
                                container.style.display = 'block';
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
            }).then(async (result) => {
                if (result.isConfirmed) {
                    await updateSlideshow(id, result.value);
                }
            });
        }

        // æ›´æ–°è½®æ’­å›¾
        async function updateSlideshow(id, data) {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                Swal.fire({
                    title: 'æ›´æ–°ä¸­...',
                    text: 'æ­£åœ¨æ›´æ–°è½®æ’­å›¾ï¼Œè¯·ç¨å€™',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                // å¦‚æœæœ‰æ–°å›¾ç‰‡ï¼Œå…ˆä¸Šä¼ å›¾ç‰‡
                if (data.image) {
                    const formData = new FormData();
                    formData.append('image', data.image);

                    const uploadResponse = await fetch(`${API_BASE_URL}/api/admin/slideshow/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    if (!uploadResponse.ok) {
                        const errorData = await uploadResponse.json();
                        throw new Error(errorData.message || 'å›¾ç‰‡ä¸Šä¼ å¤±è´¥');
                    }

                    const uploadResult = await uploadResponse.json();
                    
                    // åˆ é™¤æ—§çš„è½®æ’­å›¾
                    await fetch(`${API_BASE_URL}/api/admin/slideshow/${id}`, {
                        method: 'DELETE'
                    });

                    // æ›´æ–°æ–°è½®æ’­å›¾çš„ä¿¡æ¯
                    const updateData = {
                        title: data.title,
                        description: data.description,
                        link: data.link
                    };

                    const updateResponse = await fetch(`${API_BASE_URL}/api/admin/slideshow/${uploadResult.data.id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updateData)
                    });

                    if (!updateResponse.ok) {
                        const errorData = await updateResponse.json();
                        throw new Error(errorData.message || 'æ›´æ–°ä¿¡æ¯å¤±è´¥');
                    }
                } else {
                    // åªæ›´æ–°æ–‡å­—ä¿¡æ¯
                    const updateData = {
                        title: data.title,
                        description: data.description,
                        link: data.link
                    };

                    const updateResponse = await fetch(`${API_BASE_URL}/api/admin/slideshow/${id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updateData)
                    });

                    if (!updateResponse.ok) {
                        const errorData = await updateResponse.json();
                        throw new Error(errorData.message || 'æ›´æ–°å¤±è´¥');
                    }
                }

                // é‡æ–°åŠ è½½åˆ—è¡¨
                await loadSlideshowList();

                Swal.fire({
                    title: 'æˆåŠŸ',
                    text: 'è½®æ’­å›¾æ›´æ–°æˆåŠŸ',
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false
                });

            } catch (error) {
                console.error('æ›´æ–°è½®æ’­å›¾å¤±è´¥:', error);
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: error.message || 'æ›´æ–°è½®æ’­å›¾å¤±è´¥',
                    icon: 'error'
                });
            }
        }

        // åˆ é™¤è½®æ’­å›¾
        function deleteSlideshow(id) {
            const slideshow = slideshowData.find(item => item.id === id);
            if (!slideshow) {
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'è½®æ’­å›¾ä¸å­˜åœ¨',
                    icon: 'error'
                });
                return;
            }

            Swal.fire({
                title: 'ç¡®è®¤åˆ é™¤',
                html: `
                    <div class="text-center">
                        <img src="${slideshow.image}" class="img-thumbnail mb-3" style="max-width: 200px; max-height: 100px;">
                        <p>ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè½®æ’­å›¾å—ï¼Ÿ</p>
                        <p class="text-muted">åˆ é™¤åæ— æ³•æ¢å¤</p>
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'ç¡®å®šåˆ é™¤',
                cancelButtonText: 'å–æ¶ˆ',
                confirmButtonColor: '#dc3545'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                        Swal.fire({
                            title: 'åˆ é™¤ä¸­...',
                            text: 'æ­£åœ¨åˆ é™¤è½®æ’­å›¾ï¼Œè¯·ç¨å€™',
                            allowOutsideClick: false,
                            didOpen: () => {
                                Swal.showLoading();
                            }
                        });

                        const response = await fetch(`${API_BASE_URL}/api/admin/slideshow/${id}`, {
                            method: 'DELETE'
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.message || 'åˆ é™¤å¤±è´¥');
                        }

                        // é‡æ–°åŠ è½½åˆ—è¡¨
                        await loadSlideshowList();

                        Swal.fire({
                            title: 'æˆåŠŸ',
                            text: 'è½®æ’­å›¾åˆ é™¤æˆåŠŸ',
                            icon: 'success',
                            timer: 1500,
                            showConfirmButton: false
                        });

                    } catch (error) {
                        console.error('åˆ é™¤è½®æ’­å›¾å¤±è´¥:', error);
                        Swal.fire({
                            title: 'é”™è¯¯',
                            text: error.message || 'åˆ é™¤è½®æ’­å›¾å¤±è´¥',
                            icon: 'error'
                        });
                    }
                }
            });
        }

        // ç§»åŠ¨è½®æ’­å›¾é¡ºåº
        async function moveSlideshow(id, direction) {
            const currentIndex = slideshowData.findIndex(item => item.id === id);
            if (currentIndex === -1) return;

            const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1;
            if (newIndex < 0 || newIndex >= slideshowData.length) return;

            try {
                // äº¤æ¢orderå€¼
                const currentItem = slideshowData[currentIndex];
                const targetItem = slideshowData[newIndex];
                
                const tempOrder = currentItem.order;
                currentItem.order = targetItem.order;
                targetItem.order = tempOrder;

                // æ›´æ–°ä¸¤ä¸ªé¡¹ç›®çš„order
                await Promise.all([
                    fetch(`${API_BASE_URL}/api/admin/slideshow/${currentItem.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            title: currentItem.title,
                            description: currentItem.description,
                            link: currentItem.link
                        })
                    }),
                    fetch(`${API_BASE_URL}/api/admin/slideshow/${targetItem.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            title: targetItem.title,
                            description: targetItem.description,
                            link: targetItem.link
                        })
                    })
                ]);

                // é‡æ–°åŠ è½½åˆ—è¡¨
                await loadSlideshowList();

            } catch (error) {
                console.error('ç§»åŠ¨è½®æ’­å›¾å¤±è´¥:', error);
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'ç§»åŠ¨è½®æ’­å›¾å¤±è´¥',
                    icon: 'error'
                });
            }
        }

        // é¢„è§ˆè½®æ’­å›¾
        function previewSlideshow(id) {
            const slideshow = slideshowData.find(item => item.id === id);
            if (!slideshow) return;

            Swal.fire({
                title: slideshow.title || 'è½®æ’­å›¾é¢„è§ˆ',
                html: `
                    <div class="text-center">
                        <img src="${slideshow.image}" class="img-fluid mb-3" style="max-width: 100%; max-height: 400px;">
                        ${slideshow.description ? `<p class="text-muted">${slideshow.description}</p>` : ''}
                        ${slideshow.link ? `<p><a href="${slideshow.link}" target="_blank" class="btn btn-primary btn-sm">è®¿é—®é“¾æ¥</a></p>` : ''}
                    </div>
                `,
                width: '600px',
                showConfirmButton: false,
                showCloseButton: true
            });
        }



        // ==================== åŒºå·ç®¡ç†åŠŸèƒ½ ====================
        
        let countryCodesData = [];
        let sortableInstance = null;

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–åŒºå·ç®¡ç†
        function initCountryCodeManagement() {
            console.log('åˆå§‹åŒ–åŒºå·ç®¡ç†åŠŸèƒ½...');
            loadCountryCodes();
            initSortable();
        }

        // åŠ è½½åŒºå·åˆ—è¡¨
        async function loadCountryCodes() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/countrycode`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                countryCodesData = await response.json();
                renderCountryCodesList();
                
                // é‡æ–°åˆå§‹åŒ–æ‹–æ‹½æ’åº
                if (sortableInstance) {
                    sortableInstance.destroy();
                }
                initSortable();
                
            } catch (error) {
                console.error('åŠ è½½åŒºå·åˆ—è¡¨å¤±è´¥:', error);
                Swal.fire({
                    title: 'åŠ è½½å¤±è´¥',
                    text: 'æ— æ³•åŠ è½½åŒºå·åˆ—è¡¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥',
                    icon: 'error'
                });
            }
        }

        // æ¸²æŸ“åŒºå·åˆ—è¡¨
        function renderCountryCodesList() {
            const tbody = document.getElementById('countryCodesList');
            if (!tbody) return;

            if (countryCodesData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-2x mb-2"></i><br>
                            æš‚æ— åŒºå·æ•°æ®
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = countryCodesData.map(code => `
                <tr data-id="${code.id}" class="sortable-row">
                    <td class="text-center">
                        <i class="fas fa-grip-vertical text-muted sortable-handle" style="cursor: move;"></i>
                    </td>
                    <td class="text-center">
                        <span class="badge bg-secondary">${code.sortOrder}</span>
                    </td>
                    <td class="text-center" style="font-size: 1.2em;">
                        ${code.flag || 'ğŸŒ'}
                    </td>
                    <td>${code.countryName}</td>
                    <td>
                        <span class="badge bg-info">${code.id}</span>
                    </td>
                    <td>
                        <span class="badge bg-primary">${code.code}</span>
                    </td>
                    <td class="text-center">
                        <div class="status-dot ${code.enabled ? 'enabled' : 'disabled'}" 
                             onclick="toggleCountryCodeStatus('${code.id}')" 
                             title="${code.enabled ? 'ç‚¹å‡»ç¦ç”¨' : 'ç‚¹å‡»å¯ç”¨'}">
                        </div>
                    </td>
                    <td class="text-center">
                        <div class="default-dot ${code.isDefault ? 'is-default' : 'not-default'}" 
                             onclick="${code.isDefault ? '' : `setDefaultCountryCode(${code.id})`}" 
                             title="${code.isDefault ? 'å½“å‰é»˜è®¤åŒºå·' : 'ç‚¹å‡»è®¾ä¸ºé»˜è®¤'}">
                        </div>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="editCountryCode('${code.id}')" title="ç¼–è¾‘">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteCountryCode('${code.id}')" title="åˆ é™¤">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // åˆå§‹åŒ–æ‹–æ‹½æ’åº
        function initSortable() {
            const tbody = document.getElementById('countryCodesList');
            if (!tbody) return;

            sortableInstance = new Sortable(tbody, {
                handle: '.sortable-handle',
                animation: 150,
                ghostClass: 'sortable-ghost',
                chosenClass: 'sortable-chosen',
                dragClass: 'sortable-drag',
                onEnd: function(evt) {
                    updateSortOrder();
                }
            });
        }

        // æ›´æ–°æ’åº
        async function updateSortOrder() {
            try {
                const rows = document.querySelectorAll('#countryCodesList tr[data-id]');
                const updates = Array.from(rows).map((row, index) => ({
                    Id: row.dataset.id,  // æ³¨æ„å¤§å†™çš„Id
                    SortOrder: index + 1  // æ³¨æ„å¤§å†™çš„SortOrder
                }));

                // æ„é€ ç¬¦åˆåç«¯æœŸæœ›çš„æ•°æ®æ ¼å¼
                const requestData = {
                    Updates: updates
                };

                console.log('å‘é€æ’åºæ›´æ–°è¯·æ±‚:', requestData);

                const response = await fetch(`${API_BASE_URL}/api/countrycode/batch-update-sort`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('APIå“åº”é”™è¯¯:', response.status, errorText);
                    throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
                }

                const result = await response.json();
                console.log('æ’åºæ›´æ–°å“åº”:', result);

                // æ›´æ–°æœ¬åœ°æ•°æ®
                updates.forEach(item => {
                    const code = countryCodesData.find(c => c.id === item.Id);
                    if (code) {
                        code.sortOrder = item.SortOrder;
                    }
                });

                renderCountryCodesList();
                
                Swal.fire({
                    title: 'æ’åºæ›´æ–°æˆåŠŸ',
                    text: result.message || 'æ’åºå·²æ›´æ–°',
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false
                });

            } catch (error) {
                console.error('æ›´æ–°æ’åºå¤±è´¥:', error);
                Swal.fire({
                    title: 'æ’åºæ›´æ–°å¤±è´¥',
                    text: `é”™è¯¯è¯¦æƒ…: ${error.message}`,
                    icon: 'error'
                });
                // é‡æ–°åŠ è½½æ•°æ®æ¢å¤åŸçŠ¶æ€
                loadCountryCodes();
            }
        }

        // æ·»åŠ åŒºå·
        async function addCountryCode() {
            const { value: formValues } = await Swal.fire({
                title: 'æ·»åŠ åŒºå·',
                html: `
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">å›½å®¶/åœ°åŒºåç§°</label>
                            <input id="countryName" class="form-control" placeholder="å¦‚ï¼šä¸­å›½" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">å›½å®¶ä»£ç </label>
                            <input id="countryCode" class="form-control" placeholder="å¦‚ï¼šCN" maxlength="2" style="text-transform: uppercase;" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">ç”µè¯åŒºå·</label>
                            <input id="phoneCode" class="form-control" placeholder="å¦‚ï¼š+86" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">å›½æ—— Emoji</label>
                            <input id="flag" class="form-control" placeholder="å¦‚ï¼šğŸ‡¨ğŸ‡³" maxlength="4">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">æ’åºé¡ºåº</label>
                            <input id="sortOrder" type="number" class="form-control" value="${countryCodesData.length + 1}" min="1">
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="isEnabled" checked>
                                <label class="form-check-label" for="isEnabled">å¯ç”¨çŠ¶æ€</label>
                            </div>
                        </div>
                    </div>
                `,
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: 'æ·»åŠ ',
                cancelButtonText: 'å–æ¶ˆ',
                width: '600px',
                preConfirm: () => {
                    const countryName = document.getElementById('countryName').value.trim();
                    const countryCode = document.getElementById('countryCode').value.trim().toUpperCase();
                    const phoneCode = document.getElementById('phoneCode').value.trim();
                    const flag = document.getElementById('flag').value.trim();
                    const sortOrder = parseInt(document.getElementById('sortOrder').value);
                    const isEnabled = document.getElementById('isEnabled').checked;

                    if (!countryName || !countryCode || !phoneCode) {
                        Swal.showValidationMessage('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                        return false;
                    }

                    if (countryCode.length !== 2) {
                        Swal.showValidationMessage('å›½å®¶ä»£ç å¿…é¡»æ˜¯2ä½å­—æ¯');
                        return false;
                    }

                    if (!phoneCode.startsWith('+')) {
                        Swal.showValidationMessage('ç”µè¯åŒºå·å¿…é¡»ä»¥+å¼€å¤´');
                        return false;
                    }

                    return {
                        countryName,
                        code: phoneCode,
                        flag,
                        sortOrder,
                        enabled: isEnabled
                    };
                }
            });

            if (formValues) {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/countrycode`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formValues)
                    });

                    if (!response.ok) {
                        const errorData = await response.text();
                        throw new Error(errorData || `HTTP error! status: ${response.status}`);
                    }

                    await loadCountryCodes();
                    
                    Swal.fire({
                        title: 'æ·»åŠ æˆåŠŸ',
                        text: 'åŒºå·å·²æˆåŠŸæ·»åŠ ',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });

                } catch (error) {
                    console.error('æ·»åŠ åŒºå·å¤±è´¥:', error);
                    Swal.fire({
                        title: 'æ·»åŠ å¤±è´¥',
                        text: error.message || 'è¯·é‡è¯•æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥',
                        icon: 'error'
                    });
                }
            }
        }

        // ç¼–è¾‘åŒºå·
        async function editCountryCode(id) {
            const code = countryCodesData.find(c => c.id === id);
            if (!code) return;

            const { value: formValues } = await Swal.fire({
                title: 'ç¼–è¾‘åŒºå·',
                html: `
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">å›½å®¶/åœ°åŒºåç§°</label>
                            <input id="countryName" class="form-control" value="${code.countryName}" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">å›½å®¶ä»£ç </label>
                            <input id="countryCode" class="form-control" value="${code.id}" maxlength="2" style="text-transform: uppercase;" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">ç”µè¯åŒºå·</label>
                            <input id="phoneCode" class="form-control" value="${code.code}" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">å›½æ—— Emoji</label>
                            <input id="flag" class="form-control" value="${code.flag || ''}" maxlength="4">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">æ’åºé¡ºåº</label>
                            <input id="sortOrder" type="number" class="form-control" value="${code.sortOrder}" min="1">
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="isEnabled" ${code.enabled ? 'checked' : ''}>
                                <label class="form-check-label" for="isEnabled">å¯ç”¨çŠ¶æ€</label>
                            </div>
                        </div>
                    </div>
                `,
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: 'ä¿å­˜',
                cancelButtonText: 'å–æ¶ˆ',
                width: '600px',
                preConfirm: () => {
                    const countryName = document.getElementById('countryName').value.trim();
                    const countryCode = document.getElementById('countryCode').value.trim().toUpperCase();
                    const phoneCode = document.getElementById('phoneCode').value.trim();
                    const flag = document.getElementById('flag').value.trim();
                    const sortOrder = parseInt(document.getElementById('sortOrder').value);
                    const isEnabled = document.getElementById('isEnabled').checked;

                    if (!countryName || !countryCode || !phoneCode) {
                        Swal.showValidationMessage('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                        return false;
                    }

                    if (countryCode.length !== 2) {
                        Swal.showValidationMessage('å›½å®¶ä»£ç å¿…é¡»æ˜¯2ä½å­—æ¯');
                        return false;
                    }

                    if (!phoneCode.startsWith('+')) {
                        Swal.showValidationMessage('ç”µè¯åŒºå·å¿…é¡»ä»¥+å¼€å¤´');
                        return false;
                    }

                    return {
                        countryName,
                        code: phoneCode,
                        flag,
                        sortOrder,
                        enabled: isEnabled
                    };
                }
            });

            if (formValues) {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/countrycode/${id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formValues)
                    });

                    if (!response.ok) {
                        const errorData = await response.text();
                        throw new Error(errorData || `HTTP error! status: ${response.status}`);
                    }

                    await loadCountryCodes();
                    
                    Swal.fire({
                        title: 'æ›´æ–°æˆåŠŸ',
                        text: 'åŒºå·ä¿¡æ¯å·²æ›´æ–°',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });

                } catch (error) {
                    console.error('æ›´æ–°åŒºå·å¤±è´¥:', error);
                    Swal.fire({
                        title: 'æ›´æ–°å¤±è´¥',
                        text: error.message || 'è¯·é‡è¯•æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥',
                        icon: 'error'
                    });
                }
            }
        }

        // åˆ é™¤åŒºå·
        async function deleteCountryCode(id) {
            const code = countryCodesData.find(c => c.id === id);
            if (!code) return;

            const result = await Swal.fire({
                title: 'ç¡®è®¤åˆ é™¤',
                text: `ç¡®å®šè¦åˆ é™¤åŒºå· "${code.countryName} (${code.code})" å—ï¼Ÿ`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'åˆ é™¤',
                cancelButtonText: 'å–æ¶ˆ'
            });

            if (result.isConfirmed) {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/countrycode/${id}`, {
                        method: 'DELETE'
                    });

                    if (!response.ok) {
                        const errorData = await response.text();
                        throw new Error(errorData || `HTTP error! status: ${response.status}`);
                    }

                    await loadCountryCodes();
                    
                    Swal.fire({
                        title: 'åˆ é™¤æˆåŠŸ',
                        text: 'åŒºå·å·²è¢«åˆ é™¤',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });

                } catch (error) {
                    console.error('åˆ é™¤åŒºå·å¤±è´¥:', error);
                    Swal.fire({
                        title: 'åˆ é™¤å¤±è´¥',
                        text: error.message || 'è¯·é‡è¯•æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥',
                        icon: 'error'
                    });
                }
            }
        }

        // è®¾ç½®é»˜è®¤åŒºå·
        async function setDefaultCountryCode(id) {
            const code = countryCodesData.find(c => c.id === id);
            if (!code) return;

            try {
                const response = await fetch(`${API_BASE_URL}/api/countrycode/${id}/set-default`, {
                    method: 'POST'
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    throw new Error(errorData || `HTTP error! status: ${response.status}`);
                }

                await loadCountryCodes();
                
                Swal.fire({
                    title: 'è®¾ç½®æˆåŠŸ',
                    text: `"${code.countryName} (${code.code})" å·²è®¾ä¸ºé»˜è®¤åŒºå·`,
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false
                });

            } catch (error) {
                console.error('è®¾ç½®é»˜è®¤åŒºå·å¤±è´¥:', error);
                Swal.fire({
                    title: 'è®¾ç½®å¤±è´¥',
                    text: error.message || 'è¯·é‡è¯•æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥',
                    icon: 'error'
                });
            }
        }

        // åˆ‡æ¢åŒºå·çŠ¶æ€
        async function toggleCountryCodeStatus(id) {
            const code = countryCodesData.find(c => c.id === id);
            if (!code) return;

            try {
                const newStatus = !code.enabled;
                const response = await fetch(`${API_BASE_URL}/api/countrycode/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ...code,
                        enabled: newStatus
                    })
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    throw new Error(errorData || `HTTP error! status: ${response.status}`);
                }

                await loadCountryCodes();
                
                Swal.fire({
                    title: 'çŠ¶æ€æ›´æ–°æˆåŠŸ',
                    text: `åŒºå·å·²${newStatus ? 'å¯ç”¨' : 'ç¦ç”¨'}`,
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false
                });

            } catch (error) {
                console.error('æ›´æ–°çŠ¶æ€å¤±è´¥:', error);
                Swal.fire({
                    title: 'çŠ¶æ€æ›´æ–°å¤±è´¥',
                    text: error.message || 'è¯·é‡è¯•æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥',
                    icon: 'error'
                });
            }
        }

        // ==================== VIPç­‰çº§ç®¡ç†åŠŸèƒ½ ====================
        
        // VIPç­‰çº§æ•°æ®
        let vipLevelsData = [];
        
        // åŠ è½½VIPç­‰çº§åˆ—è¡¨
        async function loadVipLevels() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/config/vip-levels`);
                if (response.ok) {
                    vipLevelsData = await response.json();
                    renderVipLevelsList();
                } else {
                    throw new Error(`è·å–VIPç­‰çº§åˆ—è¡¨å¤±è´¥: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                console.error('åŠ è½½VIPç­‰çº§å¤±è´¥:', error);
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'åŠ è½½VIPç­‰çº§åˆ—è¡¨å¤±è´¥',
                    icon: 'error'
                });
            }
        }
        
        // æ¸²æŸ“VIPç­‰çº§åˆ—è¡¨
        function renderVipLevelsList() {
            const tbody = document.getElementById('vipLevelsList');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            vipLevelsData.forEach((level, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <span class="badge fs-6 px-3 py-2" style="background-color: ${level.color || '#6B7280'}; color: white;">
                            ${level.icon || 'ğŸ‘‘'} ${level.level}
                        </span>
                    </td>
                    <td>
                        <strong>${level.name || `VIP - ${level.level}`}</strong>
                    </td>
                    <td>
                        <span class="text-success fw-bold">Â¥${(level.min_deposit || 0).toLocaleString()}</span>
                    </td>
                    <td>
                        <span class="badge bg-warning text-dark">${((level.commission_rate || 0) * 100).toFixed(1)}%</span>
                    </td>
                    <td>
                        <span class="text-primary fw-bold">${level.daily_order_limit || 0}</span>
                    </td>
                    <td>
                        <span class="text-success">Â¥${(level.withdrawal_limit || 0).toLocaleString()}</span>
                    </td>
                    <td>
                        <span class="badge bg-info">${(level.benefits || []).length} é¡¹</span>
                    </td>
                    <td>
                        <span class="badge bg-success">å¯ç”¨</span>
                    </td>
                    <td>
                        <div class="btn-group" role="group">
                            <button class="btn btn-primary btn-sm" onclick="editVipLevel(${level.level})" title="ç¼–è¾‘VIPç­‰çº§ä¿¡æ¯">
                                <i class="fas fa-edit"></i> ç¼–è¾‘
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="viewVipBenefits(${level.level})" title="æŸ¥çœ‹VIPæƒç›Šè¯¦æƒ…">
                                <i class="fas fa-list"></i> æƒç›Š
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        

        
        // ç¼–è¾‘VIPç­‰çº§
        async function editVipLevel(level) {
            const vipLevel = vipLevelsData.find(v => v.level === level);
            if (!vipLevel) {
                Swal.fire('é”™è¯¯', 'æœªæ‰¾åˆ°æŒ‡å®šçš„VIPç­‰çº§', 'error');
                return;
            }
            
            Swal.fire({
                title: `ç¼–è¾‘VIPç­‰çº§ ${level}`,
                html: `
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">ç­‰çº§</label>
                            <input type="number" id="edit-vip-level" class="form-control" value="${vipLevel.level}" readonly>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">åç§°</label>
                            <input type="text" id="edit-vip-name" class="form-control" value="${vipLevel.name || ''}" placeholder="VIPç­‰çº§åç§°">
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <label class="form-label">æœ€ä½å……å€¼ (Â¥)</label>
                            <input type="number" id="edit-vip-min-deposit" class="form-control" value="${vipLevel.min_deposit || 0}" min="0" step="100">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">ä½£é‡‘ç‡ (%)</label>
                            <input type="number" id="edit-vip-commission-rate" class="form-control" value="${((vipLevel.commission_rate || 0) * 100).toFixed(1)}" min="0" max="100" step="0.1">
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <label class="form-label">æ¯æ—¥è®¢å•é™åˆ¶</label>
                            <input type="number" id="edit-vip-daily-limit" class="form-control" value="${vipLevel.daily_order_limit || 0}" min="0">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">æç°é™é¢ (Â¥)</label>
                            <input type="number" id="edit-vip-withdrawal-limit" class="form-control" value="${vipLevel.withdrawal_limit || 0}" min="0" step="1000">
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <label class="form-label">é¢œè‰²</label>
                            <input type="color" id="edit-vip-color" class="form-control" value="${vipLevel.color || '#3498db'}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">å›¾æ ‡</label>
                            <select id="edit-vip-icon" class="form-control">
                                <option value="ğŸ‘‘" ${vipLevel.icon === 'ğŸ‘‘' ? 'selected' : ''}>ğŸ‘‘ çš‡å† </option>
                                <option value="ğŸ’" ${vipLevel.icon === 'ğŸ’' ? 'selected' : ''}>ğŸ’ é’»çŸ³</option>
                                <option value="ğŸ¥‡" ${vipLevel.icon === 'ğŸ¥‡' ? 'selected' : ''}>ğŸ¥‡ é‡‘ç‰Œ</option>
                                <option value="ğŸ¥ˆ" ${vipLevel.icon === 'ğŸ¥ˆ' ? 'selected' : ''}>ğŸ¥ˆ é“¶ç‰Œ</option>
                                <option value="ğŸ¥‰" ${vipLevel.icon === 'ğŸ¥‰' ? 'selected' : ''}>ğŸ¥‰ é“œç‰Œ</option>
                                <option value="â­" ${vipLevel.icon === 'â­' ? 'selected' : ''}>â­ æ˜Ÿæ˜Ÿ</option>
                                <option value="ğŸ”¥" ${vipLevel.icon === 'ğŸ”¥' ? 'selected' : ''}>ğŸ”¥ ç«ç„°</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-3">
                        <label class="form-label">æƒç›Šåˆ—è¡¨</label>
                        <div id="edit-benefits-container">
                            ${(vipLevel.benefits || []).map(benefit => `
                                <div class="input-group mb-2">
                                    <input type="text" class="form-control benefit-input" value="${benefit}" placeholder="è¾“å…¥æƒç›Šæè¿°">
                                    <button type="button" class="btn btn-outline-danger" onclick="removeBenefit(this)">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        <button type="button" class="btn btn-outline-success btn-sm" onclick="addBenefit('edit-benefits-container')">
                            <i class="fas fa-plus"></i> æ·»åŠ æƒç›Š
                        </button>
                    </div>
                `,
                width: '800px',
                showCancelButton: true,
                confirmButtonText: 'ä¿å­˜',
                cancelButtonText: 'å–æ¶ˆ',
                preConfirm: () => {
                    const name = document.getElementById('edit-vip-name').value.trim();
                    const minDeposit = parseFloat(document.getElementById('edit-vip-min-deposit').value) || 0;
                    const commissionRate = parseFloat(document.getElementById('edit-vip-commission-rate').value) / 100 || 0;
                    const dailyLimit = parseInt(document.getElementById('edit-vip-daily-limit').value) || 0;
                    const withdrawalLimit = parseFloat(document.getElementById('edit-vip-withdrawal-limit').value) || 0;
                    const color = document.getElementById('edit-vip-color').value;
                    const icon = document.getElementById('edit-vip-icon').value;
                    
                    const benefits = Array.from(document.querySelectorAll('#edit-benefits-container .benefit-input'))
                        .map(input => input.value.trim())
                        .filter(benefit => benefit.length > 0);
                    
                    if (!name) {
                        Swal.showValidationMessage('è¯·è¾“å…¥VIPç­‰çº§åç§°');
                        return false;
                    }
                    
                    if (benefits.length === 0) {
                        Swal.showValidationMessage('è¯·è‡³å°‘æ·»åŠ ä¸€é¡¹æƒç›Š');
                        return false;
                    }
                    
                    return {
                        level,
                        name,
                        min_deposit: minDeposit,
                        commission_rate: commissionRate,
                        daily_order_limit: dailyLimit,
                        withdrawal_limit: withdrawalLimit,
                        benefits,
                        color,
                        icon
                    };
                }
            }).then(async (result) => {
                if (result.isConfirmed) {
                    await updateVipLevel(level, result.value);
                }
            });
        }
        
        // æŸ¥çœ‹VIPæƒç›Š
        function viewVipBenefits(level) {
            const vipLevel = vipLevelsData.find(v => v.level === level);
            if (!vipLevel) {
                Swal.fire('é”™è¯¯', 'æœªæ‰¾åˆ°æŒ‡å®šçš„VIPç­‰çº§', 'error');
                return;
            }
            
            const benefitsHtml = (vipLevel.benefits || []).map((benefit, index) => 
                `<div class="alert alert-info mb-2">
                    <strong>${index + 1}.</strong> ${benefit}
                </div>`
            ).join('');
            
            Swal.fire({
                title: `${vipLevel.name} æƒç›Šè¯¦æƒ…`,
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <span class="badge" style="background-color: ${vipLevel.color}; color: white; font-size: 1.2em;">
                                ${vipLevel.icon} ${vipLevel.name}
                            </span>
                        </div>
                        <div class="row mb-3">
                            <div class="col-6"><strong>æœ€ä½å……å€¼:</strong> Â¥${(vipLevel.min_deposit || 0).toLocaleString()}</div>
                            <div class="col-6"><strong>ä½£é‡‘ç‡:</strong> ${((vipLevel.commission_rate || 0) * 100).toFixed(1)}%</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-6"><strong>æ¯æ—¥è®¢å•:</strong> ${vipLevel.daily_order_limit || 0}</div>
                            <div class="col-6"><strong>æç°é™é¢:</strong> Â¥${(vipLevel.withdrawal_limit || 0).toLocaleString()}</div>
                        </div>
                        <h6>ä¸“äº«æƒç›Š:</h6>
                        ${benefitsHtml || '<div class="text-muted">æš‚æ— æƒç›Šä¿¡æ¯</div>'}
                    </div>
                `,
                width: '600px',
                confirmButtonText: 'å…³é—­'
            });
        }
        

        

        
        // æ›´æ–°VIPç­‰çº§
        async function updateVipLevel(level, vipData) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/vip/levels/${level}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        MinDeposit: vipData.min_deposit,
                        CommissionRate: vipData.commission_rate,
                        DailyOrderLimit: vipData.daily_order_limit,
                        Benefits: vipData.benefits
                    })
                });
                
                if (response.ok) {
                    Swal.fire('æˆåŠŸ', 'VIPç­‰çº§æ›´æ–°æˆåŠŸ', 'success');
                    await loadVipLevels(); // é‡æ–°åŠ è½½åˆ—è¡¨
                } else {
                    throw new Error('æ›´æ–°å¤±è´¥');
                }
            } catch (error) {
                console.error('æ›´æ–°VIPç­‰çº§å¤±è´¥:', error);
                Swal.fire('é”™è¯¯', 'æ›´æ–°VIPç­‰çº§å¤±è´¥', 'error');
            }
        }
        
        // æ·»åŠ æƒç›Šè¾“å…¥æ¡†
        function addBenefit(containerId = 'benefits-container') {
            const container = document.getElementById(containerId);
            const benefitDiv = document.createElement('div');
            benefitDiv.className = 'input-group mb-2';
            benefitDiv.innerHTML = `
                <input type="text" class="form-control benefit-input" placeholder="è¾“å…¥æƒç›Šæè¿°">
                <button type="button" class="btn btn-outline-danger" onclick="removeBenefit(this)">
                    <i class="fas fa-minus"></i>
                </button>
            `;
            container.appendChild(benefitDiv);
        }
        
        // ç§»é™¤æƒç›Šè¾“å…¥æ¡†
        function removeBenefit(button) {
            const container = button.closest('.input-group');
            if (container) {
                container.remove();
            }
        }

        // ==================== ä¼šå‘˜ç®¡ç†åŠŸèƒ½ ====================
        
        // ä¼šå‘˜ç®¡ç†ç›¸å…³å˜é‡
        let membersData = [];
        let filteredMembersData = [];
        let currentMemberPage = 1;
        let memberPageSize = 10;
        let memberSearchTerm = '';
        let memberStatusFilter = '';
        let memberVipFilter = '';
        let agentAccounts = new Set(); // å­˜å‚¨ä¸šåŠ¡å‘˜è´¦æˆ·ä¿¡æ¯
        
        // VIPç­‰çº§æ˜ å°„
        const vipLevelNames = {
            1: 'VIP 1 ğŸ¥‰',
            2: 'VIP 2 ğŸ¥ˆ', 
            3: 'VIP 3 ğŸ¥‡',
            4: 'VIP 4 ğŸ‘‘'
        };
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–ä¼šå‘˜åˆ—è¡¨
        document.addEventListener('DOMContentLoaded', function() {
            if (document.getElementById('membersList')) {
                loadMembersList();
            }
        });
        
        // åŠ è½½ç”¨æˆ·ç±»å‹ä¿¡æ¯
        async function loadUserTypes() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/user-types`);
                if (response.ok) {
                    const data = await response.json();
                    agentAccounts = new Set(data.agentAccounts || []);
                    console.log('ä¸šåŠ¡å‘˜è´¦æˆ·ä¿¡æ¯åŠ è½½æˆåŠŸ:', agentAccounts);
                }
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·ç±»å‹ä¿¡æ¯å¤±è´¥:', error);
            }
        }
        
        // è·å–ç”¨æˆ·ç±»å‹
        function getUserType(user) {
            // é¦–å…ˆæ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜ç±»å‹
            if (user.IsAdmin || user.Phone === 'useradmin') {
                // æ ¹æ®UserTypeå­—æ®µåŒºåˆ†è¶…çº§ç®¡ç†å‘˜å’Œæ™®é€šç®¡ç†å‘˜
                if (user.UserType === 'super_admin') {
                    return { type: 'super_admin', label: 'è¶…çº§ç®¡ç†å‘˜', class: 'bg-danger' };
                } else {
                    return { type: 'admin', label: 'æ™®é€šç®¡ç†å‘˜', class: 'bg-warning' };
                }
            } else if (agentAccounts.has(user.Username) || agentAccounts.has(user.Phone)) {
                return { type: 'agent', label: 'ä¸šåŠ¡å‘˜', class: 'bg-primary' };
            } else {
                return { type: 'customer', label: 'å®¢æˆ·', class: 'bg-success' };
            }
        }
        
        // åŠ è½½ä¼šå‘˜åˆ—è¡¨
        async function loadMembersList() {
            try {
                console.log('å¼€å§‹åŠ è½½ä¼šå‘˜åˆ—è¡¨...');
                
                // å…ˆåŠ è½½ç”¨æˆ·ç±»å‹ä¿¡æ¯
                await loadUserTypes();
                
                const response = await fetch(`${API_BASE_URL}/api/admin/users?page=1&pageSize=1000`); // è·å–æ‰€æœ‰ç”¨æˆ·
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // è¿‡æ»¤æ‰ç®¡ç†å‘˜è´¦æˆ·ï¼Œåªä¿ç•™æ™®é€šæ³¨å†Œä¼šå‘˜
                const allUsers = data.users || [];
                membersData = allUsers.filter(user => {
                    // æ’é™¤ç®¡ç†å‘˜è´¦æˆ·ï¼šIsAdminä¸ºtrueæˆ–Phoneä¸º'useradmin'çš„ç”¨æˆ·
                    return !user.IsAdmin && user.Phone !== 'useradmin';
                });
                
                filteredMembersData = [...membersData];
                
                // æ›´æ–°æ€»æ•°æ˜¾ç¤ºï¼ˆåªè®¡ç®—è¿‡æ»¤åçš„ä¼šå‘˜æ•°é‡ï¼‰
                document.getElementById('memberTotalCount').textContent = membersData.length;
                
                console.log(`åŠ è½½å®Œæˆï¼šæ€»ç”¨æˆ·æ•° ${allUsers.length}ï¼Œä¼šå‘˜æ•° ${membersData.length}`);
                
                // æ¸²æŸ“ä¼šå‘˜åˆ—è¡¨
                renderMembersList();
                renderMembersPagination();
                
            } catch (error) {
                console.error('åŠ è½½ä¼šå‘˜åˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('membersList').innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center py-4 text-danger">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div class="mt-2">åŠ è½½ä¼šå‘˜æ•°æ®å¤±è´¥: ${error.message}</div>
                            <button class="btn btn-outline-primary btn-sm mt-2" onclick="loadMembersList()">é‡è¯•</button>
                        </td>
                    </tr>
                `;
            }
        }
        
        // æ¸²æŸ“ä¼šå‘˜åˆ—è¡¨
        function renderMembersList() {
            const tbody = document.getElementById('membersList');
            if (!tbody) return;
            
            if (filteredMembersData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-4 text-muted">
                            <i class="fas fa-users"></i>
                            <div class="mt-2">æš‚æ— ä¼šå‘˜æ•°æ®</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // è®¡ç®—åˆ†é¡µæ•°æ®
            const startIndex = (currentMemberPage - 1) * memberPageSize;
            const endIndex = startIndex + memberPageSize;
            const pageData = filteredMembersData.slice(startIndex, endIndex);
            
            const rows = pageData.map(member => {
                const registerTime = new Date(member.RegisterTime).toLocaleDateString('zh-CN');
                const isActive = member.IsActive !== false;
                const userType = getUserType(member);
                
                // æ˜¾ç¤ºè´¦å·ï¼ˆä¼˜å…ˆæ˜¾ç¤ºç”¨æˆ·åï¼Œå…¶æ¬¡æ‰‹æœºå·ï¼‰
                const account = member.Username || member.Phone || 'æœªè®¾ç½®';
                
                // æ˜¾ç¤ºå¯†ç ï¼ˆæ³¨æ„ï¼šå®é™…é¡¹ç›®ä¸­ä¸åº”è¯¥æ˜¾ç¤ºæ˜æ–‡å¯†ç ï¼Œè¿™é‡ŒæŒ‰ç”¨æˆ·è¦æ±‚æ˜¾ç¤ºï¼‰
                const password = member.passwordHash || member.Password || member.password || member.PasswordHash || 'æœªè®¾ç½®';
                
                // æ˜¾ç¤ºé‚€è¯·ç 
                const inviteCode = member.InviteCodeUsed || 'æ— ';
                
                // å®¢æˆ·æ•°ï¼ˆæš‚æ—¶æ˜¾ç¤ºä¸º0ï¼Œåç»­å¯ä»¥ä»å…¶ä»–æ•°æ®æºè·å–ï¼‰
                const customerCount = member.CustomerCount || 0;
                
                return `
                    <tr>
                        <td><strong>${account}</strong></td>
                        <td><span class="text-danger">${password}</span></td>
                        <td><span class="badge bg-primary">${inviteCode}</span></td>
                        <td><span class="badge bg-info">${customerCount}</span></td>
                        <td><small class="text-muted">${registerTime}</small></td>
                        <td>
                            <div class="btn-group" role="group">
                                <button class="btn btn-outline-primary btn-sm" onclick="viewMemberDetails('${member.Id}')" title="æŸ¥çœ‹è¯¦æƒ…">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-warning btn-sm" onclick="editMemberVip('${member.Id}')" title="è°ƒæ•´VIPç­‰çº§">
                                    <i class="fas fa-crown"></i>
                                </button>
                                <button class="btn btn-outline-${isActive ? 'danger' : 'success'} btn-sm" onclick="toggleMemberStatus('${member.Id}', ${!isActive})" title="${isActive ? 'ç¦ç”¨' : 'å¯ç”¨'}ç”¨æˆ·">
                                    <i class="fas fa-${isActive ? 'ban' : 'check'}"></i>
                                </button>
                                ${userType.type !== 'admin' ? `
                                <button class="btn btn-outline-danger btn-sm" onclick="deleteMember('${member.Id}', '${member.NickName || member.Phone}')" title="åˆ é™¤ç”¨æˆ·">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = rows;
        }
        
        // æ¸²æŸ“åˆ†é¡µæ§ä»¶
        function renderMembersPagination() {
            const totalPages = Math.ceil(filteredMembersData.length / memberPageSize);
            const pagination = document.getElementById('memberPagination');
            
            if (!pagination || totalPages <= 1) {
                if (pagination) pagination.innerHTML = '';
                return;
            }
            
            let paginationHtml = '';
            
            // ä¸Šä¸€é¡µ
            paginationHtml += `
                <li class="page-item ${currentMemberPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeMemberPage(${currentMemberPage - 1})">ä¸Šä¸€é¡µ</a>
                </li>
            `;
            
            // é¡µç 
            const startPage = Math.max(1, currentMemberPage - 2);
            const endPage = Math.min(totalPages, currentMemberPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHtml += `
                    <li class="page-item ${i === currentMemberPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changeMemberPage(${i})">${i}</a>
                    </li>
                `;
            }
            
            // ä¸‹ä¸€é¡µ
            paginationHtml += `
                <li class="page-item ${currentMemberPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeMemberPage(${currentMemberPage + 1})">ä¸‹ä¸€é¡µ</a>
                </li>
            `;
            
            pagination.innerHTML = paginationHtml;
        }
        
        // åˆ‡æ¢é¡µé¢
        function changeMemberPage(page) {
            const totalPages = Math.ceil(filteredMembersData.length / memberPageSize);
            if (page < 1 || page > totalPages) return;
            
            currentMemberPage = page;
            renderMembersList();
            renderMembersPagination();
        }
        
        // æ”¹å˜æ¯é¡µæ˜¾ç¤ºæ•°é‡
        function changeMemberPageSize() {
            const select = document.getElementById('memberPageSize');
            memberPageSize = parseInt(select.value);
            currentMemberPage = 1;
            renderMembersList();
            renderMembersPagination();
        }
        
        // æœç´¢ä¼šå‘˜
        function searchMembers() {
            const searchInput = document.getElementById('memberSearchInput');
            memberSearchTerm = searchInput.value.trim();
            filterMembers();
        }
        
        // å¤„ç†æœç´¢è¾“å…¥
        function handleMemberSearch(event) {
            if (event.key === 'Enter') {
                searchMembers();
            }
        }
        
        // ç­›é€‰ä¼šå‘˜
        function filterMembers() {
            const statusFilter = document.getElementById('memberStatusFilter').value;
            const vipFilter = document.getElementById('memberVipFilter').value;
            
            memberStatusFilter = statusFilter;
            memberVipFilter = vipFilter;
            
            filteredMembersData = membersData.filter(member => {
                // ç¡®ä¿æ’é™¤ç®¡ç†å‘˜è´¦æˆ·ï¼ˆåŒé‡ä¿æŠ¤ï¼‰
                const isNotAdmin = !member.IsAdmin && member.Phone !== 'useradmin';
                
                // æœç´¢ç­›é€‰
                const matchesSearch = !memberSearchTerm || 
                    (member.Phone && member.Phone.includes(memberSearchTerm)) ||
                    (member.NickName && member.NickName.includes(memberSearchTerm));
                
                // çŠ¶æ€ç­›é€‰
                const matchesStatus = !memberStatusFilter || 
                    (memberStatusFilter === 'true' && member.IsActive !== false) ||
                    (memberStatusFilter === 'false' && member.IsActive === false);
                
                // VIPç­‰çº§ç­›é€‰
                const matchesVip = !memberVipFilter || 
                    member.VipLevel == memberVipFilter;
                
                return isNotAdmin && matchesSearch && matchesStatus && matchesVip;
            });
            
            currentMemberPage = 1;
            renderMembersList();
            renderMembersPagination();
        }
        
        // åˆ·æ–°ä¼šå‘˜åˆ—è¡¨
        function refreshMemberList() {
            // é‡ç½®ç­›é€‰æ¡ä»¶
            document.getElementById('memberSearchInput').value = '';
            document.getElementById('memberStatusFilter').value = '';
            document.getElementById('memberVipFilter').value = '';
            
            memberSearchTerm = '';
            memberStatusFilter = '';
            memberVipFilter = '';
            currentMemberPage = 1;
            
            // é‡æ–°åŠ è½½æ•°æ®
            loadMembersList();
        }
        
        // æŸ¥çœ‹ä¼šå‘˜è¯¦æƒ…
        function viewMemberDetails(memberId) {
            const member = membersData.find(m => m.Id === memberId);
            if (!member) {
                Swal.fire('é”™è¯¯', 'æœªæ‰¾åˆ°æŒ‡å®šä¼šå‘˜', 'error');
                return;
            }
            
            // æ˜¾ç¤ºä¼šå‘˜è¯¦æƒ…é¡µé¢
            showMemberDetailsPage(member);
            showSection('member-details');
        }
        
        // æ˜¾ç¤ºä¼šå‘˜è¯¦æƒ…é¡µé¢
        function showMemberDetailsPage(member) {
            const vipLevel = member.VipLevel || 1;
            const vipName = vipLevelNames[vipLevel] || `VIP ${vipLevel}`;
            const balance = parseFloat(member.CurrentBalance || 0);
            const frozenAmount = parseFloat(member.FrozenAmount || 0);
            const creditScore = member.CreditScore || 0;
            const registerTime = new Date(member.RegisterTime).toLocaleDateString('zh-CN');
            const lastLoginTime = member.LastLoginTime ? new Date(member.LastLoginTime).toLocaleDateString('zh-CN') : 'ä»æœªç™»å½•';
            const isActive = member.IsActive !== false;
            const userType = getUserType(member);
            
            const detailsContent = document.getElementById('memberDetailsContent');
            const closeBtn = document.getElementById('closeMemberDetailsBtn');
            
            closeBtn.style.display = 'block';
            
            detailsContent.innerHTML = `
                <div class="row">
                    <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="fas fa-user"></i> åŸºæœ¬ä¿¡æ¯</h6>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    <div class="avatar-placeholder bg-light rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                                        <i class="fas fa-user text-muted" style="font-size: 2rem;"></i>
                                    </div>
                                    <div class="mt-2">
                                        <span class="badge bg-primary fs-6 px-3 py-2">${vipName}</span>
                                        <span class="badge ${isActive ? 'bg-success' : 'bg-danger'} ms-2">${isActive ? 'æ­£å¸¸' : 'ç¦ç”¨'}</span>
                                    </div>
                                </div>
                                
                                <table class="table table-borderless table-sm">
                                    <tr>
                                        <td><strong>ç”¨æˆ·ID:</strong></td>
                                        <td>${member.Id}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>æ‰‹æœºå·:</strong></td>
                                        <td>${member.Phone || 'æœªè®¾ç½®'}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>æ˜µç§°:</strong></td>
                                        <td>${member.NickName || 'æœªè®¾ç½®'}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>ç”¨æˆ·å:</strong></td>
                                        <td>${member.Username || 'æœªè®¾ç½®'}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>ç”¨æˆ·ç±»å‹:</strong></td>
                                        <td><span class="badge ${userType.class}">${userType.label}</span></td>
                                    </tr>
                                    <tr>
                                        <td><strong>æ³¨å†Œæ—¶é—´:</strong></td>
                                        <td>${registerTime}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>æœ€åç™»å½•:</strong></td>
                                        <td>${lastLoginTime}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è´¢åŠ¡ä¿¡æ¯å¡ç‰‡ -->
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0"><i class="fas fa-wallet"></i> è´¢åŠ¡ä¿¡æ¯</h6>
                            </div>
                            <div class="card-body">
                                <div class="row text-center mb-3">
                                    <div class="col-6">
                                        <div class="border rounded p-3">
                                            <div class="text-success fw-bold fs-4">Â¥${balance.toLocaleString('zh-CN', {minimumFractionDigits: 2})}</div>
                                            <small class="text-muted">å½“å‰ä½™é¢</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="border rounded p-3">
                                            <div class="text-warning fw-bold fs-4">Â¥${frozenAmount.toLocaleString('zh-CN', {minimumFractionDigits: 2})}</div>
                                            <small class="text-muted">å†»ç»“é‡‘é¢</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <table class="table table-borderless table-sm">
                                    <tr>
                                        <td><strong>ä¿¡ç”¨åˆ†:</strong></td>
                                        <td><span class="badge bg-info">${creditScore}</span></td>
                                    </tr>
                                    <tr>
                                        <td><strong>æ€»èµ„äº§:</strong></td>
                                        <td class="text-primary fw-bold">Â¥${(balance + frozenAmount).toLocaleString('zh-CN', {minimumFractionDigits: 2})}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- VIPä¿¡æ¯å¡ç‰‡ -->
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-warning text-dark">
                                <h6 class="mb-0"><i class="fas fa-crown"></i> VIPä¿¡æ¯</h6>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    <span class="badge bg-primary fs-5 px-4 py-3">${vipName}</span>
                                </div>
                                
                                <div id="vipBenefitsInfo">
                                    <div class="text-center">
                                        <div class="spinner-border spinner-border-sm text-primary" role="status">
                                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                                        </div>
                                        <div class="mt-2">æ­£åœ¨åŠ è½½VIPæƒç›Š...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- é‚€è¯·ä¿¡æ¯å¡ç‰‡ -->
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0"><i class="fas fa-users"></i> é‚€è¯·ä¿¡æ¯</h6>
                            </div>
                            <div class="card-body">
                                <table class="table table-borderless table-sm">
                                    <tr>
                                        <td><strong>æˆ‘çš„é‚€è¯·ç :</strong></td>
                                        <td>
                                            ${member.MyInviteCode ? 
                                                `<span class="badge bg-primary">${member.MyInviteCode}</span>` : 
                                                '<span class="text-muted">æœªè®¾ç½®</span>'
                                            }
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>ä½¿ç”¨é‚€è¯·ç :</strong></td>
                                        <td>
                                            ${member.InviteCodeUsed ? 
                                                `<span class="badge bg-success">${member.InviteCodeUsed}</span>` : 
                                                '<span class="text-muted">æœªä½¿ç”¨</span>'
                                            }
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>é‚€è¯·äººID:</strong></td>
                                        <td>${member.InviterId || '<span class="text-muted">æ— </span>'}</td>
                                    </tr>
                                </table>
                                
                                <div class="mt-3">
                                    <button class="btn btn-outline-primary btn-sm" onclick="viewInviteHistory('${member.Id}')">
                                        <i class="fas fa-history"></i> é‚€è¯·è®°å½•
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ“ä½œæŒ‰é’® -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-cogs"></i> æ“ä½œ</h6>
                            </div>
                            <div class="card-body">
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-warning" onclick="editMemberVip('${member.Id}')">
                                        <i class="fas fa-crown"></i> è°ƒæ•´VIPç­‰çº§
                                    </button>
                                    <button class="btn btn-outline-${isActive ? 'danger' : 'success'}" onclick="toggleMemberStatus('${member.Id}', ${!isActive})">
                                        <i class="fas fa-${isActive ? 'ban' : 'check'}"></i> ${isActive ? 'ç¦ç”¨' : 'å¯ç”¨'}ç”¨æˆ·
                                    </button>
                                    <button class="btn btn-outline-info" onclick="viewMemberOrders('${member.Id}')">
                                        <i class="fas fa-shopping-cart"></i> æŸ¥çœ‹è®¢å•
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="refreshMemberDetails('${member.Id}')">
                                        <i class="fas fa-sync-alt"></i> åˆ·æ–°
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // åŠ è½½VIPæƒç›Šä¿¡æ¯
            loadMemberVipBenefits(vipLevel);
        }
        
        // åŠ è½½ä¼šå‘˜VIPæƒç›Šä¿¡æ¯
        async function loadMemberVipBenefits(vipLevel) {
            try {
                // ä»VIPç­‰çº§æ•°æ®ä¸­è·å–æƒç›Šä¿¡æ¯
                const vipInfo = vipLevelsData.find(v => v.level === vipLevel);
                const benefitsContainer = document.getElementById('vipBenefitsInfo');
                
                if (vipInfo && benefitsContainer) {
                    const benefitsHtml = `
                        <div class="row text-center mb-3">
                            <div class="col-6">
                                <div class="border rounded p-2">
                                    <div class="text-success fw-bold">Â¥${(vipInfo.min_deposit || 0).toLocaleString()}</div>
                                    <small class="text-muted">æœ€ä½å……å€¼</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="border rounded p-2">
                                    <div class="text-warning fw-bold">${((vipInfo.commission_rate || 0) * 100).toFixed(1)}%</div>
                                    <small class="text-muted">ä½£é‡‘ç‡</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row text-center mb-3">
                            <div class="col-6">
                                <div class="border rounded p-2">
                                    <div class="text-primary fw-bold">${vipInfo.daily_order_limit || 0}</div>
                                    <small class="text-muted">æ¯æ—¥è®¢å•</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="border rounded p-2">
                                    <div class="text-info fw-bold">Â¥${(vipInfo.withdrawal_limit || 0).toLocaleString()}</div>
                                    <small class="text-muted">æç°é™é¢</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <h6>ä¸“äº«æƒç›Š:</h6>
                            ${(vipInfo.benefits || []).map((benefit, index) => 
                                `<div class="alert alert-light py-2 mb-1">
                                    <small><strong>${index + 1}.</strong> ${benefit}</small>
                                </div>`
                            ).join('') || '<div class="text-muted">æš‚æ— æƒç›Šä¿¡æ¯</div>'}
                        </div>
                    `;
                    
                    benefitsContainer.innerHTML = benefitsHtml;
                }
            } catch (error) {
                console.error('åŠ è½½VIPæƒç›Šå¤±è´¥:', error);
                const benefitsContainer = document.getElementById('vipBenefitsInfo');
                if (benefitsContainer) {
                    benefitsContainer.innerHTML = '<div class="text-danger">åŠ è½½VIPæƒç›Šå¤±è´¥</div>';
                }
            }
        }
        
        // å…³é—­ä¼šå‘˜è¯¦æƒ…
        function closeMemberDetails() {
            const detailsContent = document.getElementById('memberDetailsContent');
            const closeBtn = document.getElementById('closeMemberDetailsBtn');
            
            closeBtn.style.display = 'none';
            
            detailsContent.innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-user-circle text-muted" style="font-size: 4rem;"></i>
                    <p class="text-muted mt-3">è¯·ä»ä¼šå‘˜åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªä¼šå‘˜æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
                    <button class="btn btn-primary" onclick="showSection('member-list')">
                        <i class="fas fa-list"></i> è¿”å›ä¼šå‘˜åˆ—è¡¨
                    </button>
                </div>
            `;
            
            showSection('member-list');
        }
        
        // åˆ·æ–°ä¼šå‘˜è¯¦æƒ…
        function refreshMemberDetails(memberId) {
            const member = membersData.find(m => m.Id === memberId);
            if (member) {
                showMemberDetailsPage(member);
            }
        }
        
        // æŸ¥çœ‹é‚€è¯·è®°å½•
        function viewInviteHistory(memberId) {
            Swal.fire({
                title: 'é‚€è¯·è®°å½•',
                text: 'åŠŸèƒ½å¼€å‘ä¸­...',
                icon: 'info'
            });
        }
        
        // æŸ¥çœ‹ä¼šå‘˜è®¢å•
        function viewMemberOrders(memberId) {
            Swal.fire({
                title: 'ä¼šå‘˜è®¢å•',
                text: 'åŠŸèƒ½å¼€å‘ä¸­...',
                icon: 'info'
            });
        }
        
        // ç¼–è¾‘ä¼šå‘˜VIPç­‰çº§
        function editMemberVip(memberId) {
            const member = membersData.find(m => m.Id === memberId);
            if (!member) {
                Swal.fire('é”™è¯¯', 'æœªæ‰¾åˆ°æŒ‡å®šä¼šå‘˜', 'error');
                return;
            }
            
            const currentVip = member.VipLevel || 1;
            
            Swal.fire({
                title: `è°ƒæ•´VIPç­‰çº§ - ${member.NickName || member.Phone}`,
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <label class="form-label">å½“å‰VIPç­‰çº§: <span class="badge bg-primary">${vipLevelNames[currentVip]}</span></label>
                        </div>
                        <div class="mb-3">
                            <label for="newVipLevel" class="form-label">æ–°VIPç­‰çº§</label>
                            <select id="newVipLevel" class="form-select">
                                <option value="1" ${currentVip === 1 ? 'selected' : ''}>VIP 1 ğŸ¥‰</option>
                                <option value="2" ${currentVip === 2 ? 'selected' : ''}>VIP 2 ğŸ¥ˆ</option>
                                <option value="3" ${currentVip === 3 ? 'selected' : ''}>VIP 3 ğŸ¥‡</option>
                                <option value="4" ${currentVip === 4 ? 'selected' : ''}>VIP 4 ğŸ‘‘</option>
                            </select>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'ç¡®è®¤è°ƒæ•´',
                cancelButtonText: 'å–æ¶ˆ',
                preConfirm: () => {
                    const newVipLevel = parseInt(document.getElementById('newVipLevel').value);
                    if (newVipLevel === currentVip) {
                        Swal.showValidationMessage('è¯·é€‰æ‹©ä¸åŒçš„VIPç­‰çº§');
                        return false;
                    }
                    return newVipLevel;
                }
            }).then(async (result) => {
                if (result.isConfirmed) {
                    await updateMemberVipLevel(memberId, result.value);
                }
            });
        }
        
        // æ›´æ–°ä¼šå‘˜VIPç­‰çº§
        async function updateMemberVipLevel(memberId, newVipLevel) {
            try {
                // è¿™é‡Œåº”è¯¥è°ƒç”¨åç«¯APIæ›´æ–°VIPç­‰çº§
                // æš‚æ—¶æ¨¡æ‹Ÿæ›´æ–°æœ¬åœ°æ•°æ®
                const memberIndex = membersData.findIndex(m => m.Id === memberId);
                if (memberIndex !== -1) {
                    membersData[memberIndex].VipLevel = newVipLevel;
                    
                    // é‡æ–°ç­›é€‰å’Œæ¸²æŸ“
                    filterMembers();
                    
                    Swal.fire('æˆåŠŸ', `VIPç­‰çº§å·²è°ƒæ•´ä¸º ${vipLevelNames[newVipLevel]}`, 'success');
                }
            } catch (error) {
                console.error('æ›´æ–°VIPç­‰çº§å¤±è´¥:', error);
                Swal.fire('é”™è¯¯', 'æ›´æ–°VIPç­‰çº§å¤±è´¥', 'error');
            }
        }
        
        // åˆ‡æ¢ä¼šå‘˜çŠ¶æ€
        async function toggleMemberStatus(memberId, newStatus) {
            const member = membersData.find(m => m.Id === memberId);
            if (!member) {
                Swal.fire('é”™è¯¯', 'æœªæ‰¾åˆ°æŒ‡å®šä¼šå‘˜', 'error');
                return;
            }
            
            const action = newStatus ? 'å¯ç”¨' : 'ç¦ç”¨';
            
            Swal.fire({
                title: `ç¡®è®¤${action}ä¼šå‘˜`,
                text: `ç¡®å®šè¦${action}ä¼šå‘˜ "${member.NickName || member.Phone}" å—ï¼Ÿ`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: `ç¡®è®¤${action}`,
                cancelButtonText: 'å–æ¶ˆ',
                confirmButtonColor: newStatus ? '#28a745' : '#dc3545'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        // è¿™é‡Œåº”è¯¥è°ƒç”¨åç«¯APIæ›´æ–°çŠ¶æ€
                        // æš‚æ—¶æ¨¡æ‹Ÿæ›´æ–°æœ¬åœ°æ•°æ®
                        const memberIndex = membersData.findIndex(m => m.Id === memberId);
                        if (memberIndex !== -1) {
                            membersData[memberIndex].IsActive = newStatus;
                            
                            // é‡æ–°ç­›é€‰å’Œæ¸²æŸ“
                            filterMembers();
                            
                            Swal.fire('æˆåŠŸ', `ä¼šå‘˜å·²${action}`, 'success');
                        }
                    } catch (error) {
                        console.error('æ›´æ–°ä¼šå‘˜çŠ¶æ€å¤±è´¥:', error);
                        Swal.fire('é”™è¯¯', 'æ›´æ–°ä¼šå‘˜çŠ¶æ€å¤±è´¥', 'error');
                    }
                }
            });
        }

        // åˆ é™¤ä¼šå‘˜
        async function deleteMember(memberId, memberName) {
            const member = membersData.find(m => m.Id == memberId);
            if (!member) {
                Swal.fire('é”™è¯¯', 'æœªæ‰¾åˆ°æŒ‡å®šä¼šå‘˜', 'error');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜
            const userType = getUserType(member);
            if (userType.type === 'admin') {
                Swal.fire('é”™è¯¯', 'ä¸èƒ½åˆ é™¤ç®¡ç†å‘˜è´¦æˆ·', 'error');
                return;
            }
            
            Swal.fire({
                title: 'ç¡®è®¤åˆ é™¤ä¼šå‘˜',
                html: `
                    <div class="text-center">
                        <div class="mb-3">
                            <i class="fas fa-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                        </div>
                        <p><strong>ä¼šå‘˜ä¿¡æ¯ï¼š</strong></p>
                        <p>ç”¨æˆ·ID: <span class="badge bg-light text-dark">${member.Id}</span></p>
                        <p>æ˜µç§°: <strong>${member.NickName || 'æœªè®¾ç½®'}</strong></p>
                        <p>æ‰‹æœºå·: <strong>${member.Phone || 'æœªè®¾ç½®'}</strong></p>
                        <p>ç”¨æˆ·ç±»å‹: <span class="badge ${userType.class}">${userType.label}</span></p>
                        <div class="alert alert-danger mt-3">
                            <strong>è­¦å‘Šï¼š</strong>åˆ é™¤æ“ä½œæ— æ³•æ’¤é”€ï¼<br>
                            å°†åŒæ—¶æ¸…ç†è¯¥ç”¨æˆ·çš„æ‰€æœ‰ç›¸å…³æ•°æ®ã€‚
                        </div>
                        <p class="text-danger">ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¼šå‘˜å—ï¼Ÿ</p>
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'ç¡®è®¤åˆ é™¤',
                cancelButtonText: 'å–æ¶ˆ',
                confirmButtonColor: '#dc3545',
                focusCancel: true
            }).then(async (result) => {
                if (result.isConfirmed) {
                    // äºŒæ¬¡ç¡®è®¤
                    Swal.fire({
                        title: 'æœ€ç»ˆç¡®è®¤',
                        text: 'è¯·å†æ¬¡ç¡®è®¤åˆ é™¤æ“ä½œï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼',
                        icon: 'error',
                        showCancelButton: true,
                        confirmButtonText: 'æˆ‘ç¡®å®šè¦åˆ é™¤',
                        cancelButtonText: 'å–æ¶ˆ',
                        confirmButtonColor: '#dc3545'
                    }).then(async (finalResult) => {
                        if (finalResult.isConfirmed) {
                            try {
                                Swal.fire({
                                    title: 'åˆ é™¤ä¸­...',
                                    text: 'æ­£åœ¨åˆ é™¤ä¼šå‘˜æ•°æ®ï¼Œè¯·ç¨å€™...',
                                    allowOutsideClick: false,
                                    didOpen: () => {
                                        Swal.showLoading();
                                    }
                                });
                                
                                console.log(`å¼€å§‹åˆ é™¤ç”¨æˆ· ID: ${memberId}`);
                                
                                const response = await fetch(`${API_BASE_URL}/api/admin/users/${memberId}`, {
                                    method: 'DELETE',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    }
                                });
                                
                                console.log(`åˆ é™¤APIå“åº”çŠ¶æ€: ${response.status} ${response.statusText}`);
                                console.log('å“åº”å¯¹è±¡:', response);
                                
                                if (response.ok) {
                                    console.log('åˆ é™¤è¯·æ±‚æˆåŠŸï¼Œå¼€å§‹å¤„ç†å“åº”...');
                                    let result = { message: 'åˆ é™¤æˆåŠŸ' };
                                    try {
                                        result = await response.json();
                                        console.log('æˆåŠŸè§£æJSONå“åº”:', result);
                                    } catch (jsonError) {
                                        console.log('JSONè§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æˆåŠŸæ¶ˆæ¯:', jsonError);
                                    }
                                    // ä»æœ¬åœ°æ•°æ®ä¸­ç§»é™¤
                                    const memberIndex = membersData.findIndex(m => m.Id == memberId);
                                    if (memberIndex !== -1) {
                                        membersData.splice(memberIndex, 1);
                                    }
                                    
                                    // é‡æ–°ç­›é€‰å’Œæ¸²æŸ“
                                    filterMembers();
                                    
                                    // æ›´æ–°æ€»æ•°æ˜¾ç¤º
                                    document.getElementById('memberTotalCount').textContent = membersData.length;
                                    
                                    Swal.fire({
                                        title: 'åˆ é™¤æˆåŠŸ',
                                        text: 'ä¼šå‘˜å·²æˆåŠŸåˆ é™¤',
                                        icon: 'success',
                                        timer: 2000,
                                        showConfirmButton: false
                                    });
                                } else {
                                    console.log('åˆ é™¤è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status);
                                    let errorResult = { message: 'åˆ é™¤å¤±è´¥' };
                                    try {
                                        errorResult = await response.json();
                                        console.log('é”™è¯¯å“åº”å†…å®¹:', errorResult);
                                    } catch (jsonError) {
                                        console.log('é”™è¯¯å“åº”JSONè§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é”™è¯¯æ¶ˆæ¯:', jsonError);
                                    }
                                    throw new Error(errorResult.message || 'åˆ é™¤å¤±è´¥');
                                }
                            } catch (error) {
                                console.error('åˆ é™¤ä¼šå‘˜å¤±è´¥:', error);
                                console.error('é”™è¯¯è¯¦æƒ…:', error.stack);
                                Swal.fire({
                                    title: 'åˆ é™¤å¤±è´¥',
                                    text: error.message || 'åˆ é™¤ä¼šå‘˜æ—¶å‘ç”Ÿé”™è¯¯',
                                    icon: 'error'
                                });
                            }
                        }
                    });
                }
            });
        }

        // ä¸šåŠ¡å‘˜ç®¡ç†ç›¸å…³å˜é‡
        let staffData = [];
        let currentEditingStaffId = null;

        // æ˜¾ç¤ºæ·»åŠ ä¸šåŠ¡å‘˜æ¨¡æ€æ¡†
        function showAddStaffModal() {
            currentEditingStaffId = null;
            document.getElementById('staffModalLabel').textContent = 'æ·»åŠ ä¸šåŠ¡å‘˜';
            document.getElementById('staffForm').reset();
            document.getElementById('staffStatus').value = 'active';
            
            // è‡ªåŠ¨ç”Ÿæˆé‚€è¯·ç 
            generateInviteCode();
            
            const modal = new bootstrap.Modal(document.getElementById('staffModal'));
            modal.show();
        }

        // æ˜¾ç¤ºç¼–è¾‘ä¸šåŠ¡å‘˜æ¨¡æ€æ¡†
        function showEditStaffModal(staffId) {
            const staff = staffData.find(s => s.id === staffId);
            if (!staff) {
                Swal.fire({
                    title: 'é”™è¯¯',
                    text: 'ä¸šåŠ¡å‘˜ä¸å­˜åœ¨',
                    icon: 'error'
                });
                return;
            }

            currentEditingStaffId = staffId;
            document.getElementById('staffModalLabel').textContent = 'ç¼–è¾‘ä¸šåŠ¡å‘˜';
            
            // å¡«å……è¡¨å•æ•°æ®
            document.getElementById('staffUsername').value = staff.username || '';
            document.getElementById('staffNickname').value = staff.nickname || '';
            document.getElementById('staffPassword').value = ''; // å¯†ç ä¸æ˜¾ç¤º
            document.getElementById('staffInviteCode').value = staff.inviteCode || '';
            document.getElementById('staffStatus').value = staff.isActive ? 'active' : 'inactive';
            
            const modal = new bootstrap.Modal(document.getElementById('staffModal'));
            modal.show();
        }

        // ç”Ÿæˆé‚€è¯·ç 
        async function generateInviteCode() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/salesperson/generate-invite-code`);
                if (response.ok) {
                    let result = { success: false, message: 'é‚€è¯·ç å“åº”è§£æå¤±è´¥' };
                    try {
                        const responseText = await response.text();
                        if (responseText.trim()) {
                            result = JSON.parse(responseText);
                        }
                    } catch (error) {
                        console.error('è§£æé‚€è¯·ç å“åº”JSONå¤±è´¥:', error);
                        // ç”Ÿæˆä¸€ä¸ªé»˜è®¤é‚€è¯·ç 
                        const defaultCode = 'INV' + Date.now().toString().slice(-6);
                        document.getElementById('staffInviteCode').value = defaultCode;
                        return;
                    }
                    
                    if (result.success && result.data) {
                        document.getElementById('staffInviteCode').value = result.data.inviteCode;
                    } else {
                        throw new Error(result.message || 'ç”Ÿæˆé‚€è¯·ç å¤±è´¥');
                    }
                } else {
                    throw new Error('ç”Ÿæˆé‚€è¯·ç å¤±è´¥');
                }
            } catch (error) {
                console.error('ç”Ÿæˆé‚€è¯·ç å¤±è´¥:', error);
                Swal.fire({
                    title: 'ç”Ÿæˆå¤±è´¥',
                    text: 'æ— æ³•ç”Ÿæˆé‚€è¯·ç ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥',
                    icon: 'warning'
                });
            }
        }

        // ä¿å­˜ä¸šåŠ¡å‘˜
        async function saveStaff() {
            const form = document.getElementById('staffForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const formData = {
                username: document.getElementById('staffUsername').value.trim(),
                nickname: document.getElementById('staffNickname').value.trim(),
                password: document.getElementById('staffPassword').value,
                inviteCode: document.getElementById('staffInviteCode').value.trim()
            };

            // éªŒè¯é‚€è¯·ç æ ¼å¼
            if (!/^\d{6}$/.test(formData.inviteCode)) {
                Swal.fire({
                    title: 'æ ¼å¼é”™è¯¯',
                    text: 'é‚€è¯·ç å¿…é¡»æ˜¯6ä½æ•°å­—',
                    icon: 'error'
                });
                return;
            }

            // éªŒè¯å¯†ç é•¿åº¦ï¼ˆæ–°å¢æ—¶å¿…é¡»æœ‰å¯†ç ï¼‰
            if (!currentEditingStaffId && formData.password.length < 6) {
                Swal.fire({
                    title: 'å¯†ç é”™è¯¯',
                    text: 'å¯†ç è‡³å°‘éœ€è¦6ä½å­—ç¬¦',
                    icon: 'error'
                });
                return;
            }

            try {
                Swal.fire({
                    title: 'ä¿å­˜ä¸­...',
                    text: 'æ­£åœ¨ä¿å­˜ä¸šåŠ¡å‘˜ä¿¡æ¯',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                let response;
                if (currentEditingStaffId) {
                    // ç¼–è¾‘æ¨¡å¼
                    const updateData = {
                        username: formData.username,
                        nickname: formData.nickname,
                        inviteCode: formData.inviteCode
                    };
                    
                    // å¦‚æœæœ‰æ–°å¯†ç ï¼Œåˆ™åŒ…å«å¯†ç 
                    if (formData.password) {
                        updateData.password = formData.password;
                    }

                    response = await fetch(`${API_BASE_URL}/api/salesperson/update/${currentEditingStaffId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updateData)
                    });
                } else {
                    // æ–°å¢æ¨¡å¼ - ä¿®å¤å­—æ®µæ˜ å°„
                    response = await fetch(`${API_BASE_URL}/api/salesperson/create`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            username: formData.username,
                            nickname: formData.nickname,
                            password: formData.password,
                            inviteCode: formData.inviteCode,
                            commissionRate: 0.05 // 5%ä½£é‡‘ç‡
                        })
                    });
                }

                let result = { success: false, message: 'å“åº”è§£æå¤±è´¥' };
                try {
                    const responseText = await response.text();
                    if (responseText.trim()) {
                        result = JSON.parse(responseText);
                    }
                } catch (error) {
                    console.error('è§£æå“åº”JSONå¤±è´¥:', error);
                    throw new Error('æœåŠ¡å™¨å“åº”æ ¼å¼é”™è¯¯');
                }

                if (response.ok && result.success) {
                    // ç¡®ä¿æ•°æ®åˆ·æ–°
                    await loadStaffList();
                    
                    // å…³é—­æ¨¡æ€æ¡†
                    const modal = bootstrap.Modal.getInstance(document.getElementById('staffModal'));
                    if (modal) {
                        modal.hide();
                    }
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    Swal.fire({
                        title: 'ä¿å­˜æˆåŠŸ',
                        text: currentEditingStaffId ? 'ä¸šåŠ¡å‘˜ä¿¡æ¯å·²æ›´æ–°' : 'ä¸šåŠ¡å‘˜å·²æ·»åŠ ',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                    
                    // é‡ç½®ç¼–è¾‘çŠ¶æ€
                    currentEditingStaffId = null;
                } else {
                    throw new Error(result.message || 'ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                console.error('ä¿å­˜ä¸šåŠ¡å‘˜å¤±è´¥:', error);
                Swal.fire({
                    title: 'ä¿å­˜å¤±è´¥',
                    text: error.message,
                    icon: 'error'
                });
            }
        }

        // åŸºç¡€ä¿¡æ¯è¡¨å•æäº¤
        document.getElementById('basic-info-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            Swal.fire({
                title: 'ä¿å­˜æˆåŠŸ',
                text: 'åŸºç¡€ä¿¡æ¯å·²æ›´æ–°',
                icon: 'success',
                timer: 1500,
                showConfirmButton: false
            });
        });

        // ==================== LOGOç®¡ç†åŠŸèƒ½ ====================
        
        // LOGOè®¾ç½®å˜é‡
        let currentLogoSettings = {
            type: 'combined',
            text: 'SheIn1323',
            fontSize: 24,
            fontColor: '#333333',
            fontWeight: '400',
            fontFamily: "'Microsoft YaHei', sans-serif",
            imageUrl: '',
            imagePosition: 'left'
        };

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–LOGOè®¾ç½®
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentLogoSettings();
            setupLogoEventListeners();
            updateLogoPreview();
            
            // åˆå§‹åŒ–åŒºå·ç®¡ç†
            initCountryCodeManagement();
        });

        // è®¾ç½®LOGOç›¸å…³äº‹ä»¶ç›‘å¬å™¨
        function setupLogoEventListeners() {
            // LOGOç±»å‹åˆ‡æ¢
            document.querySelectorAll('input[name="logoType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    currentLogoSettings.type = this.value;
                    toggleLogoSettingsSections();
                    updateLogoPreview();
                });
            });

            // æ–‡å­—è®¾ç½®ç›‘å¬å™¨
            document.getElementById('logoText').addEventListener('input', function() {
                currentLogoSettings.text = this.value;
                updateLogoPreview();
            });

            document.getElementById('fontSize').addEventListener('input', function() {
                currentLogoSettings.fontSize = parseInt(this.value);
                updateLogoPreview();
            });

            document.getElementById('fontColor').addEventListener('change', function() {
                currentLogoSettings.fontColor = this.value;
                updateLogoPreview();
            });

            document.getElementById('fontWeight').addEventListener('change', function() {
                currentLogoSettings.fontWeight = this.value;
                updateLogoPreview();
            });

            document.getElementById('fontFamily').addEventListener('change', function() {
                currentLogoSettings.fontFamily = this.value;
                updateLogoPreview();
            });

            // å›¾ç‰‡ä½ç½®ç›‘å¬å™¨
            document.querySelectorAll('input[name="imagePosition"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    currentLogoSettings.imagePosition = this.value;
                    updateLogoPreview();
                });
            });
        }

        // åˆ‡æ¢LOGOè®¾ç½®åŒºåŸŸæ˜¾ç¤º
        function toggleLogoSettingsSections() {
            const textSettings = document.getElementById('textSettings');
            const imageSettings = document.getElementById('imageSettings');
            const type = currentLogoSettings.type;

            if (type === 'text') {
                textSettings.style.display = 'block';
                imageSettings.style.display = 'none';
            } else if (type === 'image') {
                textSettings.style.display = 'none';
                imageSettings.style.display = 'block';
            } else if (type === 'combined') {
                textSettings.style.display = 'block';
                imageSettings.style.display = 'block';
            }
        }

        // æ›´æ–°å­—ä½“å¤§å°æ˜¾ç¤º
        function updateFontSizeDisplay(value) {
            document.getElementById('fontSizeDisplay').textContent = value + 'px';
            currentLogoSettings.fontSize = parseInt(value);
            updateLogoPreview();
        }

        // å¤„ç†LOGOå›¾ç‰‡ä¸Šä¼ 
        function handleLogoImageUpload(input) {
            const file = input.files[0];
            if (file) {
                // éªŒè¯æ–‡ä»¶ç±»å‹
                if (!file.type.startsWith('image/')) {
                    Swal.fire({
                        title: 'é”™è¯¯',
                        text: 'è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶',
                        icon: 'error'
                    });
                    return;
                }

                // éªŒè¯æ–‡ä»¶å¤§å° (2MB)
                if (file.size > 2 * 1024 * 1024) {
                    Swal.fire({
                        title: 'é”™è¯¯',
                        text: 'å›¾ç‰‡æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡2MB',
                        icon: 'error'
                    });
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    currentLogoSettings.imageUrl = e.target.result;
                    showCurrentLogoImage(e.target.result);
                    updateLogoPreview();
                };
                reader.readAsDataURL(file);
            }
        }

        // æ˜¾ç¤ºå½“å‰LOGOå›¾ç‰‡
        function showCurrentLogoImage(imageUrl) {
            const currentLogoImage = document.getElementById('currentLogoImage');
            const logoImagePreview = document.getElementById('logoImagePreview');
            
            logoImagePreview.src = imageUrl;
            currentLogoImage.style.display = 'block';
        }

        // åˆ é™¤LOGOå›¾ç‰‡
        function removeLogoImage() {
            currentLogoSettings.imageUrl = '';
            document.getElementById('currentLogoImage').style.display = 'none';
            document.getElementById('logoImageFile').value = '';
            updateLogoPreview();
        }

        // æ›´æ–°LOGOé¢„è§ˆ
        function updateLogoPreview() {
            const previewContainer = document.getElementById('logoPreviewContent');
            const type = currentLogoSettings.type;
            
            let previewHTML = '';

            if (type === 'text') {
                // çº¯æ–‡å­—LOGO
                previewHTML = `
                    <span style="
                        font-size: ${currentLogoSettings.fontSize}px;
                        color: ${currentLogoSettings.fontColor};
                        font-weight: ${currentLogoSettings.fontWeight};
                        font-family: ${currentLogoSettings.fontFamily};
                    ">${currentLogoSettings.text || 'è¯·è¾“å…¥LOGOæ–‡å­—'}</span>
                `;
            } else if (type === 'image') {
                // çº¯å›¾ç‰‡LOGO
                if (currentLogoSettings.imageUrl) {
                    previewHTML = `<img src="${currentLogoSettings.imageUrl}" style="max-height: 60px;" alt="LOGO">`;
                } else {
                    previewHTML = '<div class="text-muted"><i class="fas fa-image fa-2x"></i><p class="mt-2 mb-0">è¯·ä¸Šä¼ LOGOå›¾ç‰‡</p></div>';
                }
            } else if (type === 'combined') {
                // ç»„åˆLOGO
                const textElement = `
                    <span style="
                        font-size: ${currentLogoSettings.fontSize}px;
                        color: ${currentLogoSettings.fontColor};
                        font-weight: ${currentLogoSettings.fontWeight};
                        font-family: ${currentLogoSettings.fontFamily};
                        margin: 0 10px;
                    ">${currentLogoSettings.text || 'è¯·è¾“å…¥LOGOæ–‡å­—'}</span>
                `;
                
                const imageElement = currentLogoSettings.imageUrl ? 
                    `<img src="${currentLogoSettings.imageUrl}" style="max-height: 60px;" alt="LOGO">` : 
                    '<div class="text-muted" style="margin: 0 10px;"><i class="fas fa-image"></i> è¯·ä¸Šä¼ å›¾ç‰‡</div>';

                // æ ¹æ®å›¾ç‰‡ä½ç½®ç”Ÿæˆä¸åŒçš„å¸ƒå±€
                switch (currentLogoSettings.imagePosition) {
                    case 'left':
                        previewHTML = `<div class="d-flex align-items-center">${imageElement}${textElement}</div>`;
                        break;
                    case 'right':
                        previewHTML = `<div class="d-flex align-items-center">${textElement}${imageElement}</div>`;
                        break;
                    case 'top':
                        previewHTML = `<div class="d-flex flex-column align-items-center">${imageElement}${textElement}</div>`;
                        break;
                    case 'center':
                        previewHTML = `
                            <div class="d-flex align-items-center justify-content-center position-relative">
                                <div class="position-absolute" style="z-index: 1;">${imageElement}</div>
                                <div style="z-index: 2; background: rgba(255,255,255,0.8); padding: 5px 10px; border-radius: 5px;">${textElement}</div>
                            </div>
                        `;
                        break;
                    case 'bottom':
                        previewHTML = `<div class="d-flex flex-column align-items-center">${textElement}${imageElement}</div>`;
                        break;
                    default:
                        previewHTML = `<div class="d-flex align-items-center">${imageElement}${textElement}</div>`;
                }
            }

            previewContainer.innerHTML = previewHTML;
        }

        // é¢„è§ˆLOGOæ•ˆæœ
        function previewLogo() {
            updateLogoPreview();
            Swal.fire({
                title: 'LOGOé¢„è§ˆ',
                html: document.getElementById('logoPreviewContent').innerHTML,
                icon: 'info',
                confirmButtonText: 'ç¡®å®š'
            });
        }

        // ä¿å­˜LOGOè®¾ç½®
        async function saveLogoSettings() {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                Swal.fire({
                    title: 'ä¿å­˜ä¸­...',
                    text: 'æ­£åœ¨ä¿å­˜LOGOè®¾ç½®',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                // å¦‚æœæœ‰å›¾ç‰‡éœ€è¦ä¸Šä¼ 
                let imageUrl = currentLogoSettings.imageUrl;
                if (imageUrl && imageUrl.startsWith('data:')) {
                    imageUrl = await uploadLogoImage(imageUrl);
                }

                // å‡†å¤‡ä¿å­˜æ•°æ®
                const logoData = {
                    type: currentLogoSettings.type,
                    text: currentLogoSettings.text,
                    fontSize: currentLogoSettings.fontSize,
                    fontColor: currentLogoSettings.fontColor,
                    fontWeight: currentLogoSettings.fontWeight,
                    fontFamily: currentLogoSettings.fontFamily,
                    imageUrl: imageUrl,
                    imagePosition: currentLogoSettings.imagePosition
                };

                // è°ƒç”¨APIä¿å­˜
                const response = await fetch(`${API_BASE_URL}/api/admin/logo-settings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(logoData)
                });

                if (response.ok) {
                    Swal.fire({
                        title: 'ä¿å­˜æˆåŠŸ',
                        text: 'LOGOè®¾ç½®å·²ä¿å­˜ï¼Œé¦–é¡µå°†æ˜¾ç¤ºæ–°çš„LOGO',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    const errorData = await response.json().catch(() => ({ message: 'æœªçŸ¥é”™è¯¯' }));
                    throw new Error(`ä¿å­˜å¤±è´¥: ${errorData.message || response.statusText}`);
                }
            } catch (error) {
                console.error('ä¿å­˜LOGOè®¾ç½®å¤±è´¥:', error);
                Swal.fire({
                    title: 'ä¿å­˜å¤±è´¥',
                    text: error.message || 'ä¿å­˜LOGOè®¾ç½®æ—¶å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•',
                    icon: 'error'
                });
            }
        }

        // ä¸Šä¼ LOGOå›¾ç‰‡
        async function uploadLogoImage(dataUrl) {
            try {
                // å°†base64è½¬æ¢ä¸ºblob
                const response = await fetch(dataUrl);
                const blob = await response.blob();
                
                // åˆ›å»ºFormData
                const formData = new FormData();
                formData.append('logo', blob, 'logo.png');

                // ä¸Šä¼ å›¾ç‰‡
                const uploadResponse = await fetch(`${API_BASE_URL}/api/admin/upload-logo`, {
                    method: 'POST',
                    body: formData
                });

                if (uploadResponse.ok) {
                    const result = await uploadResponse.json();
                    return result.imageUrl;
                } else {
                    throw new Error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥');
                }
            } catch (error) {
                console.error('ä¸Šä¼ å›¾ç‰‡å¤±è´¥:', error);
                throw error;
            }
        }

        // åŠ è½½å½“å‰LOGOè®¾ç½®
        async function loadCurrentLogoSettings() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/logo-settings`);
                if (response.ok) {
                    const data = await response.json();
                    
                    // æ›´æ–°è®¾ç½®
                    currentLogoSettings = {
                        type: data.type || 'combined',
                        text: data.text || 'SheIn1323',
                        fontSize: data.fontSize || 24,
                        fontColor: data.fontColor || '#333333',
                        fontWeight: data.fontWeight || '400',
                        fontFamily: data.fontFamily || "'Microsoft YaHei', sans-serif",
                        imageUrl: data.imageUrl || '',
                        imagePosition: data.imagePosition || 'left'
                    };

                    // æ›´æ–°ç•Œé¢
                    updateLogoFormFields();
                    toggleLogoSettingsSections();
                    updateLogoPreview();
                }
            } catch (error) {
                console.error('åŠ è½½LOGOè®¾ç½®å¤±è´¥:', error);
            }
        }

        // æ›´æ–°è¡¨å•å­—æ®µ
        function updateLogoFormFields() {
            // è®¾ç½®LOGOç±»å‹
            document.querySelector(`input[name="logoType"][value="${currentLogoSettings.type}"]`).checked = true;
            
            // è®¾ç½®æ–‡å­—ç›¸å…³å­—æ®µ
            document.getElementById('logoText').value = currentLogoSettings.text;
            document.getElementById('fontSize').value = currentLogoSettings.fontSize;
            document.getElementById('fontSizeDisplay').textContent = currentLogoSettings.fontSize + 'px';
            document.getElementById('fontColor').value = currentLogoSettings.fontColor;
            document.getElementById('fontWeight').value = currentLogoSettings.fontWeight;
            document.getElementById('fontFamily').value = currentLogoSettings.fontFamily;
            
            // è®¾ç½®å›¾ç‰‡ä½ç½®
            document.querySelector(`input[name="imagePosition"][value="${currentLogoSettings.imagePosition}"]`).checked = true;
            
            // æ˜¾ç¤ºå½“å‰å›¾ç‰‡
            if (currentLogoSettings.imageUrl) {
                showCurrentLogoImage(currentLogoSettings.imageUrl);
            }
        }

        // é‡ç½®LOGOè®¾ç½®
        function resetLogoSettings() {
            Swal.fire({
                title: 'ç¡®å®šè¦é‡ç½®å—ï¼Ÿ',
                text: 'è¿™å°†æ¸…é™¤æ‰€æœ‰LOGOè®¾ç½®',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'ç¡®å®šé‡ç½®',
                cancelButtonText: 'å–æ¶ˆ'
            }).then((result) => {
                if (result.isConfirmed) {
                    // é‡ç½®ä¸ºé»˜è®¤è®¾ç½®
                    currentLogoSettings = {
                        type: 'combined',
                        text: 'SheIn1323',
                        fontSize: 24,
                        fontColor: '#333333',
                        fontWeight: '400',
                        fontFamily: "'Microsoft YaHei', sans-serif",
                        imageUrl: '',
                        imagePosition: 'left'
                    };
                    
                    updateLogoFormFields();
                    toggleLogoSettingsSections();
                    updateLogoPreview();
                    removeLogoImage();
                    
                    Swal.fire({
                        title: 'é‡ç½®æˆåŠŸ',
                        text: 'LOGOè®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                }
            });
        }


        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                Swal.fire({
                    title: 'å¤åˆ¶æˆåŠŸ',
                    text: 'åœ°å€å·²å¤åˆ¶åˆ°å‰ªè´´æ¿',
                    icon: 'success',
                    timer: 1000,
                    showConfirmButton: false,
                    toast: true,
                    position: 'top-end'
                });
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                Swal.fire({
                    title: 'å¤åˆ¶å¤±è´¥',
                    text: 'è¯·æ‰‹åŠ¨å¤åˆ¶åœ°å€',
                    icon: 'error',
                    timer: 1500,
                    showConfirmButton: false
                });
            });
        }

        // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
        function formatDateTime(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>

    <!-- ä¸šåŠ¡å‘˜æ·»åŠ /ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal fade" id="staffModal" tabindex="-1" aria-labelledby="staffModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staffModalLabel">æ·»åŠ ä¸šåŠ¡å‘˜</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="staffForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="staffUsername" class="form-label">è´¦å· <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="staffUsername" required>
                                    <div class="form-text">ç”¨äºç™»å½•çš„è´¦å·ï¼Œä¸å¯é‡å¤</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="staffNickname" class="form-label">æ˜µç§° <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="staffNickname" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="staffPassword" class="form-label">å¯†ç  <span class="text-danger">*</span></label>
                                    <input type="password" class="form-control" id="staffPassword" required>
                                    <div class="form-text">è‡³å°‘6ä½å­—ç¬¦</div>
                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="staffInviteCode" class="form-label">é‚€è¯·ç  <span class="text-danger">*</span></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="staffInviteCode" required maxlength="6" pattern="[0-9]{6}">
                                        <button type="button" class="btn btn-outline-secondary" onclick="generateInviteCode()">
                                            <i class="fas fa-sync-alt"></i> è‡ªåŠ¨ç”Ÿæˆ
                                        </button>
                                    </div>
                                    <div class="form-text">6ä½æ•°å­—é‚€è¯·ç ï¼Œä¸å¯é‡å¤</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="staffStatus" class="form-label">çŠ¶æ€</label>
                                    <select class="form-select" id="staffStatus">
                                        <option value="active">æ­£å¸¸</option>
                                        <option value="inactive">ç¦ç”¨</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="saveStaff()">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å®¢æˆ·åˆ—è¡¨æ¨¡æ€æ¡† -->
    <div class="modal fade" id="staffCustomersModal" tabindex="-1" aria-labelledby="staffCustomersModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staffCustomersModalLabel">å®¢æˆ·åˆ—è¡¨</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                <input type="text" class="form-control" id="searchCustomers" placeholder="æœç´¢å®¢æˆ·ï¼ˆç”¨æˆ·åã€æ˜µç§°ã€é‚®ç®±ï¼‰" onkeyup="searchCustomers()">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="filterCustomerStatus" onchange="searchCustomers()">
                                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                <option value="active">æ­£å¸¸</option>
                                <option value="inactive">ç¦ç”¨</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-primary" onclick="showBatchTransferModal()" id="batchTransferBtn" disabled>
                                <i class="fas fa-exchange-alt"></i> æ‰¹é‡è½¬ç§»
                            </button>
                        </div>
                        <div class="col-md-2">
                            <div class="text-end">
                                <span class="badge bg-info fs-6" id="customerCount">0</span> ä¸ªå®¢æˆ·
                            </div>
                        </div>
                    </div>

                    <!-- å®¢æˆ·åˆ—è¡¨è¡¨æ ¼ -->
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th width="40">
                                        <input type="checkbox" id="selectAllCustomers" onchange="toggleSelectAllCustomers()">
                                    </th>
                                    <th>ç”¨æˆ·å</th>
                                    <th>æ˜µç§°</th>
                                    <th>é‚®ç®±</th>
                                    <th>é‚€è¯·ç </th>
                                    <th>çŠ¶æ€</th>
                                    <th>æ³¨å†Œæ—¶é—´</th>
                                    <th width="120">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="customersTableBody">
                                <!-- å®¢æˆ·æ•°æ®å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                            </tbody>
                        </table>
                    </div>

                    <!-- åˆ†é¡µ -->
                    <nav aria-label="å®¢æˆ·åˆ—è¡¨åˆ†é¡µ" id="customersPagination" style="display: none;">
                        <ul class="pagination justify-content-center">
                            <!-- åˆ†é¡µæŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </ul>
                    </nav>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å•ä¸ªå®¢æˆ·è½¬ç§»æ¨¡æ€æ¡† -->
    <div class="modal fade" id="transferSingleCustomerModal" tabindex="-1" aria-labelledby="transferSingleCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="transferSingleCustomerModalLabel">è½¬ç§»å®¢æˆ·</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">å®¢æˆ·ä¿¡æ¯</label>
                        <div class="card">
                            <div class="card-body">
                                <div id="transferCustomerInfo"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="targetSalespersonSelect" class="form-label">ç›®æ ‡ä¸šåŠ¡å‘˜ <span class="text-danger">*</span></label>
                        <select class="form-select" id="targetSalespersonSelect" required>
                            <option value="">è¯·é€‰æ‹©ç›®æ ‡ä¸šåŠ¡å‘˜</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="confirmSingleTransfer()">ç¡®è®¤è½¬ç§»</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‰¹é‡è½¬ç§»æ¨¡æ€æ¡† -->
    <div class="modal fade" id="batchTransferModal" tabindex="-1" aria-labelledby="batchTransferModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="batchTransferModalLabel">æ‰¹é‡è½¬ç§»å®¢æˆ·</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">é€‰ä¸­çš„å®¢æˆ·</label>
                        <div class="card">
                            <div class="card-body">
                                <div id="selectedCustomersInfo"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="batchTargetSalespersonSelect" class="form-label">ç›®æ ‡ä¸šåŠ¡å‘˜ <span class="text-danger">*</span></label>
                        <select class="form-select" id="batchTargetSalespersonSelect" required>
                            <option value="">è¯·é€‰æ‹©ç›®æ ‡ä¸šåŠ¡å‘˜</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="confirmBatchTransfer()">ç¡®è®¤è½¬ç§»</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘æ”¶æ¬¾è´¦æˆ·æ¨¡æ€æ¡† -->
    <div class="modal fade" id="paymentAccountModal" tabindex="-1" aria-labelledby="paymentAccountModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentAccountModalLabel">
                        <span id="addPaymentAccountTitle">æ·»åŠ æ”¶æ¬¾è´¦æˆ·</span>
                        <span id="editPaymentAccountTitle" style="display: none;">ç¼–è¾‘æ”¶æ¬¾è´¦æˆ·</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="paymentAccountForm">
                        <input type="hidden" id="paymentAccountId" name="id">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="walletName" class="form-label">é’±åŒ…åç§° <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="walletName" name="walletName" required>
                                    <div class="form-text">ä¾‹å¦‚ï¼šä¸»é’±åŒ…ã€å¤‡ç”¨é’±åŒ…ç­‰</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="accountType" class="form-label">æ•°å­—è´§å¸ç±»å‹ <span class="text-danger">*</span></label>
                                    <select class="form-select" id="accountType" name="accountType" required>
                                        <option value="">è¯·é€‰æ‹©æ•°å­—è´§å¸ç±»å‹</option>
                                        <option value="USDT">USDT (æ³°è¾¾å¸)</option>
                                        <option value="BTC">BTC (æ¯”ç‰¹å¸)</option>
                                        <option value="ETH">ETH (ä»¥å¤ªåŠ)</option>
                                        <option value="TRX">TRX (æ³¢åœºå¸)</option>
                                        <option value="BNB">BNB (å¸å®‰å¸)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="networkType" class="form-label">ç½‘ç»œç±»å‹ <span class="text-danger">*</span></label>
                                    <select class="form-select" id="networkType" name="networkType" required>
                                        <option value="">è¯·å…ˆé€‰æ‹©æ•°å­—è´§å¸ç±»å‹</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="accountNumber" class="form-label">é’±åŒ…åœ°å€ <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="accountNumber" name="accountNumber" required>
                                    <div class="form-text" id="addressFormatHint">è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="accountIdentifier" class="form-label">è´¦æˆ·æ ‡è¯†</label>
                                    <input type="text" class="form-control" id="accountIdentifier" name="accountIdentifier">
                                    <div class="form-text">å¯é€‰ï¼Œç”¨äºåŒºåˆ†ä¸åŒè´¦æˆ·</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="accountStatus" class="form-label">çŠ¶æ€ <span class="text-danger">*</span></label>
                                    <select class="form-select" id="accountStatus" name="status" required>
                                        <option value="enabled">å¯ç”¨</option>
                                        <option value="disabled">ç¦ç”¨</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="isDefault" name="isDefault">
                                        <label class="form-check-label" for="isDefault">
                                            è®¾ä¸ºé»˜è®¤è´¦æˆ·
                                        </label>
                                        <div class="form-text">é»˜è®¤è´¦æˆ·å°†ä¼˜å…ˆæ˜¾ç¤ºç»™ç”¨æˆ·</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="remarks" class="form-label">å¤‡æ³¨</label>
                            <textarea class="form-control" id="remarks" name="remarks" rows="3" placeholder="å¯é€‰ï¼Œæ·»åŠ å¤‡æ³¨ä¿¡æ¯"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="savePaymentAccount()">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <script>


        // ==================== æ”¶æ¬¾è´¦æˆ·è¾…åŠ©å‡½æ•° ====================
        
        // æ›´æ–°ç½‘ç»œç±»å‹é€‰é¡¹
        function updateNetworkOptions() {
            const accountType = document.getElementById('accountType').value;
            const networkSelect = document.getElementById('networkType');
            
            // æ¸…ç©ºç°æœ‰é€‰é¡¹
            networkSelect.innerHTML = '<option value="">è¯·é€‰æ‹©ç½‘ç»œç±»å‹</option>';
            
            // æ ¹æ®æ•°å­—è´§å¸ç±»å‹æ·»åŠ å¯¹åº”çš„ç½‘ç»œé€‰é¡¹
            const networkOptions = {
                'USDT': [
                    { value: 'TRC20', text: 'TRC20 (æ³¢åœºç½‘ç»œ)' },
                    { value: 'ERC20', text: 'ERC20 (ä»¥å¤ªåŠç½‘ç»œ)' },
                    { value: 'BEP20', text: 'BEP20 (å¸å®‰æ™ºèƒ½é“¾)' },
                    { value: 'OMNI', text: 'OMNI (æ¯”ç‰¹å¸ç½‘ç»œ)' }
                ],
                'BTC': [
                    { value: 'BTC', text: 'Bitcoin Network' }
                ],
                'ETH': [
                    { value: 'ERC20', text: 'ERC20 (ä»¥å¤ªåŠç½‘ç»œ)' }
                ],
                'TRX': [
                    { value: 'TRC20', text: 'TRC20 (æ³¢åœºç½‘ç»œ)' }
                ],
                'BNB': [
                    { value: 'BEP20', text: 'BEP20 (å¸å®‰æ™ºèƒ½é“¾)' },
                    { value: 'BEP2', text: 'BEP2 (å¸å®‰é“¾)' }
                ]
            };
            
            if (accountType && networkOptions[accountType]) {
                networkOptions[accountType].forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option.value;
                    optionElement.textContent = option.text;
                    networkSelect.appendChild(optionElement);
                });
            }
            
            // æ›´æ–°åœ°å€æ ¼å¼æç¤º
            updateAddressFormatHint();
        }

        // æ›´æ–°åœ°å€æ ¼å¼æç¤º
        function updateAddressFormatHint() {
            const accountType = document.getElementById('accountType').value;
            const hintElement = document.getElementById('addressFormatHint');
            
            const formatHints = {
                'USDT': 'è¯·è¾“å…¥æœ‰æ•ˆçš„USDTé’±åŒ…åœ°å€ï¼ˆæ ¹æ®ç½‘ç»œç±»å‹è€Œå®šï¼‰',
                'BTC': 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ¯”ç‰¹å¸åœ°å€ï¼ˆä»¥1ã€3æˆ–bc1å¼€å¤´ï¼‰',
                'ETH': 'è¯·è¾“å…¥æœ‰æ•ˆçš„ä»¥å¤ªåŠåœ°å€ï¼ˆä»¥0xå¼€å¤´ï¼Œ42ä½å­—ç¬¦ï¼‰',
                'TRX': 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ³¢åœºåœ°å€ï¼ˆä»¥Tå¼€å¤´ï¼Œ34ä½å­—ç¬¦ï¼‰',
                'BNB': 'è¯·è¾“å…¥æœ‰æ•ˆçš„å¸å®‰å¸åœ°å€ï¼ˆæ ¹æ®ç½‘ç»œç±»å‹è€Œå®šï¼‰'
            };
            
            hintElement.textContent = formatHints[accountType] || 'è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€';
        }

        // éªŒè¯é’±åŒ…åœ°å€æ ¼å¼
        function validateWalletAddress(address, accountType) {
            if (!address || !accountType) return false;
            
            const patterns = {
                'BTC': /^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$|^bc1[a-z0-9]{39,59}$/,
                'ETH': /^0x[a-fA-F0-9]{40}$/,
                'TRX': /^T[A-Za-z1-9]{33}$/,
                'USDT': /^[13T][a-km-zA-HJ-NP-Z1-9T]{25,34}$|^0x[a-fA-F0-9]{40}$|^bc1[a-z0-9]{39,59}$/,
                'BNB': /^bnb[a-z0-9]{39}$|^0x[a-fA-F0-9]{40}$/
            };
            
            const pattern = patterns[accountType];
            return pattern ? pattern.test(address) : true; // å¦‚æœæ²¡æœ‰å®šä¹‰æ¨¡å¼ï¼Œåˆ™è®¤ä¸ºæœ‰æ•ˆ
        }

        // è·å–æ•°å­—è´§å¸æ˜¾ç¤ºæ–‡æœ¬
        function getCryptoCurrencyText(accountType) {
            const currencyNames = {
                'USDT': 'USDT',
                'BTC': 'BTC',
                'ETH': 'ETH',
                'TRX': 'TRX',
                'BNB': 'BNB'
            };
            return currencyNames[accountType] || accountType;
        }

        // è·å–ç½‘ç»œç±»å‹æ˜¾ç¤ºæ–‡æœ¬
        function getNetworkTypeText(networkType) {
            const networkNames = {
                'TRC20': 'TRC20',
                'ERC20': 'ERC20',
                'BEP20': 'BEP20',
                'BEP2': 'BEP2',
                'OMNI': 'OMNI',
                'BTC': 'Bitcoin'
            };
            return networkNames[networkType] || networkType;
        }

        // æ ¼å¼åŒ–é’±åŒ…åœ°å€æ˜¾ç¤º
        function formatWalletAddress(address) {
            if (!address) return '-';
            if (address.length <= 20) return address;
            return `${address.substring(0, 10)}...${address.substring(address.length - 10)}`;
        }

        // åˆå§‹åŒ–è¡¨å•äº‹ä»¶ç›‘å¬å™¨
        function initializeFormEventListeners() {
            // æ•°å­—è´§å¸ç±»å‹å˜åŒ–æ—¶æ›´æ–°ç½‘ç»œé€‰é¡¹
            const accountTypeSelect = document.getElementById('accountType');
            if (accountTypeSelect) {
                accountTypeSelect.addEventListener('change', updateNetworkOptions);
            }
            
            // é’±åŒ…åœ°å€è¾“å…¥æ—¶éªŒè¯æ ¼å¼
            const accountNumberInput = document.getElementById('accountNumber');
            if (accountNumberInput) {
                accountNumberInput.addEventListener('blur', function() {
                    const accountType = document.getElementById('accountType').value;
                    const address = this.value;
                    
                    if (address && accountType) {
                        const isValid = validateWalletAddress(address, accountType);
                        if (!isValid) {
                            this.classList.add('is-invalid');
                        } else {
                            this.classList.remove('is-invalid');
                        }
                    }
                });
            }
        }

        // ==================== æƒé™æ§åˆ¶åŠŸèƒ½ ====================
        
        // å½“å‰ç”¨æˆ·æƒé™ä¿¡æ¯
        let currentUserPermissions = {
            permissionLevel: 1, // é»˜è®¤ä¸ºæ™®é€šç®¡ç†å‘˜
            userType: 'admin',
            username: 'ç®¡ç†å‘˜',
            hasSystemSettings: true,
            hasBackendAccess: true,
            hasSalespersonManagement: true
        };

        // æ£€æŸ¥ç”¨æˆ·æƒé™
        async function checkUserPermissions() {
            try {
                // ä»localStorageè·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
                const currentUser = localStorage.getItem('currentUser');
                const permissionLevel = localStorage.getItem('permissionLevel');
                
                if (currentUser && permissionLevel !== null) {
                    const user = JSON.parse(currentUser);
                    const level = parseInt(permissionLevel);
                    
                    // æ ¹æ®æƒé™ç­‰çº§è®¾ç½®æƒé™
                    currentUserPermissions = {
                        permissionLevel: level,
                        userType: getUserTypeByLevel(level),
                        username: user.NickName || user.Phone || 'ç”¨æˆ·',
                        hasSystemSettings: level <= 1, // ç®¡ç†å‘˜(1)å¯ä»¥è®¿é—®ç³»ç»Ÿè®¾ç½®
                        hasBackendAccess: level <= 1, // ç®¡ç†å‘˜(1)å¯ä»¥è®¿é—®åå°
                        hasSalespersonManagement: level <= 1 // ç®¡ç†å‘˜(1)å¯ä»¥ç®¡ç†ä¸šåŠ¡å‘˜
                    };
                } else {
                    // å¦‚æœæ²¡æœ‰æƒé™ä¿¡æ¯ï¼Œå°è¯•ä»åç«¯è·å–
                    const response = await fetch(`${API_BASE_URL}/api/admin/permissions/check?resource=all`);
                    
                    if (response.ok) {
                        const result = await response.json();
                        
                        currentUserPermissions = {
                            permissionLevel: result.permissionLevel || 1,
                            userType: result.userType || 'admin',
                            username: result.username || 'ç®¡ç†å‘˜',
                            hasSystemSettings: (result.permissionLevel || 1) <= 1,
                            hasBackendAccess: (result.permissionLevel || 1) <= 1,
                            hasSalespersonManagement: (result.permissionLevel || 1) <= 1
                        };
                    }
                }
                
                // åº”ç”¨æƒé™æ§åˆ¶
                applyPermissionControls();
                
                console.log('ç”¨æˆ·æƒé™ä¿¡æ¯:', currentUserPermissions);
            } catch (error) {
                console.error('æƒé™æ£€æŸ¥å‡ºé”™:', error);
                // å‡ºé”™æ—¶é»˜è®¤ä¸ºæ™®é€šç®¡ç†å‘˜æƒé™
            }
        }

        // æ ¹æ®æƒé™ç­‰çº§è·å–ç”¨æˆ·ç±»å‹
        function getUserTypeByLevel(level) {
            switch (level) {
                case 0: return 'super_admin';
                case 1: return 'admin';
                case 2: return 'salesperson';
                case 3: return 'user';
                default: return 'user';
            }
        }

        // æ ¹æ®æƒé™ç­‰çº§è·å–ç”¨æˆ·ç±»å‹æ˜¾ç¤ºåç§°
        function getUserTypeName(level) {
            switch (level) {
                case 0: return 'è¶…çº§ç®¡ç†å‘˜';
                case 1: return 'ç®¡ç†å‘˜';
                case 2: return 'ä¸šåŠ¡å‘˜';
                case 3: return 'æ³¨å†Œç”¨æˆ·';
                default: return 'ç”¨æˆ·';
            }
        }

        // åº”ç”¨æƒé™æ§åˆ¶
        function applyPermissionControls() {
            // é‡æ–°ç”Ÿæˆå½“å‰èœå•ä»¥åº”ç”¨æƒé™è¿‡æ»¤
            if (currentSection) {
                generateCategoryMenu(currentSection);
                
                // å¦‚æœå½“å‰åˆ†ç±»æ— æƒé™è®¿é—®ï¼Œåˆ‡æ¢åˆ°æœ‰æƒé™çš„åˆ†ç±»
                const availableCategories = getAvailableCategories(currentSection);
                if (currentCategory && !availableCategories.find(cat => cat.id === currentCategory)) {
                    if (availableCategories.length > 0) {
                        showCategory(availableCategories[0].id);
                    }
                }
            }
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
            updateUserInfoDisplay();
        }

        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
        function updateUserInfoDisplay() {
            // æ›´æ–°ä¾§è¾¹æ çš„ç”¨æˆ·ç±»å‹æ˜¾ç¤º
            const userTypeLabel = document.getElementById('userTypeLabel');
            if (userTypeLabel) {
                userTypeLabel.textContent = getUserTypeName(currentUserPermissions.permissionLevel);
            }
            
            // æ›´æ–°ä¾§è¾¹æ çš„ç”¨æˆ·åæ˜¾ç¤º
            const userInfoElement = document.querySelector('.sidebar-header .user-info');
            if (userInfoElement) {
                const typeName = getUserTypeName(currentUserPermissions.permissionLevel);
                const username = currentUserPermissions.username;
                userInfoElement.innerHTML = `${typeName} - ${username}`;
            }
            
            // åœ¨é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºå½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚æœæœ‰navbar-brandå…ƒç´ ï¼‰
            const navbarBrand = document.querySelector('.navbar-brand');
            if (navbarBrand && currentUserPermissions.username !== 'ç®¡ç†å‘˜') {
                navbarBrand.innerHTML += ` <small class="text-muted">(${currentUserPermissions.username})</small>`;
            }
        }

        // æ£€æŸ¥ç‰¹å®šèµ„æºæƒé™
        async function checkResourcePermission(resource) {
            try {
                const authToken = localStorage.getItem('authToken') || localStorage.getItem('adminToken');
                const response = await fetch(`${API_BASE_URL}/api/admin/permissions/check?resource=${resource}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    return result.hasPermission;
                } else {
                    return false;
                }
            } catch (error) {
                console.error('æƒé™æ£€æŸ¥å¤±è´¥:', error);
                return false;
            }
        }

        // æƒé™æ‹¦æˆªå™¨ - åœ¨è®¿é—®æ•æ„ŸåŠŸèƒ½å‰è°ƒç”¨
        async function requirePermission(resource, action = 'è®¿é—®æ­¤åŠŸèƒ½') {
            const hasPermission = await checkResourcePermission(resource);
            
            if (!hasPermission) {
                Swal.fire({
                    title: 'æƒé™ä¸è¶³',
                    text: `æ‚¨æ²¡æœ‰æƒé™${action}`,
                    icon: 'warning',
                    confirmButtonText: 'ç¡®å®š'
                });
                return false;
            }
            
            return true;
        }
    </script>
</body>
</html>







