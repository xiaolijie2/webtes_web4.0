<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理系统</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: #343a40;
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #495057;
        }

        .sidebar-header h4 {
            margin: 0;
            font-size: 18px;
        }

        .user-info {
            margin-top: 10px;
            font-size: 14px;
            opacity: 0.8;
        }

        .header-actions {
            margin-top: 15px;
        }

        .header-actions .btn {
            margin-right: 5px;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            border-bottom: 1px solid #495057;
        }

        .nav-link {
            display: block;
            padding: 15px 20px;
            color: #adb5bd;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
        }

        .nav-link:hover,
        .nav-link.active {
            background: #495057;
            color: white;
        }

        .nav-link i {
            margin-right: 10px;
            width: 20px;
        }

        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 20px;
        }

        .content-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .breadcrumb {
            background: none;
            padding: 0;
            margin: 0;
        }

        .content-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-card .label {
            color: #6c757d;
            font-size: 14px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        .btn-group {
            display: flex;
            gap: 5px;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }

        .alert {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .pagination .page-item {
            margin: 0 2px;
        }

        .pagination .page-link {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            color: #007bff;
            text-decoration: none;
            border-radius: 4px;
        }

        .pagination .page-link:hover {
            background: #e9ecef;
        }

        .pagination .page-item.active .page-link {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .pagination .page-item.disabled .page-link {
            color: #6c757d;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: #343a40;
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #495057;
        }

        .sidebar-header h4 {
            margin: 0;
            font-size: 18px;
        }

        .user-info {
            margin-top: 10px;
            font-size: 14px;
            opacity: 0.8;
        }

        .header-actions {
            margin-top: 15px;
        }

        .header-actions .btn {
            margin-right: 5px;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            border-bottom: 1px solid #495057;
        }

        .nav-link {
            display: block;
            padding: 15px 20px;
            color: #adb5bd;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
        }

        .nav-link:hover,
        .nav-link.active {
            background: #495057;
            color: white;
        }

        .nav-link i {
            margin-right: 10px;
            width: 20px;
        }

        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 20px;
        }

        .content-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .breadcrumb {
            background: none;
            padding: 0;
            margin: 0;
        }

        .content-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-card .label {
            color: #6c757d;
            font-size: 14px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        .btn-group {
            display: flex;
            gap: 5px;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }

        .alert {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .pagination .page-item {
            margin: 0 2px;
        }

        .pagination .page-link {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            color: #007bff;
            text-decoration: none;
            border-radius: 4px;
        }

        .pagination .page-link:hover {
            background: #e9ecef;
        }

        .pagination .page-item.active .page-link {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .pagination .page-item.disabled .page-link {
            color: #6c757d;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- 左侧导航菜单 -->
        <nav class="sidebar">
            <!-- 顶部标题栏 -->
            <div class="sidebar-header">
                <h4><i class="fas fa-cogs"></i> 管理系统</h4>
                <div class="user-info">
                    <i class="fas fa-user-circle"></i> <span class="username-display">管理员</span>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline-light btn-sm" onclick="goToHome()" title="返回首页">
                        <i class="fas fa-home"></i>
                    </button>
                    <button class="btn btn-outline-danger btn-sm logout-btn" title="退出登录">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <!-- 导航菜单 -->
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>仪表盘</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="website-settings">
                        <i class="fas fa-globe"></i>
                        <span>网站设置</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="member-management">
                        <i class="fas fa-users"></i>
                        <span>会员管理</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="order-management">
                        <i class="fas fa-shopping-cart"></i>
                        <span>订单管理</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="task-management">
                        <i class="fas fa-tasks"></i>
                        <span>任务管理</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="vip-management">
                        <i class="fas fa-crown"></i>
                        <span>VIP管理</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="agent-management">
                        <i class="fas fa-user-tie"></i>
                        <span>代理商管理</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- 主要内容区域 -->
        <main class="main-content">
            <!-- 内容头部 -->
            <div class="content-header">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">管理系统</a></li>
                        <li class="breadcrumb-item active" id="section-breadcrumb">仪表盘</li>
                    </ol>
                </nav>
                <h1 id="page-title">仪表盘</h1>
            </div>

            <!-- 仪表盘 -->
            <div id="dashboard" class="content-section active">
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="icon" style="color: #007bff;">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="number" id="totalUsers">0</div>
                        <div class="label">总用户数</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon" style="color: #28a745;">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="number" id="activeUsers">0</div>
                        <div class="label">活跃用户</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon" style="color: #ffc107;">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="number" id="totalOrders">0</div>
                        <div class="label">总订单数</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon" style="color: #dc3545;">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="number" id="totalRevenue">¥0</div>
                        <div class="label">总收入</div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h5>最近用户注册</h5>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>用户名</th>
                                    <th>注册时间</th>
                                    <th>状态</th>
                                </tr>
                            </thead>
                            <tbody id="recentUsers">
                                <tr>
                                    <td colspan="3" class="text-center">暂无数据</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h5>最近订单</h5>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>订单号</th>
                                    <th>金额</th>
                                    <th>状态</th>
                                </tr>
                            </thead>
                            <tbody id="recentOrders">
                                <tr>
                                    <td colspan="3" class="text-center">暂无数据</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 网站设置 -->
            <div id="website-settings" class="content-section">
                <h5>网站基本设置</h5>
                <form id="websiteSettingsForm">
                    <div class="form-group">
                        <label for="siteName">网站名称</label>
                        <input type="text" class="form-control" id="siteName" name="siteName" placeholder="请输入网站名称">
                    </div>
                    <div class="form-group">
                        <label for="siteDescription">网站描述</label>
                        <textarea class="form-control" id="siteDescription" name="siteDescription" rows="3" placeholder="请输入网站描述"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="contactEmail">联系邮箱</label>
                        <input type="email" class="form-control" id="contactEmail" name="contactEmail" placeholder="请输入联系邮箱">
                    </div>
                    <button type="submit" class="btn btn-primary">保存设置</button>
                </form>
            </div>

            <!-- 会员管理 -->
            <div id="member-management" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5>会员管理</h5>
                    <button class="btn btn-primary" onclick="refreshMemberList()">
                        <i class="fas fa-sync"></i> 刷新
                    </button>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="memberSearchInput" placeholder="搜索用户名或手机号" onkeyup="handleMemberSearch(event)">
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-outline-primary" onclick="searchMembers()">搜索</button>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>用户名</th>
                            <th>手机号</th>
                            <th>VIP等级</th>
                            <th>余额</th>
                            <th>状态</th>
                            <th>注册时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="membersList">
                        <tr>
                            <td colspan="8" class="text-center">正在加载...</td>
                        </tr>
                    </tbody>
                </table>

                <div id="membersPagination" class="pagination"></div>
            </div>

            <!-- 其他内容区域 -->
            <div id="order-management" class="content-section">
                <h5>订单管理</h5>
                <p>订单管理功能开发中...</p>
            </div>

            <div id="task-management" class="content-section">
                <h5>任务管理</h5>
                <p>任务管理功能开发中...</p>
            </div>

            <div id="vip-management" class="content-section">
                <h5>VIP管理</h5>
                <p>VIP管理功能开发中...</p>
            </div>

            <div id="agent-management" class="content-section">
                <h5>代理商管理</h5>
                <p>代理商管理功能开发中...</p>
            </div>
        </main>
    </div>

    <script src="js/static-data-manager.js"></script>
    <script src="js/static-auth.js"></script>
    <script>
        let currentSection = 'dashboard';
        let membersData = [];
        let filteredMembersData = [];
        let currentMemberPage = 1;
        let memberPageSize = 10;
        let memberSearchTerm = '';

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 检查管理员权限
            if (!window.staticAuth.isLoggedIn() || !window.staticAuth.hasPermission('admin')) {
                window.location.href = 'admin-login.html';
                return;
            }

            // 初始化页面
            initPage();
            
            // 设置导航菜单
            setupNavigation();
            
            // 加载仪表盘数据
            loadDashboardData();
            
            // 加载会员列表
            loadMembersList();
            
            // 加载网站设置
            loadWebsiteSettings();
        });

        // 初始化页面
        function initPage() {
            const user = window.staticAuth.getCurrentUser();
            if (user) {
                const usernameElements = document.querySelectorAll('.username-display');
                usernameElements.forEach(el => {
                    el.textContent = user.username || '管理员';
                });
            }
        }

        // 设置导航菜单
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    if (section) {
                        showSection(section);
                    }
                });
            });
        }

        // 显示指定内容区域
        function showSection(sectionId) {
            // 隐藏所有内容区域
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });

            // 移除所有导航链接的活动状态
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.classList.remove('active');
            });

            // 激活当前导航链接
            const activeLink = document.querySelector(`[data-section="${sectionId}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }

            // 显示指定内容区域
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            currentSection = sectionId;
            updateBreadcrumb();
        }

        // 更新面包屑导航
        function updateBreadcrumb() {
            const pageTitle = document.getElementById('page-title');
            const sectionBreadcrumb = document.getElementById('section-breadcrumb');

            const sectionNames = {
                'dashboard': '仪表盘',
                'website-settings': '网站设置',
                'member-management': '会员管理',
                'order-management': '订单管理',
                'task-management': '任务管理',
                'vip-management': 'VIP管理',
                'agent-management': '代理商管理'
            };

            const sectionName = sectionNames[currentSection] || '未知页面';
            if (pageTitle) pageTitle.textContent = sectionName;
            if (sectionBreadcrumb) sectionBreadcrumb.textContent = sectionName;
        }

        // 加载仪表盘数据
        async function loadDashboardData() {
            try {
                const users = await window.staticDataManager.getAllUsers();
                const orders = await window.staticDataManager.getAllOrders();
                
                // 更新统计数据
                document.getElementById('totalUsers').textContent = users.length;
                document.getElementById('activeUsers').textContent = users.filter(u => u.isActive !== false).length;
                document.getElementById('totalOrders').textContent = orders.length;
                
                // 计算总收入
                const totalRevenue = orders.reduce((sum, order) => sum + (order.amount || 0), 0);
                document.getElementById('totalRevenue').textContent = `¥${totalRevenue.toFixed(2)}`;
                
                // 显示最近用户
                const recentUsers = users.slice(-5).reverse();
                const recentUsersHtml = recentUsers.map(user => `
                    <tr>
                        <td>${user.username || user.phone}</td>
                        <td>${new Date(user.createdAt || Date.now()).toLocaleDateString()}</td>
                        <td><span class="badge ${user.isActive !== false ? 'bg-success' : 'bg-danger'}">${user.isActive !== false ? '活跃' : '禁用'}</span></td>
                    </tr>
                `).join('');
                document.getElementById('recentUsers').innerHTML = recentUsersHtml || '<tr><td colspan="3" class="text-center">暂无数据</td></tr>';
                
                // 显示最近订单
                const recentOrders = orders.slice(-5).reverse();
                const recentOrdersHtml = recentOrders.map(order => `
                    <tr>
                        <td>${order.id}</td>
                        <td>¥${order.amount || 0}</td>
                        <td><span class="badge bg-primary">${order.status || '未知'}</span></td>
                    </tr>
                `).join('');
                document.getElementById('recentOrders').innerHTML = recentOrdersHtml || '<tr><td colspan="3" class="text-center">暂无数据</td></tr>';
                
            } catch (error) {
                console.error('加载仪表盘数据失败:', error);
            }
        }

        // 加载会员列表
        async function loadMembersList() {
            try {
                membersData = await window.staticDataManager.getAllUsers();
                filteredMembersData = [...membersData];
                renderMembersList();
                renderMembersPagination();
            } catch (error) {
                console.error('加载会员列表失败:', error);
                document.getElementById('membersList').innerHTML = '<tr><td colspan="8" class="text-center text-danger">加载失败</td></tr>';
            }
        }

        // 渲染会员列表
        function renderMembersList() {
            const startIndex = (currentMemberPage - 1) * memberPageSize;
            const endIndex = startIndex + memberPageSize;
            const pageData = filteredMembersData.slice(startIndex, endIndex);

            const html = pageData.map(member => `
                <tr>
                    <td>${member.id}</td>
                    <td>${member.username || member.phone}</td>
                    <td>${member.phone || '-'}</td>
                    <td>VIP${member.vipLevel || 1}</td>
                    <td>¥${member.balance || 0}</td>
                    <td><span class="badge ${member.isActive !== false ? 'bg-success' : 'bg-danger'}">${member.isActive !== false ? '正常' : '禁用'}</span></td>
                    <td>${new Date(member.createdAt || Date.now()).toLocaleDateString()}</td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-primary" onclick="viewMemberDetails(${member.id})">查看</button>
                            <button class="btn btn-sm btn-outline-warning" onclick="editMember(${member.id})">编辑</button>
                        </div>
                    </td>
                </tr>
            `).join('');

            document.getElementById('membersList').innerHTML = html || '<tr><td colspan="8" class="text-center">暂无数据</td></tr>';
        }

        // 渲染分页
        function renderMembersPagination() {
            const totalPages = Math.ceil(filteredMembersData.length / memberPageSize);
            const pagination = document.getElementById('membersPagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHtml = `
                <li class="page-item ${currentMemberPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeMemberPage(${currentMemberPage - 1})">上一页</a>
                </li>
            `;

            const startPage = Math.max(1, currentMemberPage - 2);
            const endPage = Math.min(totalPages, currentMemberPage + 2);

            for (let i = startPage; i <= endPage; i++) {
                paginationHtml += `
                    <li class="page-item ${i === currentMemberPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changeMemberPage(${i})">${i}</a>
                    </li>
                `;
            }
            
            paginationHtml += `
                <li class="page-item ${currentMemberPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeMemberPage(${currentMemberPage + 1})">下一页</a>
                </li>
            `;
            
            pagination.innerHTML = paginationHtml;
        }

        // 切换页面
        function changeMemberPage(page) {
            const totalPages = Math.ceil(filteredMembersData.length / memberPageSize);
            if (page < 1 || page > totalPages) return;
            
            currentMemberPage = page;
            renderMembersList();
            renderMembersPagination();
        }

        // 搜索会员
        function searchMembers() {
            const searchInput = document.getElementById('memberSearchInput');
            memberSearchTerm = searchInput.value.trim();
            filterMembers();
        }

        // 处理搜索输入
        function handleMemberSearch(event) {
            if (event.key === 'Enter') {
                searchMembers();
            }
        }

        // 筛选会员
        function filterMembers() {
            filteredMembersData = membersData.filter(member => {
                const matchesSearch = !memberSearchTerm || 
                    (member.phone && member.phone.includes(memberSearchTerm)) ||
                    (member.username && member.username.includes(memberSearchTerm));
                
                return matchesSearch;
            });
            
            currentMemberPage = 1;
            renderMembersList();
            renderMembersPagination();
        }

        // 刷新会员列表
        function refreshMemberList() {
            document.getElementById('memberSearchInput').value = '';
            memberSearchTerm = '';
            currentMemberPage = 1;
            loadMembersList();
        }

        // 查看会员详情
        function viewMemberDetails(memberId) {
            const member = membersData.find(m => m.id === memberId);
            if (!member) {
                alert('未找到指定会员');
                return;
            }
            alert(`会员详情：\n用户名：${member.username || member.phone}\n手机号：${member.phone}\nVIP等级：${member.vipLevel || 1}\n余额：¥${member.balance || 0}`);
        }

        // 编辑会员
        function editMember(memberId) {
            alert('编辑会员功能开发中...');
        }

        // 加载网站设置
        async function loadWebsiteSettings() {
            try {
                const settings = await window.staticDataManager.getSiteSettings();
                if (settings) {
                    document.getElementById('siteName').value = settings.siteName || '';
                    document.getElementById('siteDescription').value = settings.siteDescription || '';
                    document.getElementById('contactEmail').value = settings.contactEmail || '';
                }
            } catch (error) {
                console.error('加载网站设置失败:', error);
            }
        }

        // 保存网站设置
        document.getElementById('websiteSettingsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const settings = {
                siteName: document.getElementById('siteName').value,
                siteDescription: document.getElementById('siteDescription').value,
                contactEmail: document.getElementById('contactEmail').value
            };
            
            try {
                await window.staticDataManager.saveSiteSettings(settings);
                alert('设置保存成功！');
            } catch (error) {
                console.error('保存设置失败:', error);
                alert('保存设置失败，请重试');
            }
        });

        // 返回首页
        function goToHome() {
            if (confirm('确定要返回首页吗？')) {
                window.location.href = 'home.html';
            }
        }
    </script>
</body>
</html>