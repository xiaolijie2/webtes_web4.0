# 数据文件管理说明文档

## 当前数据文件分布分析

### 🔴 严重问题：数据文件重复和冗余

经过全面分析，发现项目中存在大量重复和冗余的数据文件，导致数据不一致和管理混乱。

## 📁 核心数据文件（统一数据源）

### 1. 用户/会员数据
**主数据源：** `Data/users.json`
- **作用：** 存储所有用户数据（包括普通用户和管理员）
- **结构：** 完整的用户信息，包含余额、VIP等级、信用分数等
- **API控制器：** `UserController.cs`, `AdminController.cs`

**冗余文件（需要清理）：**
- `users.json` (根目录) - 旧版本数据
- `wwwroot/users.json` - 空文件
- `wwwroot/data/users.json` - 测试数据

### 2. 业务员/代理数据
**主数据源：** `Data/agents.json`
- **作用：** 存储业务员信息和业绩数据
- **结构：** 业务员账户、邀请码、佣金率、客户数量等
- **API控制器：** `SalespersonController.cs`

**冗余文件（需要清理）：**
- `wwwroot/agents.json` - 旧版本测试数据
- `wwwroot/data/agents.json` - 旧版本测试数据

### 3. 管理员数据
**主数据源：** `Data/admins.json`
- **作用：** 存储普通管理员账户信息
- **结构：** 管理员账户、权限级别、创建时间等
- **API控制器：** `AdminManagementController.cs`

**主数据源：** `Data/super_admins.json`
- **作用：** 存储超级管理员账户信息
- **结构：** 超级管理员账户、最高权限级别
- **API控制器：** `SuperAdminController.cs`

### 4. 客户分配关系
**主数据源：** `Data/customer_assignments.json`
- **作用：** 存储客户与业务员的分配关系
- **结构：** 客户ID、业务员ID、分配时间等
- **API控制器：** `SalespersonController.cs`

**冗余文件（需要清理）：**
- `customer_assignments.json` (根目录)
- `wwwroot/customer_assignments.json`

### 5. 邀请码管理
**主数据源：** `Data/agent_invite_codes.json`
- **作用：** 存储业务员邀请码信息
- **结构：** 邀请码、使用状态、创建时间等

**主数据源：** `Data/invitations.json`
- **作用：** 存储邀请记录
- **结构：** 邀请关系、邀请时间等

**主数据源：** `Data/invite_records.json`
- **作用：** 存储详细的邀请记录
- **结构：** 邀请者、被邀请者、奖励等

### 6. 其他核心数据文件

#### 财务相关
- `Data/balances.json` - 用户余额记录
- `Data/transactions.json` - 交易记录
- `Data/payment_accounts.json` - 收款账户信息

#### 系统设置
- `Data/site_settings.json` - 网站基本设置
- `Data/logo-settings.json` - LOGO设置
- `Data/logos.json` - LOGO文件信息
- `Data/vip_levels.json` - VIP等级设置
- `Data/country_codes.json` - 国家区号数据

#### 内容管理
- `Data/messages.json` - 系统消息
- `Data/marquee.json` - 跑马灯内容
- `Data/slideshow.json` - 轮播图设置

#### 任务系统
- `Data/tasks.json` - 系统任务
- `Data/user_tasks.json` - 用户任务记录
- `Data/user_stats.json` - 用户统计数据

#### 订单系统
- `Data/orders.json` - 订单数据

## 🗑️ 需要清理的冗余文件

### 根目录冗余文件
- `users.json` - 旧版本，数据已迁移到 `Data/users.json`
- `agents.json` - 空文件，应删除
- `salespersons.json` - 旧版本，数据已迁移到 `Data/agents.json`
- `customers.json` - 旧版本，数据已迁移到 `Data/users.json`
- `customer_assignments.json` - 旧版本，数据已迁移到 `Data/customer_assignments.json`

### wwwroot目录冗余文件
- `wwwroot/users.json` - 空文件
- `wwwroot/agents.json` - 测试数据
- `wwwroot/salespersons.json` - 测试数据
- `wwwroot/customers.json` - 测试数据
- `wwwroot/customer_assignments.json` - 测试数据
- `wwwroot/messages.json` - 测试数据
- `wwwroot/data/` 整个目录 - 旧版本测试数据

## 📋 统一数据管理策略

### 1. 数据文件命名规范
- 所有核心数据文件统一存放在 `Data/` 目录
- 文件名使用小写字母和下划线
- 避免在多个位置存储相同类型的数据

### 2. API访问规范
- 所有API控制器只访问 `Data/` 目录中的文件
- 禁止访问根目录或wwwroot中的数据文件
- 统一使用 `DataService.cs` 进行数据操作

### 3. 前端数据访问
- 前端通过API接口获取数据，不直接访问JSON文件
- 移除前端对wwwroot中JSON文件的直接引用

## 🔧 需要更新的文件

### API控制器需要检查的文件
1. `Controllers/UserController.cs`
2. `Controllers/AdminController.cs`
3. `Controllers/SalespersonController.cs`
4. `Controllers/AdminManagementController.cs`
5. `Controllers/SuperAdminController.cs`

### 前端页面需要检查的文件
1. `wwwroot/admin.html`
2. `wwwroot/super-admin.html`
3. `wwwroot/salesperson.html`
4. `wwwroot/user.html`

## 📝 实施步骤

1. **备份当前数据** - 确保数据安全
2. **清理冗余文件** - 删除重复和无用的数据文件
3. **更新API引用** - 确保所有API都指向统一数据源
4. **更新前端代码** - 移除对冗余文件的引用
5. **测试验证** - 确保所有功能正常工作

## ⚠️ 注意事项

1. **数据一致性** - 清理前确保数据已正确迁移
2. **备份重要** - 删除文件前必须备份
3. **逐步实施** - 分步骤进行，避免系统中断
4. **测试验证** - 每个步骤后都要测试相关功能

---

**最后更新：** 2025年1月15日
**维护人员：** 系统管理员